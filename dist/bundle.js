!function(t){var e={};function i(n){if(e[n])return e[n].exports;var s=e[n]={i:n,l:!1,exports:{}};return t[n].call(s.exports,s,s.exports,i),s.l=!0,s.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)i.d(n,s,function(e){return t[e]}.bind(null,s));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=11)}([function(t,e,i){"use strict";const n=2.3283064365386963e-10;class s{constructor(){this._seed=0,this._s0=0,this._s1=0,this._s2=0,this._c=0}getSeed(){return this._seed}setSeed(t){return t=t<1?1/t:t,this._seed=t,this._s0=(t>>>0)*n,t=69069*t+1>>>0,this._s1=t*n,t=69069*t+1>>>0,this._s2=t*n,this._c=1,this}getUniform(){let t=2091639*this._s0+this._c*n;return this._s0=this._s1,this._s1=this._s2,this._c=0|t,this._s2=t-this._c,this._s2}getUniformInt(t,e){let i=Math.max(t,e),n=Math.min(t,e);return Math.floor(this.getUniform()*(i-n+1))+n}getNormal(t=0,e=1){let i,n,s;do{i=2*this.getUniform()-1,n=2*this.getUniform()-1,s=i*i+n*n}while(s>1||0==s);return t+i*Math.sqrt(-2*Math.log(s)/s)*e}getPercentage(){return 1+Math.floor(100*this.getUniform())}getItem(t){return t.length?t[Math.floor(this.getUniform()*t.length)]:null}shuffle(t){let e=[],i=t.slice();for(;i.length;){let t=i.indexOf(this.getItem(i));e.push(i.splice(t,1)[0])}return e}getWeightedValue(t){let e=0;for(let i in t)e+=t[i];let i,n=this.getUniform()*e,s=0;for(i in t)if(s+=t[i],n<s)return i;return i}getState(){return[this._s0,this._s1,this._s2,this._c]}setState(t){return this._s0=t[0],this._s1=t[1],this._s2=t[2],this._c=t[3],this}clone(){return(new s).setState(this.getState())}}e.a=(new s).setSeed(Date.now())},function(t,e,i){(function(i){var n;
/*!
 *  howler.js v2.2.0
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */!function(){"use strict";var s=function(){this.init()};s.prototype={init:function(){var t=this||o;return t._counter=1e3,t._html5AudioPool=[],t.html5PoolSize=10,t._codecs={},t._howls=[],t._muted=!1,t._volume=1,t._canPlayEvent="canplaythrough",t._navigator="undefined"!=typeof window&&window.navigator?window.navigator:null,t.masterGain=null,t.noAudio=!1,t.usingWebAudio=!0,t.autoSuspend=!0,t.ctx=null,t.autoUnlock=!0,t._setup(),t},volume:function(t){var e=this||o;if(t=parseFloat(t),e.ctx||p(),void 0!==t&&t>=0&&t<=1){if(e._volume=t,e._muted)return e;e.usingWebAudio&&e.masterGain.gain.setValueAtTime(t,o.ctx.currentTime);for(var i=0;i<e._howls.length;i++)if(!e._howls[i]._webAudio)for(var n=e._howls[i]._getSoundIds(),s=0;s<n.length;s++){var r=e._howls[i]._soundById(n[s]);r&&r._node&&(r._node.volume=r._volume*t)}return e}return e._volume},mute:function(t){var e=this||o;e.ctx||p(),e._muted=t,e.usingWebAudio&&e.masterGain.gain.setValueAtTime(t?0:e._volume,o.ctx.currentTime);for(var i=0;i<e._howls.length;i++)if(!e._howls[i]._webAudio)for(var n=e._howls[i]._getSoundIds(),s=0;s<n.length;s++){var r=e._howls[i]._soundById(n[s]);r&&r._node&&(r._node.muted=!!t||r._muted)}return e},stop:function(){for(var t=this||o,e=0;e<t._howls.length;e++)t._howls[e].stop();return t},unload:function(){for(var t=this||o,e=t._howls.length-1;e>=0;e--)t._howls[e].unload();return t.usingWebAudio&&t.ctx&&void 0!==t.ctx.close&&(t.ctx.close(),t.ctx=null,p()),t},codecs:function(t){return(this||o)._codecs[t.replace(/^x-/,"")]},_setup:function(){var t=this||o;if(t.state=t.ctx&&t.ctx.state||"suspended",t._autoSuspend(),!t.usingWebAudio)if("undefined"!=typeof Audio)try{void 0===(new Audio).oncanplaythrough&&(t._canPlayEvent="canplay")}catch(e){t.noAudio=!0}else t.noAudio=!0;try{(new Audio).muted&&(t.noAudio=!0)}catch(t){}return t.noAudio||t._setupCodecs(),t},_setupCodecs:function(){var t=this||o,e=null;try{e="undefined"!=typeof Audio?new Audio:null}catch(e){return t}if(!e||"function"!=typeof e.canPlayType)return t;var i=e.canPlayType("audio/mpeg;").replace(/^no$/,""),n=t._navigator&&t._navigator.userAgent.match(/OPR\/([0-6].)/g),s=n&&parseInt(n[0].split("/")[1],10)<33;return t._codecs={mp3:!(s||!i&&!e.canPlayType("audio/mp3;").replace(/^no$/,"")),mpeg:!!i,opus:!!e.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!e.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!e.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!e.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),aac:!!e.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!e.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(e.canPlayType("audio/x-m4a;")||e.canPlayType("audio/m4a;")||e.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(e.canPlayType("audio/x-m4b;")||e.canPlayType("audio/m4b;")||e.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(e.canPlayType("audio/x-mp4;")||e.canPlayType("audio/mp4;")||e.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!e.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,""),webm:!!e.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,""),dolby:!!e.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(e.canPlayType("audio/x-flac;")||e.canPlayType("audio/flac;")).replace(/^no$/,"")},t},_unlockAudio:function(){var t=this||o;if(!t._audioUnlocked&&t.ctx){t._audioUnlocked=!1,t.autoUnlock=!1,t._mobileUnloaded||44100===t.ctx.sampleRate||(t._mobileUnloaded=!0,t.unload()),t._scratchBuffer=t.ctx.createBuffer(1,1,22050);var e=function(i){for(;t._html5AudioPool.length<t.html5PoolSize;)try{var n=new Audio;n._unlocked=!0,t._releaseHtml5Audio(n)}catch(i){t.noAudio=!0;break}for(var s=0;s<t._howls.length;s++)if(!t._howls[s]._webAudio)for(var o=t._howls[s]._getSoundIds(),r=0;r<o.length;r++){var a=t._howls[s]._soundById(o[r]);a&&a._node&&!a._node._unlocked&&(a._node._unlocked=!0,a._node.load())}t._autoResume();var l=t.ctx.createBufferSource();l.buffer=t._scratchBuffer,l.connect(t.ctx.destination),void 0===l.start?l.noteOn(0):l.start(0),"function"==typeof t.ctx.resume&&t.ctx.resume(),l.onended=function(){l.disconnect(0),t._audioUnlocked=!0,document.removeEventListener("touchstart",e,!0),document.removeEventListener("touchend",e,!0),document.removeEventListener("click",e,!0);for(var i=0;i<t._howls.length;i++)t._howls[i]._emit("unlock")}};return document.addEventListener("touchstart",e,!0),document.addEventListener("touchend",e,!0),document.addEventListener("click",e,!0),t}},_obtainHtml5Audio:function(){var t=this||o;if(t._html5AudioPool.length)return t._html5AudioPool.pop();var e=(new Audio).play();return e&&"undefined"!=typeof Promise&&(e instanceof Promise||"function"==typeof e.then)&&e.catch((function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")})),new Audio},_releaseHtml5Audio:function(t){var e=this||o;return t._unlocked&&e._html5AudioPool.push(t),e},_autoSuspend:function(){var t=this;if(t.autoSuspend&&t.ctx&&void 0!==t.ctx.suspend&&o.usingWebAudio){for(var e=0;e<t._howls.length;e++)if(t._howls[e]._webAudio)for(var i=0;i<t._howls[e]._sounds.length;i++)if(!t._howls[e]._sounds[i]._paused)return t;return t._suspendTimer&&clearTimeout(t._suspendTimer),t._suspendTimer=setTimeout((function(){if(t.autoSuspend){t._suspendTimer=null,t.state="suspending";var e=function(){t.state="suspended",t._resumeAfterSuspend&&(delete t._resumeAfterSuspend,t._autoResume())};t.ctx.suspend().then(e,e)}}),3e4),t}},_autoResume:function(){var t=this;if(t.ctx&&void 0!==t.ctx.resume&&o.usingWebAudio)return"running"===t.state&&"interrupted"!==t.ctx.state&&t._suspendTimer?(clearTimeout(t._suspendTimer),t._suspendTimer=null):"suspended"===t.state||"running"===t.state&&"interrupted"===t.ctx.state?(t.ctx.resume().then((function(){t.state="running";for(var e=0;e<t._howls.length;e++)t._howls[e]._emit("resume")})),t._suspendTimer&&(clearTimeout(t._suspendTimer),t._suspendTimer=null)):"suspending"===t.state&&(t._resumeAfterSuspend=!0),t}};var o=new s,r=function(t){t.src&&0!==t.src.length?this.init(t):console.error("An array of source files must be passed with any new Howl.")};r.prototype={init:function(t){var e=this;return o.ctx||p(),e._autoplay=t.autoplay||!1,e._format="string"!=typeof t.format?t.format:[t.format],e._html5=t.html5||!1,e._muted=t.mute||!1,e._loop=t.loop||!1,e._pool=t.pool||5,e._preload="boolean"!=typeof t.preload&&"metadata"!==t.preload||t.preload,e._rate=t.rate||1,e._sprite=t.sprite||{},e._src="string"!=typeof t.src?t.src:[t.src],e._volume=void 0!==t.volume?t.volume:1,e._xhr={method:t.xhr&&t.xhr.method?t.xhr.method:"GET",headers:t.xhr&&t.xhr.headers?t.xhr.headers:null,withCredentials:!(!t.xhr||!t.xhr.withCredentials)&&t.xhr.withCredentials},e._duration=0,e._state="unloaded",e._sounds=[],e._endTimers={},e._queue=[],e._playLock=!1,e._onend=t.onend?[{fn:t.onend}]:[],e._onfade=t.onfade?[{fn:t.onfade}]:[],e._onload=t.onload?[{fn:t.onload}]:[],e._onloaderror=t.onloaderror?[{fn:t.onloaderror}]:[],e._onplayerror=t.onplayerror?[{fn:t.onplayerror}]:[],e._onpause=t.onpause?[{fn:t.onpause}]:[],e._onplay=t.onplay?[{fn:t.onplay}]:[],e._onstop=t.onstop?[{fn:t.onstop}]:[],e._onmute=t.onmute?[{fn:t.onmute}]:[],e._onvolume=t.onvolume?[{fn:t.onvolume}]:[],e._onrate=t.onrate?[{fn:t.onrate}]:[],e._onseek=t.onseek?[{fn:t.onseek}]:[],e._onunlock=t.onunlock?[{fn:t.onunlock}]:[],e._onresume=[],e._webAudio=o.usingWebAudio&&!e._html5,void 0!==o.ctx&&o.ctx&&o.autoUnlock&&o._unlockAudio(),o._howls.push(e),e._autoplay&&e._queue.push({event:"play",action:function(){e.play()}}),e._preload&&"none"!==e._preload&&e.load(),e},load:function(){var t=null;if(o.noAudio)this._emit("loaderror",null,"No audio support.");else{"string"==typeof this._src&&(this._src=[this._src]);for(var e=0;e<this._src.length;e++){var i,n;if(this._format&&this._format[e])i=this._format[e];else{if("string"!=typeof(n=this._src[e])){this._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}(i=/^data:audio\/([^;,]+);/i.exec(n))||(i=/\.([^.]+)$/.exec(n.split("?",1)[0])),i&&(i=i[1].toLowerCase())}if(i||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),i&&o.codecs(i)){t=this._src[e];break}}if(t)return this._src=t,this._state="loading","https:"===window.location.protocol&&"http:"===t.slice(0,5)&&(this._html5=!0,this._webAudio=!1),new a(this),this._webAudio&&h(this),this;this._emit("loaderror",null,"No codec support for selected audio sources.")}},play:function(t,e){var i=this,n=null;if("number"==typeof t)n=t,t=null;else{if("string"==typeof t&&"loaded"===i._state&&!i._sprite[t])return null;if(void 0===t&&(t="__default",!i._playLock)){for(var s=0,r=0;r<i._sounds.length;r++)i._sounds[r]._paused&&!i._sounds[r]._ended&&(s++,n=i._sounds[r]._id);1===s?t=null:n=null}}var a=n?i._soundById(n):i._inactiveSound();if(!a)return null;if(n&&!t&&(t=a._sprite||"__default"),"loaded"!==i._state){a._sprite=t,a._ended=!1;var l=a._id;return i._queue.push({event:"play",action:function(){i.play(l)}}),l}if(n&&!a._paused)return e||i._loadQueue("play"),a._id;i._webAudio&&o._autoResume();var h=Math.max(0,a._seek>0?a._seek:i._sprite[t][0]/1e3),c=Math.max(0,(i._sprite[t][0]+i._sprite[t][1])/1e3-h),u=1e3*c/Math.abs(a._rate),d=i._sprite[t][0]/1e3,p=(i._sprite[t][0]+i._sprite[t][1])/1e3;a._sprite=t,a._ended=!1;var _=function(){a._paused=!1,a._seek=h,a._start=d,a._stop=p,a._loop=!(!a._loop&&!i._sprite[t][2])};if(!(h>=p)){var f=a._node;if(i._webAudio){var m=function(){i._playLock=!1,_(),i._refreshBuffer(a);var t=a._muted||i._muted?0:a._volume;f.gain.setValueAtTime(t,o.ctx.currentTime),a._playStart=o.ctx.currentTime,void 0===f.bufferSource.start?a._loop?f.bufferSource.noteGrainOn(0,h,86400):f.bufferSource.noteGrainOn(0,h,c):a._loop?f.bufferSource.start(0,h,86400):f.bufferSource.start(0,h,c),u!==1/0&&(i._endTimers[a._id]=setTimeout(i._ended.bind(i,a),u)),e||setTimeout((function(){i._emit("play",a._id),i._loadQueue()}),0)};"running"===o.state&&"interrupted"!==o.ctx.state?m():(i._playLock=!0,i.once("resume",m),i._clearTimer(a._id))}else{var g=function(){f.currentTime=h,f.muted=a._muted||i._muted||o._muted||f.muted,f.volume=a._volume*o.volume(),f.playbackRate=a._rate;try{var n=f.play();if(n&&"undefined"!=typeof Promise&&(n instanceof Promise||"function"==typeof n.then)?(i._playLock=!0,_(),n.then((function(){i._playLock=!1,f._unlocked=!0,e||(i._emit("play",a._id),i._loadQueue())})).catch((function(){i._playLock=!1,i._emit("playerror",a._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),a._ended=!0,a._paused=!0}))):e||(i._playLock=!1,_(),i._emit("play",a._id),i._loadQueue()),f.playbackRate=a._rate,f.paused)return void i._emit("playerror",a._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");"__default"!==t||a._loop?i._endTimers[a._id]=setTimeout(i._ended.bind(i,a),u):(i._endTimers[a._id]=function(){i._ended(a),f.removeEventListener("ended",i._endTimers[a._id],!1)},f.addEventListener("ended",i._endTimers[a._id],!1))}catch(t){i._emit("playerror",a._id,t)}};"data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"===f.src&&(f.src=i._src,f.load());var y=window&&window.ejecta||!f.readyState&&o._navigator.isCocoonJS;if(f.readyState>=3||y)g();else{i._playLock=!0;var v=function(){g(),f.removeEventListener(o._canPlayEvent,v,!1)};f.addEventListener(o._canPlayEvent,v,!1),i._clearTimer(a._id)}}return a._id}i._ended(a)},pause:function(t){var e=this;if("loaded"!==e._state||e._playLock)return e._queue.push({event:"pause",action:function(){e.pause(t)}}),e;for(var i=e._getSoundIds(t),n=0;n<i.length;n++){e._clearTimer(i[n]);var s=e._soundById(i[n]);if(s&&!s._paused&&(s._seek=e.seek(i[n]),s._rateSeek=0,s._paused=!0,e._stopFade(i[n]),s._node))if(e._webAudio){if(!s._node.bufferSource)continue;void 0===s._node.bufferSource.stop?s._node.bufferSource.noteOff(0):s._node.bufferSource.stop(0),e._cleanBuffer(s._node)}else isNaN(s._node.duration)&&s._node.duration!==1/0||s._node.pause();arguments[1]||e._emit("pause",s?s._id:null)}return e},stop:function(t,e){var i=this;if("loaded"!==i._state||i._playLock)return i._queue.push({event:"stop",action:function(){i.stop(t)}}),i;for(var n=i._getSoundIds(t),s=0;s<n.length;s++){i._clearTimer(n[s]);var o=i._soundById(n[s]);o&&(o._seek=o._start||0,o._rateSeek=0,o._paused=!0,o._ended=!0,i._stopFade(n[s]),o._node&&(i._webAudio?o._node.bufferSource&&(void 0===o._node.bufferSource.stop?o._node.bufferSource.noteOff(0):o._node.bufferSource.stop(0),i._cleanBuffer(o._node)):isNaN(o._node.duration)&&o._node.duration!==1/0||(o._node.currentTime=o._start||0,o._node.pause(),o._node.duration===1/0&&i._clearSound(o._node))),e||i._emit("stop",o._id))}return i},mute:function(t,e){var i=this;if("loaded"!==i._state||i._playLock)return i._queue.push({event:"mute",action:function(){i.mute(t,e)}}),i;if(void 0===e){if("boolean"!=typeof t)return i._muted;i._muted=t}for(var n=i._getSoundIds(e),s=0;s<n.length;s++){var r=i._soundById(n[s]);r&&(r._muted=t,r._interval&&i._stopFade(r._id),i._webAudio&&r._node?r._node.gain.setValueAtTime(t?0:r._volume,o.ctx.currentTime):r._node&&(r._node.muted=!!o._muted||t),i._emit("mute",r._id))}return i},volume:function(){var t,e,i,n=this,s=arguments;if(0===s.length)return n._volume;if(1===s.length||2===s.length&&void 0===s[1]){var r=n._getSoundIds(),a=r.indexOf(s[0]);a>=0?e=parseInt(s[0],10):t=parseFloat(s[0])}else s.length>=2&&(t=parseFloat(s[0]),e=parseInt(s[1],10));if(!(void 0!==t&&t>=0&&t<=1))return(i=e?n._soundById(e):n._sounds[0])?i._volume:0;if("loaded"!==n._state||n._playLock)return n._queue.push({event:"volume",action:function(){n.volume.apply(n,s)}}),n;void 0===e&&(n._volume=t),e=n._getSoundIds(e);for(var l=0;l<e.length;l++)(i=n._soundById(e[l]))&&(i._volume=t,s[2]||n._stopFade(e[l]),n._webAudio&&i._node&&!i._muted?i._node.gain.setValueAtTime(t,o.ctx.currentTime):i._node&&!i._muted&&(i._node.volume=t*o.volume()),n._emit("volume",i._id));return n},fade:function(t,e,i,n){var s=this;if("loaded"!==s._state||s._playLock)return s._queue.push({event:"fade",action:function(){s.fade(t,e,i,n)}}),s;t=Math.min(Math.max(0,parseFloat(t)),1),e=Math.min(Math.max(0,parseFloat(e)),1),i=parseFloat(i),s.volume(t,n);for(var r=s._getSoundIds(n),a=0;a<r.length;a++){var l=s._soundById(r[a]);if(l){if(n||s._stopFade(r[a]),s._webAudio&&!l._muted){var h=o.ctx.currentTime,c=h+i/1e3;l._volume=t,l._node.gain.setValueAtTime(t,h),l._node.gain.linearRampToValueAtTime(e,c)}s._startFadeInterval(l,t,e,i,r[a],void 0===n)}}return s},_startFadeInterval:function(t,e,i,n,s,o){var r=this,a=e,l=i-e,h=Math.abs(l/.01),c=Math.max(4,h>0?n/h:n),u=Date.now();t._fadeTo=i,t._interval=setInterval((function(){var s=(Date.now()-u)/n;u=Date.now(),a+=l*s,a=l<0?Math.max(i,a):Math.min(i,a),a=Math.round(100*a)/100,r._webAudio?t._volume=a:r.volume(a,t._id,!0),o&&(r._volume=a),(i<e&&a<=i||i>e&&a>=i)&&(clearInterval(t._interval),t._interval=null,t._fadeTo=null,r.volume(i,t._id),r._emit("fade",t._id))}),c)},_stopFade:function(t){var e=this._soundById(t);return e&&e._interval&&(this._webAudio&&e._node.gain.cancelScheduledValues(o.ctx.currentTime),clearInterval(e._interval),e._interval=null,this.volume(e._fadeTo,t),e._fadeTo=null,this._emit("fade",t)),this},loop:function(){var t,e,i,n=this,s=arguments;if(0===s.length)return n._loop;if(1===s.length){if("boolean"!=typeof s[0])return!!(i=n._soundById(parseInt(s[0],10)))&&i._loop;t=s[0],n._loop=t}else 2===s.length&&(t=s[0],e=parseInt(s[1],10));for(var o=n._getSoundIds(e),r=0;r<o.length;r++)(i=n._soundById(o[r]))&&(i._loop=t,n._webAudio&&i._node&&i._node.bufferSource&&(i._node.bufferSource.loop=t,t&&(i._node.bufferSource.loopStart=i._start||0,i._node.bufferSource.loopEnd=i._stop)));return n},rate:function(){var t,e,i,n=this,s=arguments;if(0===s.length)e=n._sounds[0]._id;else if(1===s.length){var r=n._getSoundIds(),a=r.indexOf(s[0]);a>=0?e=parseInt(s[0],10):t=parseFloat(s[0])}else 2===s.length&&(t=parseFloat(s[0]),e=parseInt(s[1],10));if("number"!=typeof t)return(i=n._soundById(e))?i._rate:n._rate;if("loaded"!==n._state||n._playLock)return n._queue.push({event:"rate",action:function(){n.rate.apply(n,s)}}),n;void 0===e&&(n._rate=t),e=n._getSoundIds(e);for(var l=0;l<e.length;l++)if(i=n._soundById(e[l])){n.playing(e[l])&&(i._rateSeek=n.seek(e[l]),i._playStart=n._webAudio?o.ctx.currentTime:i._playStart),i._rate=t,n._webAudio&&i._node&&i._node.bufferSource?i._node.bufferSource.playbackRate.setValueAtTime(t,o.ctx.currentTime):i._node&&(i._node.playbackRate=t);var h=n.seek(e[l]),c=(n._sprite[i._sprite][0]+n._sprite[i._sprite][1])/1e3-h,u=1e3*c/Math.abs(i._rate);!n._endTimers[e[l]]&&i._paused||(n._clearTimer(e[l]),n._endTimers[e[l]]=setTimeout(n._ended.bind(n,i),u)),n._emit("rate",i._id)}return n},seek:function(){var t,e,i=this,n=arguments;if(0===n.length)e=i._sounds[0]._id;else if(1===n.length){var s=i._getSoundIds(),r=s.indexOf(n[0]);r>=0?e=parseInt(n[0],10):i._sounds.length&&(e=i._sounds[0]._id,t=parseFloat(n[0]))}else 2===n.length&&(t=parseFloat(n[0]),e=parseInt(n[1],10));if(void 0===e)return i;if("loaded"!==i._state||i._playLock)return i._queue.push({event:"seek",action:function(){i.seek.apply(i,n)}}),i;var a=i._soundById(e);if(a){if(!("number"==typeof t&&t>=0)){if(i._webAudio){var l=i.playing(e)?o.ctx.currentTime-a._playStart:0,h=a._rateSeek?a._rateSeek-a._seek:0;return a._seek+(h+l*Math.abs(a._rate))}return a._node.currentTime}var c=i.playing(e);c&&i.pause(e,!0),a._seek=t,a._ended=!1,i._clearTimer(e),i._webAudio||!a._node||isNaN(a._node.duration)||(a._node.currentTime=t);var u=function(){i._emit("seek",e),c&&i.play(e,!0)};if(c&&!i._webAudio){var d=function(){i._playLock?setTimeout(d,0):u()};setTimeout(d,0)}else u()}return i},playing:function(t){if("number"==typeof t){var e=this._soundById(t);return!!e&&!e._paused}for(var i=0;i<this._sounds.length;i++)if(!this._sounds[i]._paused)return!0;return!1},duration:function(t){var e=this._duration,i=this._soundById(t);return i&&(e=this._sprite[i._sprite][1]/1e3),e},state:function(){return this._state},unload:function(){for(var t=this,e=t._sounds,i=0;i<e.length;i++)e[i]._paused||t.stop(e[i]._id),t._webAudio||(t._clearSound(e[i]._node),e[i]._node.removeEventListener("error",e[i]._errorFn,!1),e[i]._node.removeEventListener(o._canPlayEvent,e[i]._loadFn,!1),o._releaseHtml5Audio(e[i]._node)),delete e[i]._node,t._clearTimer(e[i]._id);var n=o._howls.indexOf(t);n>=0&&o._howls.splice(n,1);var s=!0;for(i=0;i<o._howls.length;i++)if(o._howls[i]._src===t._src||t._src.indexOf(o._howls[i]._src)>=0){s=!1;break}return l&&s&&delete l[t._src],o.noAudio=!1,t._state="unloaded",t._sounds=[],t=null,null},on:function(t,e,i,n){var s=this["_on"+t];return"function"==typeof e&&s.push(n?{id:i,fn:e,once:n}:{id:i,fn:e}),this},off:function(t,e,i){var n=this["_on"+t],s=0;if("number"==typeof e&&(i=e,e=null),e||i)for(s=0;s<n.length;s++){var o=i===n[s].id;if(e===n[s].fn&&o||!e&&o){n.splice(s,1);break}}else if(t)this["_on"+t]=[];else{var r=Object.keys(this);for(s=0;s<r.length;s++)0===r[s].indexOf("_on")&&Array.isArray(this[r[s]])&&(this[r[s]]=[])}return this},once:function(t,e,i){return this.on(t,e,i,1),this},_emit:function(t,e,i){for(var n=this["_on"+t],s=n.length-1;s>=0;s--)n[s].id&&n[s].id!==e&&"load"!==t||(setTimeout(function(t){t.call(this,e,i)}.bind(this,n[s].fn),0),n[s].once&&this.off(t,n[s].fn,n[s].id));return this._loadQueue(t),this},_loadQueue:function(t){if(this._queue.length>0){var e=this._queue[0];e.event===t&&(this._queue.shift(),this._loadQueue()),t||e.action()}return this},_ended:function(t){var e=t._sprite;if(!this._webAudio&&t._node&&!t._node.paused&&!t._node.ended&&t._node.currentTime<t._stop)return setTimeout(this._ended.bind(this,t),100),this;var i=!(!t._loop&&!this._sprite[e][2]);if(this._emit("end",t._id),!this._webAudio&&i&&this.stop(t._id,!0).play(t._id),this._webAudio&&i){this._emit("play",t._id),t._seek=t._start||0,t._rateSeek=0,t._playStart=o.ctx.currentTime;var n=1e3*(t._stop-t._start)/Math.abs(t._rate);this._endTimers[t._id]=setTimeout(this._ended.bind(this,t),n)}return this._webAudio&&!i&&(t._paused=!0,t._ended=!0,t._seek=t._start||0,t._rateSeek=0,this._clearTimer(t._id),this._cleanBuffer(t._node),o._autoSuspend()),this._webAudio||i||this.stop(t._id,!0),this},_clearTimer:function(t){if(this._endTimers[t]){if("function"!=typeof this._endTimers[t])clearTimeout(this._endTimers[t]);else{var e=this._soundById(t);e&&e._node&&e._node.removeEventListener("ended",this._endTimers[t],!1)}delete this._endTimers[t]}return this},_soundById:function(t){for(var e=0;e<this._sounds.length;e++)if(t===this._sounds[e]._id)return this._sounds[e];return null},_inactiveSound:function(){this._drain();for(var t=0;t<this._sounds.length;t++)if(this._sounds[t]._ended)return this._sounds[t].reset();return new a(this)},_drain:function(){var t=this._pool,e=0,i=0;if(!(this._sounds.length<t)){for(i=0;i<this._sounds.length;i++)this._sounds[i]._ended&&e++;for(i=this._sounds.length-1;i>=0;i--){if(e<=t)return;this._sounds[i]._ended&&(this._webAudio&&this._sounds[i]._node&&this._sounds[i]._node.disconnect(0),this._sounds.splice(i,1),e--)}}},_getSoundIds:function(t){if(void 0===t){for(var e=[],i=0;i<this._sounds.length;i++)e.push(this._sounds[i]._id);return e}return[t]},_refreshBuffer:function(t){return t._node.bufferSource=o.ctx.createBufferSource(),t._node.bufferSource.buffer=l[this._src],t._panner?t._node.bufferSource.connect(t._panner):t._node.bufferSource.connect(t._node),t._node.bufferSource.loop=t._loop,t._loop&&(t._node.bufferSource.loopStart=t._start||0,t._node.bufferSource.loopEnd=t._stop||0),t._node.bufferSource.playbackRate.setValueAtTime(t._rate,o.ctx.currentTime),this},_cleanBuffer:function(t){var e=o._navigator&&o._navigator.vendor.indexOf("Apple")>=0;if(o._scratchBuffer&&t.bufferSource&&(t.bufferSource.onended=null,t.bufferSource.disconnect(0),e))try{t.bufferSource.buffer=o._scratchBuffer}catch(t){}return t.bufferSource=null,this},_clearSound:function(t){/MSIE |Trident\//.test(o._navigator&&o._navigator.userAgent)||(t.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var a=function(t){this._parent=t,this.init()};a.prototype={init:function(){var t=this._parent;return this._muted=t._muted,this._loop=t._loop,this._volume=t._volume,this._rate=t._rate,this._seek=0,this._paused=!0,this._ended=!0,this._sprite="__default",this._id=++o._counter,t._sounds.push(this),this.create(),this},create:function(){var t=this._parent,e=o._muted||this._muted||this._parent._muted?0:this._volume;return t._webAudio?(this._node=void 0===o.ctx.createGain?o.ctx.createGainNode():o.ctx.createGain(),this._node.gain.setValueAtTime(e,o.ctx.currentTime),this._node.paused=!0,this._node.connect(o.masterGain)):o.noAudio||(this._node=o._obtainHtml5Audio(),this._errorFn=this._errorListener.bind(this),this._node.addEventListener("error",this._errorFn,!1),this._loadFn=this._loadListener.bind(this),this._node.addEventListener(o._canPlayEvent,this._loadFn,!1),this._node.src=t._src,this._node.preload=!0===t._preload?"auto":t._preload,this._node.volume=e*o.volume(),this._node.load()),this},reset:function(){var t=this._parent;return this._muted=t._muted,this._loop=t._loop,this._volume=t._volume,this._rate=t._rate,this._seek=0,this._rateSeek=0,this._paused=!0,this._ended=!0,this._sprite="__default",this._id=++o._counter,this},_errorListener:function(){this._parent._emit("loaderror",this._id,this._node.error?this._node.error.code:0),this._node.removeEventListener("error",this._errorFn,!1)},_loadListener:function(){var t=this._parent;t._duration=Math.ceil(10*this._node.duration)/10,0===Object.keys(t._sprite).length&&(t._sprite={__default:[0,1e3*t._duration]}),"loaded"!==t._state&&(t._state="loaded",t._emit("load"),t._loadQueue()),this._node.removeEventListener(o._canPlayEvent,this._loadFn,!1)}};var l={},h=function(t){var e=t._src;if(l[e])return t._duration=l[e].duration,void d(t);if(/^data:[^;]+;base64,/.test(e)){for(var i=atob(e.split(",")[1]),n=new Uint8Array(i.length),s=0;s<i.length;++s)n[s]=i.charCodeAt(s);u(n.buffer,t)}else{var o=new XMLHttpRequest;o.open(t._xhr.method,e,!0),o.withCredentials=t._xhr.withCredentials,o.responseType="arraybuffer",t._xhr.headers&&Object.keys(t._xhr.headers).forEach((function(e){o.setRequestHeader(e,t._xhr.headers[e])})),o.onload=function(){var e=(o.status+"")[0];"0"===e||"2"===e||"3"===e?u(o.response,t):t._emit("loaderror",null,"Failed loading audio file with status: "+o.status+".")},o.onerror=function(){t._webAudio&&(t._html5=!0,t._webAudio=!1,t._sounds=[],delete l[e],t.load())},c(o)}},c=function(t){try{t.send()}catch(e){t.onerror()}},u=function(t,e){var i=function(){e._emit("loaderror",null,"Decoding audio data failed.")},n=function(t){t&&e._sounds.length>0?(l[e._src]=t,d(e,t)):i()};"undefined"!=typeof Promise&&1===o.ctx.decodeAudioData.length?o.ctx.decodeAudioData(t).then(n).catch(i):o.ctx.decodeAudioData(t,n,i)},d=function(t,e){e&&!t._duration&&(t._duration=e.duration),0===Object.keys(t._sprite).length&&(t._sprite={__default:[0,1e3*t._duration]}),"loaded"!==t._state&&(t._state="loaded",t._emit("load"),t._loadQueue())},p=function(){if(o.usingWebAudio){try{"undefined"!=typeof AudioContext?o.ctx=new AudioContext:"undefined"!=typeof webkitAudioContext?o.ctx=new webkitAudioContext:o.usingWebAudio=!1}catch(t){o.usingWebAudio=!1}o.ctx||(o.usingWebAudio=!1);var t=/iP(hone|od|ad)/.test(o._navigator&&o._navigator.platform),e=o._navigator&&o._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),i=e?parseInt(e[1],10):null;if(t&&i&&i<9){var n=/safari/.test(o._navigator&&o._navigator.userAgent.toLowerCase());o._navigator&&!n&&(o.usingWebAudio=!1)}o.usingWebAudio&&(o.masterGain=void 0===o.ctx.createGain?o.ctx.createGainNode():o.ctx.createGain(),o.masterGain.gain.setValueAtTime(o._muted?0:o._volume,o.ctx.currentTime),o.masterGain.connect(o.ctx.destination)),o._setup()}};void 0===(n=function(){return{Howler:o,Howl:r}}.apply(e,[]))||(t.exports=n),e.Howler=o,e.Howl=r,void 0!==i?(i.HowlerGlobal=s,i.Howler=o,i.Howl=r,i.Sound=a):"undefined"!=typeof window&&(window.HowlerGlobal=s,window.Howler=o,window.Howl=r,window.Sound=a)}(),
/*!
 *  Spatial Plugin - Adds support for stereo and 3D audio where Web Audio is supported.
 *  
 *  howler.js v2.2.0
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */
function(){"use strict";var t;HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(t){if(!this.ctx||!this.ctx.listener)return this;for(var e=this._howls.length-1;e>=0;e--)this._howls[e].stereo(t);return this},HowlerGlobal.prototype.pos=function(t,e,i){return this.ctx&&this.ctx.listener?(e="number"!=typeof e?this._pos[1]:e,i="number"!=typeof i?this._pos[2]:i,"number"!=typeof t?this._pos:(this._pos=[t,e,i],void 0!==this.ctx.listener.positionX?(this.ctx.listener.positionX.setTargetAtTime(this._pos[0],Howler.ctx.currentTime,.1),this.ctx.listener.positionY.setTargetAtTime(this._pos[1],Howler.ctx.currentTime,.1),this.ctx.listener.positionZ.setTargetAtTime(this._pos[2],Howler.ctx.currentTime,.1)):this.ctx.listener.setPosition(this._pos[0],this._pos[1],this._pos[2]),this)):this},HowlerGlobal.prototype.orientation=function(t,e,i,n,s,o){if(!this.ctx||!this.ctx.listener)return this;var r=this._orientation;return e="number"!=typeof e?r[1]:e,i="number"!=typeof i?r[2]:i,n="number"!=typeof n?r[3]:n,s="number"!=typeof s?r[4]:s,o="number"!=typeof o?r[5]:o,"number"!=typeof t?r:(this._orientation=[t,e,i,n,s,o],void 0!==this.ctx.listener.forwardX?(this.ctx.listener.forwardX.setTargetAtTime(t,Howler.ctx.currentTime,.1),this.ctx.listener.forwardY.setTargetAtTime(e,Howler.ctx.currentTime,.1),this.ctx.listener.forwardZ.setTargetAtTime(i,Howler.ctx.currentTime,.1),this.ctx.listener.upX.setTargetAtTime(n,Howler.ctx.currentTime,.1),this.ctx.listener.upY.setTargetAtTime(s,Howler.ctx.currentTime,.1),this.ctx.listener.upZ.setTargetAtTime(o,Howler.ctx.currentTime,.1)):this.ctx.listener.setOrientation(t,e,i,n,s,o),this)},Howl.prototype.init=(t=Howl.prototype.init,function(e){return this._orientation=e.orientation||[1,0,0],this._stereo=e.stereo||null,this._pos=e.pos||null,this._pannerAttr={coneInnerAngle:void 0!==e.coneInnerAngle?e.coneInnerAngle:360,coneOuterAngle:void 0!==e.coneOuterAngle?e.coneOuterAngle:360,coneOuterGain:void 0!==e.coneOuterGain?e.coneOuterGain:0,distanceModel:void 0!==e.distanceModel?e.distanceModel:"inverse",maxDistance:void 0!==e.maxDistance?e.maxDistance:1e4,panningModel:void 0!==e.panningModel?e.panningModel:"HRTF",refDistance:void 0!==e.refDistance?e.refDistance:1,rolloffFactor:void 0!==e.rolloffFactor?e.rolloffFactor:1},this._onstereo=e.onstereo?[{fn:e.onstereo}]:[],this._onpos=e.onpos?[{fn:e.onpos}]:[],this._onorientation=e.onorientation?[{fn:e.onorientation}]:[],t.call(this,e)}),Howl.prototype.stereo=function(t,i){var n=this;if(!n._webAudio)return n;if("loaded"!==n._state)return n._queue.push({event:"stereo",action:function(){n.stereo(t,i)}}),n;var s=void 0===Howler.ctx.createStereoPanner?"spatial":"stereo";if(void 0===i){if("number"!=typeof t)return n._stereo;n._stereo=t,n._pos=[t,0,0]}for(var o=n._getSoundIds(i),r=0;r<o.length;r++){var a=n._soundById(o[r]);if(a){if("number"!=typeof t)return a._stereo;a._stereo=t,a._pos=[t,0,0],a._node&&(a._pannerAttr.panningModel="equalpower",a._panner&&a._panner.pan||e(a,s),"spatial"===s?void 0!==a._panner.positionX?(a._panner.positionX.setValueAtTime(t,Howler.ctx.currentTime),a._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),a._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):a._panner.setPosition(t,0,0):a._panner.pan.setValueAtTime(t,Howler.ctx.currentTime)),n._emit("stereo",a._id)}}return n},Howl.prototype.pos=function(t,i,n,s){var o=this;if(!o._webAudio)return o;if("loaded"!==o._state)return o._queue.push({event:"pos",action:function(){o.pos(t,i,n,s)}}),o;if(i="number"!=typeof i?0:i,n="number"!=typeof n?-.5:n,void 0===s){if("number"!=typeof t)return o._pos;o._pos=[t,i,n]}for(var r=o._getSoundIds(s),a=0;a<r.length;a++){var l=o._soundById(r[a]);if(l){if("number"!=typeof t)return l._pos;l._pos=[t,i,n],l._node&&(l._panner&&!l._panner.pan||e(l,"spatial"),void 0!==l._panner.positionX?(l._panner.positionX.setValueAtTime(t,Howler.ctx.currentTime),l._panner.positionY.setValueAtTime(i,Howler.ctx.currentTime),l._panner.positionZ.setValueAtTime(n,Howler.ctx.currentTime)):l._panner.setPosition(t,i,n)),o._emit("pos",l._id)}}return o},Howl.prototype.orientation=function(t,i,n,s){var o=this;if(!o._webAudio)return o;if("loaded"!==o._state)return o._queue.push({event:"orientation",action:function(){o.orientation(t,i,n,s)}}),o;if(i="number"!=typeof i?o._orientation[1]:i,n="number"!=typeof n?o._orientation[2]:n,void 0===s){if("number"!=typeof t)return o._orientation;o._orientation=[t,i,n]}for(var r=o._getSoundIds(s),a=0;a<r.length;a++){var l=o._soundById(r[a]);if(l){if("number"!=typeof t)return l._orientation;l._orientation=[t,i,n],l._node&&(l._panner||(l._pos||(l._pos=o._pos||[0,0,-.5]),e(l,"spatial")),void 0!==l._panner.orientationX?(l._panner.orientationX.setValueAtTime(t,Howler.ctx.currentTime),l._panner.orientationY.setValueAtTime(i,Howler.ctx.currentTime),l._panner.orientationZ.setValueAtTime(n,Howler.ctx.currentTime)):l._panner.setOrientation(t,i,n)),o._emit("orientation",l._id)}}return o},Howl.prototype.pannerAttr=function(){var t,i,n,s=this,o=arguments;if(!s._webAudio)return s;if(0===o.length)return s._pannerAttr;if(1===o.length){if("object"!=typeof o[0])return(n=s._soundById(parseInt(o[0],10)))?n._pannerAttr:s._pannerAttr;t=o[0],void 0===i&&(t.pannerAttr||(t.pannerAttr={coneInnerAngle:t.coneInnerAngle,coneOuterAngle:t.coneOuterAngle,coneOuterGain:t.coneOuterGain,distanceModel:t.distanceModel,maxDistance:t.maxDistance,refDistance:t.refDistance,rolloffFactor:t.rolloffFactor,panningModel:t.panningModel}),s._pannerAttr={coneInnerAngle:void 0!==t.pannerAttr.coneInnerAngle?t.pannerAttr.coneInnerAngle:s._coneInnerAngle,coneOuterAngle:void 0!==t.pannerAttr.coneOuterAngle?t.pannerAttr.coneOuterAngle:s._coneOuterAngle,coneOuterGain:void 0!==t.pannerAttr.coneOuterGain?t.pannerAttr.coneOuterGain:s._coneOuterGain,distanceModel:void 0!==t.pannerAttr.distanceModel?t.pannerAttr.distanceModel:s._distanceModel,maxDistance:void 0!==t.pannerAttr.maxDistance?t.pannerAttr.maxDistance:s._maxDistance,refDistance:void 0!==t.pannerAttr.refDistance?t.pannerAttr.refDistance:s._refDistance,rolloffFactor:void 0!==t.pannerAttr.rolloffFactor?t.pannerAttr.rolloffFactor:s._rolloffFactor,panningModel:void 0!==t.pannerAttr.panningModel?t.pannerAttr.panningModel:s._panningModel})}else 2===o.length&&(t=o[0],i=parseInt(o[1],10));for(var r=s._getSoundIds(i),a=0;a<r.length;a++)if(n=s._soundById(r[a])){var l=n._pannerAttr;l={coneInnerAngle:void 0!==t.coneInnerAngle?t.coneInnerAngle:l.coneInnerAngle,coneOuterAngle:void 0!==t.coneOuterAngle?t.coneOuterAngle:l.coneOuterAngle,coneOuterGain:void 0!==t.coneOuterGain?t.coneOuterGain:l.coneOuterGain,distanceModel:void 0!==t.distanceModel?t.distanceModel:l.distanceModel,maxDistance:void 0!==t.maxDistance?t.maxDistance:l.maxDistance,refDistance:void 0!==t.refDistance?t.refDistance:l.refDistance,rolloffFactor:void 0!==t.rolloffFactor?t.rolloffFactor:l.rolloffFactor,panningModel:void 0!==t.panningModel?t.panningModel:l.panningModel};var h=n._panner;h?(h.coneInnerAngle=l.coneInnerAngle,h.coneOuterAngle=l.coneOuterAngle,h.coneOuterGain=l.coneOuterGain,h.distanceModel=l.distanceModel,h.maxDistance=l.maxDistance,h.refDistance=l.refDistance,h.rolloffFactor=l.rolloffFactor,h.panningModel=l.panningModel):(n._pos||(n._pos=s._pos||[0,0,-.5]),e(n,"spatial"))}return s},Sound.prototype.init=function(t){return function(){var e=this._parent;this._orientation=e._orientation,this._stereo=e._stereo,this._pos=e._pos,this._pannerAttr=e._pannerAttr,t.call(this),this._stereo?e.stereo(this._stereo):this._pos&&e.pos(this._pos[0],this._pos[1],this._pos[2],this._id)}}(Sound.prototype.init),Sound.prototype.reset=function(t){return function(){var e=this._parent;return this._orientation=e._orientation,this._stereo=e._stereo,this._pos=e._pos,this._pannerAttr=e._pannerAttr,this._stereo?e.stereo(this._stereo):this._pos?e.pos(this._pos[0],this._pos[1],this._pos[2],this._id):this._panner&&(this._panner.disconnect(0),this._panner=void 0,e._refreshBuffer(this)),t.call(this)}}(Sound.prototype.reset);var e=function(t,e){"spatial"===(e=e||"spatial")?(t._panner=Howler.ctx.createPanner(),t._panner.coneInnerAngle=t._pannerAttr.coneInnerAngle,t._panner.coneOuterAngle=t._pannerAttr.coneOuterAngle,t._panner.coneOuterGain=t._pannerAttr.coneOuterGain,t._panner.distanceModel=t._pannerAttr.distanceModel,t._panner.maxDistance=t._pannerAttr.maxDistance,t._panner.refDistance=t._pannerAttr.refDistance,t._panner.rolloffFactor=t._pannerAttr.rolloffFactor,t._panner.panningModel=t._pannerAttr.panningModel,void 0!==t._panner.positionX?(t._panner.positionX.setValueAtTime(t._pos[0],Howler.ctx.currentTime),t._panner.positionY.setValueAtTime(t._pos[1],Howler.ctx.currentTime),t._panner.positionZ.setValueAtTime(t._pos[2],Howler.ctx.currentTime)):t._panner.setPosition(t._pos[0],t._pos[1],t._pos[2]),void 0!==t._panner.orientationX?(t._panner.orientationX.setValueAtTime(t._orientation[0],Howler.ctx.currentTime),t._panner.orientationY.setValueAtTime(t._orientation[1],Howler.ctx.currentTime),t._panner.orientationZ.setValueAtTime(t._orientation[2],Howler.ctx.currentTime)):t._panner.setOrientation(t._orientation[0],t._orientation[1],t._orientation[2])):(t._panner=Howler.ctx.createStereoPanner(),t._panner.pan.setValueAtTime(t._stereo,Howler.ctx.currentTime)),t._panner.connect(t._node),t._paused||t._parent.pause(t._id,!0).play(t._id,!0)}}()}).call(this,i(10))},function(t,e,i){"use strict";function n(t,e){return(t%e+e)%e}function s(t,e=0,i=1){return t<e?e:t>i?i:t}function o(t){return t.charAt(0).toUpperCase()+t.substring(1)}function r(t,...e){let i=r.map;return t.replace(/%(?:([a-z]+)|(?:{([^}]+)}))/gi,(function(n,s,r,a){if("%"==t.charAt(a-1))return n.substring(1);if(!e.length)return n;let l=e[0],h=(s||r).split(","),c=h.shift()||"",u=i[c.toLowerCase()];if(!u)return n;l=e.shift();let d=l[u].apply(l,h),p=c.charAt(0);return p!=p.toLowerCase()&&(d=o(d)),d}))}i.r(e),i.d(e,"mod",(function(){return n})),i.d(e,"clamp",(function(){return s})),i.d(e,"capitalize",(function(){return o})),i.d(e,"format",(function(){return r})),r.map={s:"toString"}},function(t,e,i){"use strict";i.r(e),i.d(e,"fromString",(function(){return o})),i.d(e,"add",(function(){return r})),i.d(e,"add_",(function(){return a})),i.d(e,"multiply",(function(){return l})),i.d(e,"multiply_",(function(){return h})),i.d(e,"interpolate",(function(){return c})),i.d(e,"lerp",(function(){return u})),i.d(e,"interpolateHSL",(function(){return d})),i.d(e,"lerpHSL",(function(){return p})),i.d(e,"randomize",(function(){return _})),i.d(e,"rgb2hsl",(function(){return f})),i.d(e,"hsl2rgb",(function(){return g})),i.d(e,"toRGB",(function(){return y})),i.d(e,"toHex",(function(){return v}));var n=i(2),s=i(0);function o(t){let e,i;if(t in w)e=w[t];else{if("#"==t.charAt(0)){let i=(t.match(/[0-9a-f]/gi)||[]).map(t=>parseInt(t,16));if(3==i.length)e=i.map(t=>17*t);else{for(let t=0;t<3;t++)i[t+1]+=16*i[t],i.splice(t,1);e=i}}else e=(i=t.match(/rgb\(([0-9, ]+)\)/i))?i[1].split(/\s*,\s*/).map(t=>parseInt(t)):[0,0,0];w[t]=e}return e.slice()}function r(t,...e){let i=t.slice();for(let t=0;t<3;t++)for(let n=0;n<e.length;n++)i[t]+=e[n][t];return i}function a(t,...e){for(let i=0;i<3;i++)for(let n=0;n<e.length;n++)t[i]+=e[n][i];return t}function l(t,...e){let i=t.slice();for(let t=0;t<3;t++){for(let n=0;n<e.length;n++)i[t]*=e[n][t]/255;i[t]=Math.round(i[t])}return i}function h(t,...e){for(let i=0;i<3;i++){for(let n=0;n<e.length;n++)t[i]*=e[n][i]/255;t[i]=Math.round(t[i])}return t}function c(t,e,i=.5){let n=t.slice();for(let s=0;s<3;s++)n[s]=Math.round(n[s]+i*(e[s]-t[s]));return n}const u=c;function d(t,e,i=.5){let n=f(t),s=f(e);for(let t=0;t<3;t++)n[t]+=i*(s[t]-n[t]);return g(n)}const p=d;function _(t,e){e instanceof Array||(e=Math.round(s.a.getNormal(0,e)));let i=t.slice();for(let t=0;t<3;t++)i[t]+=e instanceof Array?Math.round(s.a.getNormal(0,e[t])):e;return i}function f(t){let e,i=t[0]/255,n=t[1]/255,s=t[2]/255,o=Math.max(i,n,s),r=Math.min(i,n,s),a=0,l=(o+r)/2;if(o==r)e=0;else{let t=o-r;switch(e=l>.5?t/(2-o-r):t/(o+r),o){case i:a=(n-s)/t+(n<s?6:0);break;case n:a=(s-i)/t+2;break;case s:a=(i-n)/t+4}a/=6}return[a,e,l]}function m(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t}function g(t){let e=t[2];if(0==t[1])return e=Math.round(255*e),[e,e,e];{let i=t[1],n=e<.5?e*(1+i):e+i-e*i,s=2*e-n,o=m(s,n,t[0]+1/3),r=m(s,n,t[0]),a=m(s,n,t[0]-1/3);return[Math.round(255*o),Math.round(255*r),Math.round(255*a)]}}function y(t){return`rgb(${t.map(t=>Object(n.clamp)(t,0,255)).join(",")})`}function v(t){return"#"+t.map(t=>Object(n.clamp)(t,0,255).toString(16).padStart(2,"0")).join("")}const w={black:[0,0,0],navy:[0,0,128],darkblue:[0,0,139],mediumblue:[0,0,205],blue:[0,0,255],darkgreen:[0,100,0],green:[0,128,0],teal:[0,128,128],darkcyan:[0,139,139],deepskyblue:[0,191,255],darkturquoise:[0,206,209],mediumspringgreen:[0,250,154],lime:[0,255,0],springgreen:[0,255,127],aqua:[0,255,255],cyan:[0,255,255],midnightblue:[25,25,112],dodgerblue:[30,144,255],forestgreen:[34,139,34],seagreen:[46,139,87],darkslategray:[47,79,79],darkslategrey:[47,79,79],limegreen:[50,205,50],mediumseagreen:[60,179,113],turquoise:[64,224,208],royalblue:[65,105,225],steelblue:[70,130,180],darkslateblue:[72,61,139],mediumturquoise:[72,209,204],indigo:[75,0,130],darkolivegreen:[85,107,47],cadetblue:[95,158,160],cornflowerblue:[100,149,237],mediumaquamarine:[102,205,170],dimgray:[105,105,105],dimgrey:[105,105,105],slateblue:[106,90,205],olivedrab:[107,142,35],slategray:[112,128,144],slategrey:[112,128,144],lightslategray:[119,136,153],lightslategrey:[119,136,153],mediumslateblue:[123,104,238],lawngreen:[124,252,0],chartreuse:[127,255,0],aquamarine:[127,255,212],maroon:[128,0,0],purple:[128,0,128],olive:[128,128,0],gray:[128,128,128],grey:[128,128,128],skyblue:[135,206,235],lightskyblue:[135,206,250],blueviolet:[138,43,226],darkred:[139,0,0],darkmagenta:[139,0,139],saddlebrown:[139,69,19],darkseagreen:[143,188,143],lightgreen:[144,238,144],mediumpurple:[147,112,216],darkviolet:[148,0,211],palegreen:[152,251,152],darkorchid:[153,50,204],yellowgreen:[154,205,50],sienna:[160,82,45],brown:[165,42,42],darkgray:[169,169,169],darkgrey:[169,169,169],lightblue:[173,216,230],greenyellow:[173,255,47],paleturquoise:[175,238,238],lightsteelblue:[176,196,222],powderblue:[176,224,230],firebrick:[178,34,34],darkgoldenrod:[184,134,11],mediumorchid:[186,85,211],rosybrown:[188,143,143],darkkhaki:[189,183,107],silver:[192,192,192],mediumvioletred:[199,21,133],indianred:[205,92,92],peru:[205,133,63],chocolate:[210,105,30],tan:[210,180,140],lightgray:[211,211,211],lightgrey:[211,211,211],palevioletred:[216,112,147],thistle:[216,191,216],orchid:[218,112,214],goldenrod:[218,165,32],crimson:[220,20,60],gainsboro:[220,220,220],plum:[221,160,221],burlywood:[222,184,135],lightcyan:[224,255,255],lavender:[230,230,250],darksalmon:[233,150,122],violet:[238,130,238],palegoldenrod:[238,232,170],lightcoral:[240,128,128],khaki:[240,230,140],aliceblue:[240,248,255],honeydew:[240,255,240],azure:[240,255,255],sandybrown:[244,164,96],wheat:[245,222,179],beige:[245,245,220],whitesmoke:[245,245,245],mintcream:[245,255,250],ghostwhite:[248,248,255],salmon:[250,128,114],antiquewhite:[250,235,215],linen:[250,240,230],lightgoldenrodyellow:[250,250,210],oldlace:[253,245,230],red:[255,0,0],fuchsia:[255,0,255],magenta:[255,0,255],deeppink:[255,20,147],orangered:[255,69,0],tomato:[255,99,71],hotpink:[255,105,180],coral:[255,127,80],darkorange:[255,140,0],lightsalmon:[255,160,122],orange:[255,165,0],lightpink:[255,182,193],pink:[255,192,203],gold:[255,215,0],peachpuff:[255,218,185],navajowhite:[255,222,173],moccasin:[255,228,181],bisque:[255,228,196],mistyrose:[255,228,225],blanchedalmond:[255,235,205],papayawhip:[255,239,213],lavenderblush:[255,240,245],seashell:[255,245,238],cornsilk:[255,248,220],lemonchiffon:[255,250,205],floralwhite:[255,250,240],snow:[255,250,250],yellow:[255,255,0],lightyellow:[255,255,224],ivory:[255,255,240],white:[255,255,255]}},function(t,e,i){"use strict";i.d(e,"a",(function(){return n}));class n{getContainer(){return null}setOptions(t){this._options=t}}},function(t,e,i){const{Game:n}=i(8),{SpriteSheet:s}=i(9);t.exports={Game:n,SpriteSheet:s}},function(t,e,i){"use strict";(function(t){i.d(e,"a",(function(){return r}));var n=i(4),s=i(3);function o(t){let e=s.fromString(t);return 36*Math.floor(e[0]*(6/256))+6*Math.floor(e[1]*(6/256))+1*Math.floor(e[2]*(6/256))+16}class r extends n.a{constructor(){super(),this._offset=[0,0],this._cursor=[-1,-1],this._lastColor=""}schedule(t){setTimeout(t,1e3/60)}setOptions(t){super.setOptions(t);let e=[t.width,t.height],i=this.computeSize();this._offset=i.map((t,i)=>Math.floor((t-e[i])/2))}clear(){t.stdout.write(`[0;48;5;${o(this._options.bg)}m[2J`)}draw(e,i){let[n,s,r,a,l]=e,h=this._offset[0]+n,c=this._offset[1]+s,u=this.computeSize();if(h<0||h>=u[0])return;if(c<0||c>=u[1])return;if(h===this._cursor[0]&&c===this._cursor[1]||(t.stdout.write(function(t,e){return`[${e+1};${t+1}H`}(h,c)),this._cursor[0]=h,this._cursor[1]=c),i&&(r||(r=" ")),!r)return;let d=function(t,e){return`[0;38;5;${o(t)};48;5;${o(e)}m`}(a,l);if(d!==this._lastColor&&(t.stdout.write(d),this._lastColor=d),"\t"!=r){let e=[].concat(r);t.stdout.write(e[0])}this._cursor[0]++,this._cursor[0]>=u[0]&&(this._cursor[0]=0,this._cursor[1]++)}computeFontSize(){throw new Error("Terminal backend has no notion of font size")}eventToPosition(t,e){return[t,e]}computeSize(){return[t.stdout.columns,t.stdout.rows]}}}).call(this,i(7))},function(t,e){var i,n,s=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function a(t){if(i===setTimeout)return setTimeout(t,0);if((i===o||!i)&&setTimeout)return i=setTimeout,setTimeout(t,0);try{return i(t,0)}catch(e){try{return i.call(null,t,0)}catch(e){return i.call(this,t,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:o}catch(t){i=o}try{n="function"==typeof clearTimeout?clearTimeout:r}catch(t){n=r}}();var l,h=[],c=!1,u=-1;function d(){c&&l&&(c=!1,l.length?h=l.concat(h):u=-1,h.length&&p())}function p(){if(!c){var t=a(d);c=!0;for(var e=h.length;e;){for(l=h,h=[];++u<e;)l&&l[u].run();u=-1,e=h.length}l=null,c=!1,function(t){if(n===clearTimeout)return clearTimeout(t);if((n===r||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(t);try{n(t)}catch(e){try{return n.call(null,t)}catch(e){return n.call(this,t)}}}(t)}}function _(t,e){this.fun=t,this.array=e}function f(){}s.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];h.push(new _(t,e)),1!==h.length||c||a(p)},_.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=f,s.addListener=f,s.once=f,s.off=f,s.removeListener=f,s.removeAllListeners=f,s.emit=f,s.prependListener=f,s.prependOnceListener=f,s.listeners=function(t){return[]},s.binding=function(t){throw new Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(t){throw new Error("process.chdir is not supported")},s.umask=function(){return 0}},function(t,e){t.exports={Game:class{constructor({width:t,height:e,scale:i=1,parent:n="game",imageSmoothing:s=!1}){this.width=t,this.height=e,this.parent=document.getElementById(n),this.canvas=document.createElement("canvas"),this.canvas.width=this.width*i,this.canvas.height=this.height*i,this.context=this.canvas.getContext("2d"),this.context.scale(i,i),this.context.imageSmoothingEnabled=s,this.parent.appendChild(this.canvas),this.oldTimeStamp=0,this.running=!1}update(){throw new Error("must implement `update` function")}draw(){throw new Error("must implement `draw` function")}start(){window.requestAnimationFrame(this.gameLoop.bind(this)),this.running=!0}stop(){this.running=!1}gameLoop(t){const e=t-this.oldTimeStamp;this.oldTimeStamp=t,this.update(e/1e3),this.draw(),this.running&&window.requestAnimationFrame(this.gameLoop.bind(this))}}}},function(t,e){class i{constructor(t,e,i,n,s,o){this.context=t,this.img=e,this.x=i,this.y=n,this.w=s,this.h=o}draw(t,e,i,n){this.context.drawImage(this.img,this.x,this.y,this.w,this.h,t,e,i,n)}}class n{constructor({frames:t,duration:e,loop:i=!0,onComplete:n=(()=>{})}){this.frames=t,this.currentFrame=0,this.time=0,this.duration=e,this.loop=i,this.onComplete=n,this.running=!0}advanceFrame(){this.currentFrame++,this.loop?this.currentFrame=this.currentFrame%this.frames.length:this.currentFrame==this.frames.length-1&&(this.running=!1,this.onComplete())}update(t){this.time+=t,this.time>this.duration&&this.running&&(this.time=0,this.advanceFrame())}draw(t,e,i,n){this.frames[this.currentFrame].draw(t,e,i,n)}}t.exports={SpriteSheet:class{constructor({path:t,context:e,colSize:i,rowSize:n,margin:s=0}){this.context=e,this.colSize=i,this.rowSize=n,this.margin=s,this.image=new Image,this.image.src=t,this.image.onload=()=>{}}createSprite(t,e,n,s){return new i(this.context,this.image,t,e,n,s)}getSprite(t,e){return new i(this.context,this.image,this.colSize*t+this.margin*t,this.rowSize*e+this.margin*e,this.colSize,this.rowSize)}getAnimatedSprite({frames:t,duration:e,loop:i,onComplete:s}){const o=t.map(([t,e])=>this.getSprite(t,e));return new n({onComplete:s,loop:i,context:this.context,image:this.image,frames:o,duration:e})}}}},function(t,e){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(t){"object"==typeof window&&(i=window)}t.exports=i},function(t,e,i){"use strict";i.r(e);var n={};function s(t,e,i=(()=>{}),n=(()=>{})){return{name:t,transitions:e,enter:i,exit:n}}i.r(n),i.d(n,"TYPE_TEXT",(function(){return x})),i.d(n,"TYPE_NEWLINE",(function(){return b})),i.d(n,"TYPE_FG",(function(){return T})),i.d(n,"TYPE_BG",(function(){return A})),i.d(n,"measure",(function(){return k})),i.d(n,"tokenize",(function(){return S}));var o=i(0),r=i(4);class a extends r.a{constructor(){super(),this._ctx=document.createElement("canvas").getContext("2d")}schedule(t){requestAnimationFrame(t)}getContainer(){return this._ctx.canvas}setOptions(t){super.setOptions(t);const e=`${t.fontStyle?t.fontStyle+" ":""} ${t.fontSize}px ${t.fontFamily}`;this._ctx.font=e,this._updateSize(),this._ctx.font=e,this._ctx.textAlign="center",this._ctx.textBaseline="middle"}clear(){this._ctx.fillStyle=this._options.bg,this._ctx.fillRect(0,0,this._ctx.canvas.width,this._ctx.canvas.height)}eventToPosition(t,e){let i=this._ctx.canvas,n=i.getBoundingClientRect();return t-=n.left,e-=n.top,t*=i.width/n.width,e*=i.height/n.height,t<0||e<0||t>=i.width||e>=i.height?[-1,-1]:this._normalizedEventToPosition(t,e)}}var l=i(2);class h extends a{constructor(){super(),this._spacingX=0,this._spacingY=0,this._hexSize=0}draw(t,e){let[i,n,s,o,r]=t,a=[(i+1)*this._spacingX,n*this._spacingY+this._hexSize];if(this._options.transpose&&a.reverse(),e&&(this._ctx.fillStyle=r,this._fill(a[0],a[1])),!s)return;this._ctx.fillStyle=o;let l=[].concat(s);for(let t=0;t<l.length;t++)this._ctx.fillText(l[t],a[0],Math.ceil(a[1]))}computeSize(t,e){return this._options.transpose&&(t+=e,t-=e=t-e),[Math.floor(t/this._spacingX)-1,Math.floor((e-2*this._hexSize)/this._spacingY+1)]}computeFontSize(t,e){this._options.transpose&&(t+=e,t-=e=t-e);let i=2*t/((this._options.width+1)*Math.sqrt(3))-1,n=e/(2+1.5*(this._options.height-1)),s=Math.min(i,n),o=this._ctx.font;this._ctx.font="100px "+this._options.fontFamily;let r=Math.ceil(this._ctx.measureText("W").width);this._ctx.font=o;let a=r/100;s=Math.floor(s)+1;let l=2*s/(this._options.spacing*(1+a/Math.sqrt(3)));return Math.ceil(l)-1}_normalizedEventToPosition(t,e){let i;this._options.transpose?(t+=e,t-=e=t-e,i=this._ctx.canvas.width):i=this._ctx.canvas.height;let n=i/this._options.height;return e=Math.floor(e/n),Object(l.mod)(e,2)?(t-=this._spacingX,t=1+2*Math.floor(t/(2*this._spacingX))):t=2*Math.floor(t/(2*this._spacingX)),[t,e]}_fill(t,e){let i=this._hexSize,n=this._options.border;const s=this._ctx;s.beginPath(),this._options.transpose?(s.moveTo(t-i+n,e),s.lineTo(t-i/2+n,e+this._spacingX-n),s.lineTo(t+i/2-n,e+this._spacingX-n),s.lineTo(t+i-n,e),s.lineTo(t+i/2-n,e-this._spacingX+n),s.lineTo(t-i/2+n,e-this._spacingX+n),s.lineTo(t-i+n,e)):(s.moveTo(t,e-i+n),s.lineTo(t+this._spacingX-n,e-i/2+n),s.lineTo(t+this._spacingX-n,e+i/2-n),s.lineTo(t,e+i-n),s.lineTo(t-this._spacingX+n,e+i/2-n),s.lineTo(t-this._spacingX+n,e-i/2+n),s.lineTo(t,e-i+n)),s.fill()}_updateSize(){const t=this._options,e=Math.ceil(this._ctx.measureText("W").width);let i,n;this._hexSize=Math.floor(t.spacing*(t.fontSize+e/Math.sqrt(3))/2),this._spacingX=this._hexSize*Math.sqrt(3)/2,this._spacingY=1.5*this._hexSize,t.transpose?(i="height",n="width"):(i="width",n="height"),this._ctx.canvas[i]=Math.ceil((t.width+1)*this._spacingX),this._ctx.canvas[n]=Math.ceil((t.height-1)*this._spacingY+2*this._hexSize)}}var c=(()=>{class t extends a{constructor(){super(),this._spacingX=0,this._spacingY=0,this._canvasCache={}}setOptions(t){super.setOptions(t),this._canvasCache={}}draw(e,i){t.cache?this._drawWithCache(e):this._drawNoCache(e,i)}_drawWithCache(t){let e,[i,n,s,o,r]=t,a=""+s+o+r;if(a in this._canvasCache)e=this._canvasCache[a];else{let t=this._options.border;e=document.createElement("canvas");let i=e.getContext("2d");if(e.width=this._spacingX,e.height=this._spacingY,i.fillStyle=r,i.fillRect(t,t,e.width-t,e.height-t),s){i.fillStyle=o,i.font=this._ctx.font,i.textAlign="center",i.textBaseline="middle";let t=[].concat(s);for(let e=0;e<t.length;e++)i.fillText(t[e],this._spacingX/2,Math.ceil(this._spacingY/2))}this._canvasCache[a]=e}this._ctx.drawImage(e,i*this._spacingX,n*this._spacingY)}_drawNoCache(t,e){let[i,n,s,o,r]=t;if(e){let t=this._options.border;this._ctx.fillStyle=r,this._ctx.fillRect(i*this._spacingX+t,n*this._spacingY+t,this._spacingX-t,this._spacingY-t)}if(!s)return;this._ctx.fillStyle=o;let a=[].concat(s);for(let t=0;t<a.length;t++)this._ctx.fillText(a[t],(i+.5)*this._spacingX,Math.ceil((n+.5)*this._spacingY))}computeSize(t,e){return[Math.floor(t/this._spacingX),Math.floor(e/this._spacingY)]}computeFontSize(t,e){let i=Math.floor(t/this._options.width),n=Math.floor(e/this._options.height),s=this._ctx.font;this._ctx.font="100px "+this._options.fontFamily;let o=Math.ceil(this._ctx.measureText("W").width);this._ctx.font=s;let r=o/100*n/i;return r>1&&(n=Math.floor(n/r)),Math.floor(n/this._options.spacing)}_normalizedEventToPosition(t,e){return[Math.floor(t/this._spacingX),Math.floor(e/this._spacingY)]}_updateSize(){const t=this._options,e=Math.ceil(this._ctx.measureText("W").width);this._spacingX=Math.ceil(t.spacing*e),this._spacingY=Math.ceil(t.spacing*t.fontSize),t.forceSquareRatio&&(this._spacingX=this._spacingY=Math.max(this._spacingX,this._spacingY)),this._ctx.canvas.width=t.width*this._spacingX,this._ctx.canvas.height=t.height*this._spacingY}}return t.cache=!1,t})();class u extends a{constructor(){super(),this._colorCanvas=document.createElement("canvas")}draw(t,e){let[i,n,s,o,r]=t,a=this._options.tileWidth,l=this._options.tileHeight;if(e&&(this._options.tileColorize?this._ctx.clearRect(i*a,n*l,a,l):(this._ctx.fillStyle=r,this._ctx.fillRect(i*a,n*l,a,l))),!s)return;let h=[].concat(s),c=[].concat(o),u=[].concat(r);for(let t=0;t<h.length;t++){let e=this._options.tileMap[h[t]];if(!e)throw new Error(`Char "${h[t]}" not found in tileMap`);if(this._options.tileColorize){let s=this._colorCanvas,o=s.getContext("2d");o.globalCompositeOperation="source-over",o.clearRect(0,0,a,l);let r=c[t],h=u[t];o.drawImage(this._options.tileSet,e[0],e[1],a,l,0,0,a,l),"transparent"!=r&&(o.fillStyle=r,o.globalCompositeOperation="source-atop",o.fillRect(0,0,a,l)),"transparent"!=h&&(o.fillStyle=h,o.globalCompositeOperation="destination-over",o.fillRect(0,0,a,l)),this._ctx.drawImage(s,i*a,n*l,a,l)}else this._ctx.drawImage(this._options.tileSet,e[0],e[1],a,l,i*a,n*l,a,l)}}computeSize(t,e){return[Math.floor(t/this._options.tileWidth),Math.floor(e/this._options.tileHeight)]}computeFontSize(){throw new Error("Tile backend does not understand font size")}_normalizedEventToPosition(t,e){return[Math.floor(t/this._options.tileWidth),Math.floor(e/this._options.tileHeight)]}_updateSize(){const t=this._options;this._ctx.canvas.width=t.width*t.tileWidth,this._ctx.canvas.height=t.height*t.tileHeight,this._colorCanvas.width=t.tileWidth,this._colorCanvas.height=t.tileHeight}}var d=i(3);class p extends r.a{constructor(){super(),this._uniforms={};try{this._gl=this._initWebGL()}catch(t){alert(t.message)}}static isSupported(){return!!document.createElement("canvas").getContext("webgl2",{preserveDrawingBuffer:!0})}schedule(t){requestAnimationFrame(t)}getContainer(){return this._gl.canvas}setOptions(t){super.setOptions(t),this._updateSize();let e=this._options.tileSet;e&&"complete"in e&&!e.complete?e.addEventListener("load",()=>this._updateTexture(e)):this._updateTexture(e)}draw(t,e){const i=this._gl,n=this._options;let[s,o,r,a,l]=t,h=i.canvas.height-(o+1)*n.tileHeight;if(i.scissor(s*n.tileWidth,h,n.tileWidth,n.tileHeight),e&&(n.tileColorize?i.clearColor(0,0,0,0):i.clearColor(...y(l)),i.clear(i.COLOR_BUFFER_BIT)),!r)return;let c=[].concat(r),u=[].concat(l),d=[].concat(a);i.uniform2fv(this._uniforms.targetPosRel,[s,o]);for(let t=0;t<c.length;t++){let e=this._options.tileMap[c[t]];if(!e)throw new Error(`Char "${c[t]}" not found in tileMap`);i.uniform1f(this._uniforms.colorize,n.tileColorize?1:0),i.uniform2fv(this._uniforms.tilesetPosAbs,e),n.tileColorize&&(i.uniform4fv(this._uniforms.tint,y(d[t])),i.uniform4fv(this._uniforms.bg,y(u[t]))),i.drawArrays(i.TRIANGLE_STRIP,0,4)}}clear(){const t=this._gl;t.clearColor(...y(this._options.bg)),t.scissor(0,0,t.canvas.width,t.canvas.height),t.clear(t.COLOR_BUFFER_BIT)}computeSize(t,e){return[Math.floor(t/this._options.tileWidth),Math.floor(e/this._options.tileHeight)]}computeFontSize(){throw new Error("Tile backend does not understand font size")}eventToPosition(t,e){let i=this._gl.canvas,n=i.getBoundingClientRect();return t-=n.left,e-=n.top,t*=i.width/n.width,e*=i.height/n.height,t<0||e<0||t>=i.width||e>=i.height?[-1,-1]:this._normalizedEventToPosition(t,e)}_initWebGL(){let t=document.createElement("canvas").getContext("webgl2",{preserveDrawingBuffer:!0});window.gl=t;let e=function(t,e,i){const n=t.createShader(t.VERTEX_SHADER);if(t.shaderSource(n,e),t.compileShader(n),!t.getShaderParameter(n,t.COMPILE_STATUS))throw new Error(t.getShaderInfoLog(n)||"");const s=t.createShader(t.FRAGMENT_SHADER);if(t.shaderSource(s,i),t.compileShader(s),!t.getShaderParameter(s,t.COMPILE_STATUS))throw new Error(t.getShaderInfoLog(s)||"");const o=t.createProgram();if(t.attachShader(o,n),t.attachShader(o,s),t.linkProgram(o),!t.getProgramParameter(o,t.LINK_STATUS))throw new Error(t.getProgramInfoLog(o)||"");return o}(t,f,m);return t.useProgram(e),function(t){const e=new Float32Array([0,0,1,0,0,1,1,1]),i=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,i),t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW),t.enableVertexAttribArray(0),t.vertexAttribPointer(0,2,t.FLOAT,!1,0,0)}(t),_.forEach(i=>this._uniforms[i]=t.getUniformLocation(e,i)),this._program=e,t.enable(t.BLEND),t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA),t.enable(t.SCISSOR_TEST),t}_normalizedEventToPosition(t,e){return[Math.floor(t/this._options.tileWidth),Math.floor(e/this._options.tileHeight)]}_updateSize(){const t=this._gl,e=this._options,i=[e.width*e.tileWidth,e.height*e.tileHeight];t.canvas.width=i[0],t.canvas.height=i[1],t.viewport(0,0,i[0],i[1]),t.uniform2fv(this._uniforms.tileSize,[e.tileWidth,e.tileHeight]),t.uniform2fv(this._uniforms.targetSize,i)}_updateTexture(t){!function(t,e){let i=t.createTexture();t.bindTexture(t.TEXTURE_2D,i),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,0),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e)}(this._gl,t)}}const _=["targetPosRel","tilesetPosAbs","tileSize","targetSize","colorize","bg","tint"],f="\n#version 300 es\n\nin vec2 tilePosRel;\nout vec2 tilesetPosPx;\n\nuniform vec2 tilesetPosAbs;\nuniform vec2 tileSize;\nuniform vec2 targetSize;\nuniform vec2 targetPosRel;\n\nvoid main() {\n\tvec2 targetPosPx = (targetPosRel + tilePosRel) * tileSize;\n\tvec2 targetPosNdc = ((targetPosPx / targetSize)-0.5)*2.0;\n\ttargetPosNdc.y *= -1.0;\n\n\tgl_Position = vec4(targetPosNdc, 0.0, 1.0);\n\ttilesetPosPx = tilesetPosAbs + tilePosRel * tileSize;\n}".trim(),m="\n#version 300 es\nprecision highp float;\n\nin vec2 tilesetPosPx;\nout vec4 fragColor;\nuniform sampler2D image;\nuniform bool colorize;\nuniform vec4 bg;\nuniform vec4 tint;\n\nvoid main() {\n\tfragColor = vec4(0, 0, 0, 1);\n\n\tvec4 texel = texelFetch(image, ivec2(tilesetPosPx), 0);\n\n\tif (colorize) {\n\t\ttexel.rgb = tint.a * tint.rgb + (1.0-tint.a) * texel.rgb;\n\t\tfragColor.rgb = texel.a*texel.rgb + (1.0-texel.a)*bg.rgb;\n\t\tfragColor.a = texel.a + (1.0-texel.a)*bg.a;\n\t} else {\n\t\tfragColor = texel;\n\t}\n}".trim();let g={};function y(t){if(!(t in g)){let e;if("transparent"==t)e=[0,0,0,0];else if(t.indexOf("rgba")>-1){e=(t.match(/[\d.]+/g)||[]).map(Number);for(let t=0;t<3;t++)e[t]=e[t]/255}else e=d.fromString(t).map(t=>t/255),e.push(1);g[t]=e}return g[t]}var v=i(6);const w=/%([bc]){([^}]*)}/g,x=0,b=1,T=2,A=3;function k(t,e){let i={width:0,height:1},n=S(t,e),s=0;for(let t=0;t<n.length;t++){let e=n[t];switch(e.type){case x:s+=e.value.length;break;case b:i.height++,i.width=Math.max(i.width,s),s=0}}return i.width=Math.max(i.width,s),i}function S(t,e){let i=[],n=0;t.replace(w,(function(e,s,o,r){let a=t.substring(n,r);return a.length&&i.push({type:x,value:a}),i.push({type:"c"==s?T:A,value:o.trim()}),n=r+e.length,""}));let s=t.substring(n);return s.length&&i.push({type:x,value:s}),function(t,e){e||(e=1/0);let i=0,n=0,s=-1;for(;i<t.length;){let o=t[i];if(o.type==b&&(n=0,s=-1),o.type!=x){i++;continue}for(;0==n&&" "==o.value.charAt(0);)o.value=o.value.substring(1);let r=o.value.indexOf("\n");if(-1!=r){o.value=C(t,i,r,!0);let e=o.value.split("");for(;e.length&&" "==e[e.length-1];)e.pop();o.value=e.join("")}if(o.value.length){if(n+o.value.length>e){let r=-1;for(;;){let t=o.value.indexOf(" ",r+1);if(-1==t)break;if(n+t>e)break;r=t}if(-1!=r)o.value=C(t,i,r,!0);else if(-1!=s){let e=t[s],n=e.value.lastIndexOf(" ");e.value=C(t,s,n,!0),i=s}else o.value=C(t,i,e-n,!1)}else n+=o.value.length,-1!=o.value.indexOf(" ")&&(s=i);i++}else t.splice(i,1)}t.push({type:b});let o=null;for(let e=0;e<t.length;e++){let i=t[e];switch(i.type){case x:o=i;break;case b:if(o){let t=o.value.split("");for(;t.length&&" "==t[t.length-1];)t.pop();o.value=t.join("")}o=null}}return t.pop(),t}(i,e)}function C(t,e,i,n){let s={type:b},o={type:x,value:t[e].value.substring(i+(n?1:0))};return t.splice(e+1,0,s,o),t[e].value.substring(0,i)}const M={4:[[0,-1],[1,0],[0,1],[-1,0]],8:[[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1]],6:[[-1,-1],[1,-1],[2,0],[1,1],[-1,1],[-2,0]]},E={hex:h,rect:c,tile:u,"tile-gl":p,term:v.a},I={width:80,height:25,transpose:!1,layout:"rect",fontSize:15,spacing:1,border:0,forceSquareRatio:!1,fontFamily:"monospace",fontStyle:"",fg:"#ccc",bg:"#000",tileWidth:32,tileHeight:32,tileMap:{},tileSet:null,tileColorize:!1};(()=>{class t{constructor(t={}){this._data={},this._dirty=!1,this._options={},t=Object.assign({},I,t),this.setOptions(t),this.DEBUG=this.DEBUG.bind(this),this._tick=this._tick.bind(this),this._backend.schedule(this._tick)}DEBUG(t,e,i){let n=[this._options.bg,this._options.fg];this.draw(t,e,null,null,n[i%n.length])}clear(){this._data={},this._dirty=!0}setOptions(t){if(Object.assign(this._options,t),t.width||t.height||t.fontSize||t.fontFamily||t.spacing||t.layout){if(t.layout){let e=E[t.layout];this._backend=new e}this._backend.setOptions(this._options),this._dirty=!0}return this}getOptions(){return this._options}getContainer(){return this._backend.getContainer()}computeSize(t,e){return this._backend.computeSize(t,e)}computeFontSize(t,e){return this._backend.computeFontSize(t,e)}computeTileSize(t,e){return[Math.floor(t/this._options.width),Math.floor(e/this._options.height)]}eventToPosition(t){let e,i;return"touches"in t?(e=t.touches[0].clientX,i=t.touches[0].clientY):(e=t.clientX,i=t.clientY),this._backend.eventToPosition(e,i)}draw(t,e,i,n,s){n||(n=this._options.fg),s||(s=this._options.bg);let o=`${t},${e}`;this._data[o]=[t,e,i,n,s],!0!==this._dirty&&(this._dirty||(this._dirty={}),this._dirty[o]=!0)}drawText(t,e,i,n){let s=null,o=null,r=t,a=e,l=1;n||(n=this._options.width-t);let h=S(i,n);for(;h.length;){let e=h.shift();switch(e.type){case x:let i=!1,n=!1,h=!1,c=!1;for(let t=0;t<e.value.length;t++){let l=e.value.charCodeAt(t),u=e.value.charAt(t);if("term"===this._options.layout){let t=l>>8;if(17===t||t>=46&&t<=159||t>=172&&t<=215||l>=43360&&l<=43391){this.draw(r+0,a,u,s,o),this.draw(r+1,a,"\t",s,o),r+=2;continue}}h=l>65280&&l<65377||l>65500&&l<65512||l>65518,i=32==u.charCodeAt(0)||12288==u.charCodeAt(0),!c||h||i||r++,h&&!n&&r++,this.draw(r++,a,u,s,o),n=i,c=h}break;case T:s=e.value||null;break;case A:o=e.value||null;break;case b:r=t,a++,l++}}return l}_tick(){if(this._backend.schedule(this._tick),this._dirty){if(!0===this._dirty){this._backend.clear();for(let t in this._data)this._draw(t,!1)}else for(let t in this._dirty)this._draw(t,!0);this._dirty=!1}}_draw(t,e){let i=this._data[t];i[4]!=this._options.bg&&(e=!0),this._backend.draw(i,e)}}t.Rect=c,t.Hex=h,t.Tile=u,t.TileGL=p,t.Term=v.a})();class P{constructor(t=80,e=25){this._width=t,this._height=e}_fillMap(t){let e=[];for(let i=0;i<this._width;i++){e.push([]);for(let n=0;n<this._height;n++)e[i].push(t)}return e}}class R extends P{constructor(t,e){super(t,e),this._rooms=[],this._corridors=[]}getRooms(){return this._rooms}getCorridors(){return this._corridors}}class D{}class F extends D{constructor(t,e,i,n,s,o){super(),this._x1=t,this._y1=e,this._x2=i,this._y2=n,this._doors={},void 0!==s&&void 0!==o&&this.addDoor(s,o)}static createRandomAt(t,e,i,n,s){let r=s.roomWidth[0],a=s.roomWidth[1],l=o.a.getUniformInt(r,a);r=s.roomHeight[0],a=s.roomHeight[1];let h=o.a.getUniformInt(r,a);if(1==i){let i=e-Math.floor(o.a.getUniform()*h);return new this(t+1,i,t+l,i+h-1,t,e)}if(-1==i){let i=e-Math.floor(o.a.getUniform()*h);return new this(t-l,i,t-1,i+h-1,t,e)}if(1==n){let i=t-Math.floor(o.a.getUniform()*l);return new this(i,e+1,i+l-1,e+h,t,e)}if(-1==n){let i=t-Math.floor(o.a.getUniform()*l);return new this(i,e-h,i+l-1,e-1,t,e)}throw new Error("dx or dy must be 1 or -1")}static createRandomCenter(t,e,i){let n=i.roomWidth[0],s=i.roomWidth[1],r=o.a.getUniformInt(n,s);n=i.roomHeight[0],s=i.roomHeight[1];let a=o.a.getUniformInt(n,s),l=t-Math.floor(o.a.getUniform()*r),h=e-Math.floor(o.a.getUniform()*a);return new this(l,h,l+r-1,h+a-1)}static createRandom(t,e,i){let n=i.roomWidth[0],s=i.roomWidth[1],r=o.a.getUniformInt(n,s);n=i.roomHeight[0],s=i.roomHeight[1];let a=o.a.getUniformInt(n,s),l=t-r-1,h=e-a-1,c=1+Math.floor(o.a.getUniform()*l),u=1+Math.floor(o.a.getUniform()*h);return new this(c,u,c+r-1,u+a-1)}addDoor(t,e){return this._doors[t+","+e]=1,this}getDoors(t){for(let e in this._doors){let i=e.split(",");t(parseInt(i[0]),parseInt(i[1]))}return this}clearDoors(){return this._doors={},this}addDoors(t){let e=this._x1-1,i=this._x2+1,n=this._y1-1,s=this._y2+1;for(let o=e;o<=i;o++)for(let r=n;r<=s;r++)o!=e&&o!=i&&r!=n&&r!=s||t(o,r)||this.addDoor(o,r);return this}debug(){console.log("room",this._x1,this._y1,this._x2,this._y2)}isValid(t,e){let i=this._x1-1,n=this._x2+1,s=this._y1-1,o=this._y2+1;for(let r=i;r<=n;r++)for(let a=s;a<=o;a++)if(r==i||r==n||a==s||a==o){if(!t(r,a))return!1}else if(!e(r,a))return!1;return!0}create(t){let e=this._x1-1,i=this._x2+1,n=this._y1-1,s=this._y2+1,o=0;for(let r=e;r<=i;r++)for(let a=n;a<=s;a++)o=r+","+a in this._doors?2:r==e||r==i||a==n||a==s?1:0,t(r,a,o)}getCenter(){return[Math.round((this._x1+this._x2)/2),Math.round((this._y1+this._y2)/2)]}getLeft(){return this._x1}getRight(){return this._x2}getTop(){return this._y1}getBottom(){return this._y2}}class B extends D{constructor(t,e,i,n){super(),this._startX=t,this._startY=e,this._endX=i,this._endY=n,this._endsWithAWall=!0}static createRandomAt(t,e,i,n,s){let r=s.corridorLength[0],a=s.corridorLength[1],l=o.a.getUniformInt(r,a);return new this(t,e,t+i*l,e+n*l)}debug(){console.log("corridor",this._startX,this._startY,this._endX,this._endY)}isValid(t,e){let i=this._startX,n=this._startY,s=this._endX-i,o=this._endY-n,r=1+Math.max(Math.abs(s),Math.abs(o));s&&(s/=Math.abs(s)),o&&(o/=Math.abs(o));let a=o,l=-s,h=!0;for(let c=0;c<r;c++){let u=i+c*s,d=n+c*o;if(e(u,d)||(h=!1),t(u+a,d+l)||(h=!1),t(u-a,d-l)||(h=!1),!h){r=c,this._endX=u-s,this._endY=d-o;break}}if(0==r)return!1;if(1==r&&t(this._endX+s,this._endY+o))return!1;let c=!t(this._endX+s+a,this._endY+o+l),u=!t(this._endX+s-a,this._endY+o-l);return this._endsWithAWall=t(this._endX+s,this._endY+o),!c&&!u||!this._endsWithAWall}create(t){let e=this._startX,i=this._startY,n=this._endX-e,s=this._endY-i,o=1+Math.max(Math.abs(n),Math.abs(s));n&&(n/=Math.abs(n)),s&&(s/=Math.abs(s));for(let r=0;r<o;r++){t(e+r*n,i+r*s,0)}return!0}createPriorityWalls(t){if(!this._endsWithAWall)return;let e=this._startX,i=this._startY,n=this._endX-e,s=this._endY-i;n&&(n/=Math.abs(n)),s&&(s/=Math.abs(s));let o=s,r=-n;t(this._endX+n,this._endY+s),t(this._endX+o,this._endY+r),t(this._endX-o,this._endY-r)}}const O={room:F,corridor:B};function z(t,e,i){i[e[t+1]]=i[t],e[i[t]]=e[t+1],i[t]=t+1,e[t+1]=t}function H(t,e,i){i[e[t]]=i[t],e[i[t]]=e[t],i[t]=t,e[t]=t}var W={Arena:class extends P{create(t){let e=this._width-1,i=this._height-1;for(let n=0;n<=e;n++)for(let s=0;s<=i;s++){t(n,s,n&&s&&n<e&&s<i?0:1)}return this}},Uniform:class extends R{constructor(t,e,i){super(t,e),this._options={roomWidth:[3,9],roomHeight:[3,5],roomDugPercentage:.1,timeLimit:1e3},Object.assign(this._options,i),this._map=[],this._dug=0,this._roomAttempts=20,this._corridorAttempts=20,this._connected=[],this._unconnected=[],this._digCallback=this._digCallback.bind(this),this._canBeDugCallback=this._canBeDugCallback.bind(this),this._isWallCallback=this._isWallCallback.bind(this)}create(t){let e=Date.now();for(;;){if(Date.now()-e>this._options.timeLimit)return null;if(this._map=this._fillMap(1),this._dug=0,this._rooms=[],this._unconnected=[],this._generateRooms(),!(this._rooms.length<2)&&this._generateCorridors())break}if(t)for(let e=0;e<this._width;e++)for(let i=0;i<this._height;i++)t(e,i,this._map[e][i]);return this}_generateRooms(){let t,e=this._width-2,i=this._height-2;do{if(t=this._generateRoom(),this._dug/(e*i)>this._options.roomDugPercentage)break}while(t)}_generateRoom(){let t=0;for(;t<this._roomAttempts;){t++;let e=F.createRandom(this._width,this._height,this._options);if(e.isValid(this._isWallCallback,this._canBeDugCallback))return e.create(this._digCallback),this._rooms.push(e),e}return null}_generateCorridors(){let t=0;for(;t<this._corridorAttempts;){t++,this._corridors=[],this._map=this._fillMap(1);for(let t=0;t<this._rooms.length;t++){let e=this._rooms[t];e.clearDoors(),e.create(this._digCallback)}for(this._unconnected=o.a.shuffle(this._rooms.slice()),this._connected=[],this._unconnected.length&&this._connected.push(this._unconnected.pop());;){let t=o.a.getItem(this._connected);if(!t)break;let e=this._closestRoom(this._unconnected,t);if(!e)break;let i=this._closestRoom(this._connected,e);if(!i)break;if(!this._connectRooms(e,i))break;if(!this._unconnected.length)return!0}}return!1}_closestRoom(t,e){let i=1/0,n=e.getCenter(),s=null;for(let e=0;e<t.length;e++){let o=t[e],r=o.getCenter(),a=r[0]-n[0],l=r[1]-n[1],h=a*a+l*l;h<i&&(i=h,s=o)}return s}_connectRooms(t,e){let i,n,s,o,r,a,l,h=t.getCenter(),c=e.getCenter(),u=c[0]-h[0],d=c[1]-h[1];if(Math.abs(u)<Math.abs(d)?(s=d>0?2:0,o=(s+2)%4,r=e.getLeft(),a=e.getRight(),l=0):(s=u>0?1:3,o=(s+2)%4,r=e.getTop(),a=e.getBottom(),l=1),i=this._placeInWall(t,s),!i)return!1;if(i[l]>=r&&i[l]<=a){n=i.slice();let t=0;switch(o){case 0:t=e.getTop()-1;break;case 1:t=e.getRight()+1;break;case 2:t=e.getBottom()+1;break;case 3:t=e.getLeft()-1}n[(l+1)%2]=t,this._digLine([i,n])}else if(i[l]<r-1||i[l]>a+1){let t=i[l]-c[l],s=0;switch(o){case 0:case 1:s=t<0?3:1;break;case 2:case 3:s=t<0?1:3}if(o=(o+s)%4,n=this._placeInWall(e,o),!n)return!1;let r=[0,0];r[l]=i[l];let a=(l+1)%2;r[a]=n[a],this._digLine([i,r,n])}else{let t=(l+1)%2;if(n=this._placeInWall(e,o),!n)return!1;let s=Math.round((n[t]+i[t])/2),r=[0,0],a=[0,0];r[l]=i[l],r[t]=s,a[l]=n[l],a[t]=s,this._digLine([i,r,a,n])}return t.addDoor(i[0],i[1]),e.addDoor(n[0],n[1]),l=this._unconnected.indexOf(t),-1!=l&&(this._unconnected.splice(l,1),this._connected.push(t)),l=this._unconnected.indexOf(e),-1!=l&&(this._unconnected.splice(l,1),this._connected.push(e)),!0}_placeInWall(t,e){let i=[0,0],n=[0,0],s=0;switch(e){case 0:n=[1,0],i=[t.getLeft(),t.getTop()-1],s=t.getRight()-t.getLeft()+1;break;case 1:n=[0,1],i=[t.getRight()+1,t.getTop()],s=t.getBottom()-t.getTop()+1;break;case 2:n=[1,0],i=[t.getLeft(),t.getBottom()+1],s=t.getRight()-t.getLeft()+1;break;case 3:n=[0,1],i=[t.getLeft()-1,t.getTop()],s=t.getBottom()-t.getTop()+1}let r=[],a=-2;for(let t=0;t<s;t++){let e=i[0]+t*n[0],s=i[1]+t*n[1];r.push(null),1==this._map[e][s]?a!=t-1&&(r[t]=[e,s]):(a=t,t&&(r[t-1]=null))}for(let t=r.length-1;t>=0;t--)r[t]||r.splice(t,1);return r.length?o.a.getItem(r):null}_digLine(t){for(let e=1;e<t.length;e++){let i=t[e-1],n=t[e],s=new B(i[0],i[1],n[0],n[1]);s.create(this._digCallback),this._corridors.push(s)}}_digCallback(t,e,i){this._map[t][e]=i,0==i&&this._dug++}_isWallCallback(t,e){return!(t<0||e<0||t>=this._width||e>=this._height)&&1==this._map[t][e]}_canBeDugCallback(t,e){return!(t<1||e<1||t+1>=this._width||e+1>=this._height)&&1==this._map[t][e]}},Cellular:class extends P{constructor(t,e,i={}){super(t,e),this._options={born:[5,6,7,8],survive:[4,5,6,7,8],topology:8},this.setOptions(i),this._dirs=M[this._options.topology],this._map=this._fillMap(0)}randomize(t){for(let e=0;e<this._width;e++)for(let i=0;i<this._height;i++)this._map[e][i]=o.a.getUniform()<t?1:0;return this}setOptions(t){Object.assign(this._options,t)}set(t,e,i){this._map[t][e]=i}create(t){let e=this._fillMap(0),i=this._options.born,n=this._options.survive;for(let t=0;t<this._height;t++){let s=1,o=0;6==this._options.topology&&(s=2,o=t%2);for(let r=o;r<this._width;r+=s){let s=this._map[r][t],o=this._getNeighbors(r,t);s&&-1!=n.indexOf(o)?e[r][t]=1:s||-1==i.indexOf(o)||(e[r][t]=1)}}this._map=e,t&&this._serviceCallback(t)}_serviceCallback(t){for(let e=0;e<this._height;e++){let i=1,n=0;6==this._options.topology&&(i=2,n=e%2);for(let s=n;s<this._width;s+=i)t(s,e,this._map[s][e])}}_getNeighbors(t,e){let i=0;for(let n=0;n<this._dirs.length;n++){let s=this._dirs[n],o=t+s[0],r=e+s[1];o<0||o>=this._width||r<0||r>=this._height||(i+=1==this._map[o][r]?1:0)}return i}connect(t,e,i){e||(e=0);let n=[],s={},r=1,a=[0,0];6==this._options.topology&&(r=2,a=[0,1]);for(let t=0;t<this._height;t++)for(let i=a[t%2];i<this._width;i+=r)if(this._freeSpace(i,t,e)){let e=[i,t];s[this._pointKey(e)]=e,n.push([i,t])}let l=n[o.a.getUniformInt(0,n.length-1)],h=this._pointKey(l),c={};for(c[h]=l,delete s[h],this._findConnected(c,s,[l],!1,e);Object.keys(s).length>0;){let t=this._getFromTo(c,s),n=t[0],o=t[1],r={};r[this._pointKey(n)]=n,this._findConnected(r,s,[n],!0,e),(6==this._options.topology?this._tunnelToConnected6:this._tunnelToConnected).call(this,o,n,c,s,e,i);for(let t in r){let i=r[t];this._map[i[0]][i[1]]=e,c[t]=i,delete s[t]}}t&&this._serviceCallback(t)}_getFromTo(t,e){let i,n=[0,0],s=[0,0],r=Object.keys(t),a=Object.keys(e);for(let l=0;l<5;l++){if(r.length<a.length){let i=r;s=t[i[o.a.getUniformInt(0,i.length-1)]],n=this._getClosest(s,e)}else{let i=a;n=e[i[o.a.getUniformInt(0,i.length-1)]],s=this._getClosest(n,t)}if(i=(n[0]-s[0])*(n[0]-s[0])+(n[1]-s[1])*(n[1]-s[1]),i<64)break}return[n,s]}_getClosest(t,e){let i=null,n=null;for(let s in e){let o=e[s],r=(o[0]-t[0])*(o[0]-t[0])+(o[1]-t[1])*(o[1]-t[1]);(null==n||r<n)&&(n=r,i=o)}return i}_findConnected(t,e,i,n,s){for(;i.length>0;){let o,r=i.splice(0,1)[0];o=6==this._options.topology?[[r[0]+2,r[1]],[r[0]+1,r[1]-1],[r[0]-1,r[1]-1],[r[0]-2,r[1]],[r[0]-1,r[1]+1],[r[0]+1,r[1]+1]]:[[r[0]+1,r[1]],[r[0]-1,r[1]],[r[0],r[1]+1],[r[0],r[1]-1]];for(let r=0;r<o.length;r++){let a=this._pointKey(o[r]);null==t[a]&&this._freeSpace(o[r][0],o[r][1],s)&&(t[a]=o[r],n||delete e[a],i.push(o[r]))}}}_tunnelToConnected(t,e,i,n,s,o){let r,a;e[0]<t[0]?(r=e,a=t):(r=t,a=e);for(let t=r[0];t<=a[0];t++){this._map[t][r[1]]=s;let e=[t,r[1]],o=this._pointKey(e);i[o]=e,delete n[o]}o&&r[0]<a[0]&&o(r,[a[0],r[1]]);let l=a[0];e[1]<t[1]?(r=e,a=t):(r=t,a=e);for(let t=r[1];t<a[1];t++){this._map[l][t]=s;let e=[l,t],o=this._pointKey(e);i[o]=e,delete n[o]}o&&r[1]<a[1]&&o([a[0],r[1]],[a[0],a[1]])}_tunnelToConnected6(t,e,i,n,s,o){let r,a;e[0]<t[0]?(r=e,a=t):(r=t,a=e);let l=r[0],h=r[1];for(;l!=a[0]||h!=a[1];){let t=2;h<a[1]?(h++,t=1):h>a[1]&&(h--,t=1),l<a[0]?l+=t:l>a[0]||a[1]%2?l-=t:l+=t,this._map[l][h]=s;let e=[l,h],o=this._pointKey(e);i[o]=e,delete n[o]}o&&o(e,t)}_freeSpace(t,e,i){return t>=0&&t<this._width&&e>=0&&e<this._height&&this._map[t][e]==i}_pointKey(t){return t[0]+"."+t[1]}},Digger:class extends R{constructor(t,e,i={}){super(t,e),this._options=Object.assign({roomWidth:[3,9],roomHeight:[3,5],corridorLength:[3,10],dugPercentage:.2,timeLimit:1e3},i),this._features={room:4,corridor:4},this._map=[],this._featureAttempts=20,this._walls={},this._dug=0,this._digCallback=this._digCallback.bind(this),this._canBeDugCallback=this._canBeDugCallback.bind(this),this._isWallCallback=this._isWallCallback.bind(this),this._priorityWallCallback=this._priorityWallCallback.bind(this)}create(t){this._rooms=[],this._corridors=[],this._map=this._fillMap(1),this._walls={},this._dug=0;let e=(this._width-2)*(this._height-2);this._firstRoom();let i,n=Date.now();do{if(i=0,Date.now()-n>this._options.timeLimit)break;let t=this._findWall();if(!t)break;let e=t.split(","),s=parseInt(e[0]),o=parseInt(e[1]),r=this._getDiggingDirection(s,o);if(!r)continue;let a=0;do{if(a++,this._tryFeature(s,o,r[0],r[1])){this._removeSurroundingWalls(s,o),this._removeSurroundingWalls(s-r[0],o-r[1]);break}}while(a<this._featureAttempts);for(let t in this._walls)this._walls[t]>1&&i++}while(this._dug/e<this._options.dugPercentage||i);if(this._addDoors(),t)for(let e=0;e<this._width;e++)for(let i=0;i<this._height;i++)t(e,i,this._map[e][i]);return this._walls={},this._map=[],this}_digCallback(t,e,i){0==i||2==i?(this._map[t][e]=0,this._dug++):this._walls[t+","+e]=1}_isWallCallback(t,e){return!(t<0||e<0||t>=this._width||e>=this._height)&&1==this._map[t][e]}_canBeDugCallback(t,e){return!(t<1||e<1||t+1>=this._width||e+1>=this._height)&&1==this._map[t][e]}_priorityWallCallback(t,e){this._walls[t+","+e]=2}_firstRoom(){let t=Math.floor(this._width/2),e=Math.floor(this._height/2),i=F.createRandomCenter(t,e,this._options);this._rooms.push(i),i.create(this._digCallback)}_findWall(){let t=[],e=[];for(let i in this._walls){2==this._walls[i]?e.push(i):t.push(i)}let i=e.length?e:t;if(!i.length)return null;let n=o.a.getItem(i.sort());return delete this._walls[n],n}_tryFeature(t,e,i,n){let s=o.a.getWeightedValue(this._features),r=O[s].createRandomAt(t,e,i,n,this._options);return!!r.isValid(this._isWallCallback,this._canBeDugCallback)&&(r.create(this._digCallback),r instanceof F&&this._rooms.push(r),r instanceof B&&(r.createPriorityWalls(this._priorityWallCallback),this._corridors.push(r)),!0)}_removeSurroundingWalls(t,e){let i=M[4];for(let n=0;n<i.length;n++){let s=i[n],o=t+s[0],r=e+s[1];delete this._walls[o+","+r],o=t+2*s[0],r=e+2*s[1],delete this._walls[o+","+r]}}_getDiggingDirection(t,e){if(t<=0||e<=0||t>=this._width-1||e>=this._height-1)return null;let i=null,n=M[4];for(let s=0;s<n.length;s++){let o=n[s],r=t+o[0],a=e+o[1];if(!this._map[r][a]){if(i)return null;i=o}}return i?[-i[0],-i[1]]:null}_addDoors(){let t=this._map;function e(e,i){return 1==t[e][i]}for(let t=0;t<this._rooms.length;t++){let i=this._rooms[t];i.clearDoors(),i.addDoors(e)}}},EllerMaze:class extends P{create(t){let e,i=this._fillMap(1),n=Math.ceil((this._width-2)/2),s=[],r=[];for(let t=0;t<n;t++)s.push(t),r.push(t);for(s.push(n-1),e=1;e+3<this._height;e+=2)for(let t=0;t<n;t++){let n=2*t+1,a=e;i[n][a]=0,t!=s[t+1]&&o.a.getUniform()>9/24&&(z(t,s,r),i[n+1][a]=0),t!=s[t]&&o.a.getUniform()>9/24?H(t,s,r):i[n][a+1]=0}for(let t=0;t<n;t++){let n=2*t+1,a=e;i[n][a]=0,t!=s[t+1]&&(t==s[t]||o.a.getUniform()>9/24)&&(z(t,s,r),i[n+1][a]=0),H(t,s,r)}for(let e=0;e<this._width;e++)for(let n=0;n<this._height;n++)t(e,n,i[e][n]);return this}},DividedMaze:class extends P{constructor(){super(...arguments),this._stack=[],this._map=[]}create(t){let e=this._width,i=this._height;this._map=[];for(let t=0;t<e;t++){this._map.push([]);for(let n=0;n<i;n++){let s=0==t||0==n||t+1==e||n+1==i;this._map[t].push(s?1:0)}}this._stack=[[1,1,e-2,i-2]],this._process();for(let n=0;n<e;n++)for(let e=0;e<i;e++)t(n,e,this._map[n][e]);return this._map=[],this}_process(){for(;this._stack.length;){let t=this._stack.shift();this._partitionRoom(t)}}_partitionRoom(t){let e=[],i=[];for(let i=t[0]+1;i<t[2];i++){let n=this._map[i][t[1]-1],s=this._map[i][t[3]+1];!n||!s||i%2||e.push(i)}for(let e=t[1]+1;e<t[3];e++){let n=this._map[t[0]-1][e],s=this._map[t[2]+1][e];!n||!s||e%2||i.push(e)}if(!e.length||!i.length)return;let n=o.a.getItem(e),s=o.a.getItem(i);this._map[n][s]=1;let r=[],a=[];r.push(a);for(let e=t[0];e<n;e++)this._map[e][s]=1,e%2&&a.push([e,s]);a=[],r.push(a);for(let e=n+1;e<=t[2];e++)this._map[e][s]=1,e%2&&a.push([e,s]);a=[],r.push(a);for(let e=t[1];e<s;e++)this._map[n][e]=1,e%2&&a.push([n,e]);a=[],r.push(a);for(let e=s+1;e<=t[3];e++)this._map[n][e]=1,e%2&&a.push([n,e]);let l=o.a.getItem(r);for(let t=0;t<r.length;t++){let e=r[t];if(e==l)continue;let i=o.a.getItem(e);this._map[i[0]][i[1]]=0}this._stack.push([t[0],t[1],n-1,s-1]),this._stack.push([n+1,t[1],t[2],s-1]),this._stack.push([t[0],s+1,n-1,t[3]]),this._stack.push([n+1,s+1,t[2],t[3]])}},IceyMaze:class extends P{constructor(t,e,i=0){super(t,e),this._regularity=i,this._map=[]}create(t){let e=this._width,i=this._height,n=this._fillMap(1);e-=e%2?1:2,i-=i%2?1:2;let s=0,r=0,a=0,l=0,h=0,c=!1,u=[[0,0],[0,0],[0,0],[0,0]];do{if(s=1+2*Math.floor(o.a.getUniform()*(e-1)/2),r=1+2*Math.floor(o.a.getUniform()*(i-1)/2),h||(n[s][r]=0),!n[s][r]){this._randomize(u);do{0==Math.floor(o.a.getUniform()*(this._regularity+1))&&this._randomize(u),c=!0;for(let t=0;t<4;t++)if(a=s+2*u[t][0],l=r+2*u[t][1],this._isFree(n,a,l,e,i)){n[a][l]=0,n[s+u[t][0]][r+u[t][1]]=0,s=a,r=l,c=!1,h++;break}}while(!c)}}while(h+1<e*i/4);for(let e=0;e<this._width;e++)for(let i=0;i<this._height;i++)t(e,i,n[e][i]);return this._map=[],this}_randomize(t){for(let e=0;e<4;e++)t[e][0]=0,t[e][1]=0;switch(Math.floor(4*o.a.getUniform())){case 0:t[0][0]=-1,t[1][0]=1,t[2][1]=-1,t[3][1]=1;break;case 1:t[3][0]=-1,t[2][0]=1,t[1][1]=-1,t[0][1]=1;break;case 2:t[2][0]=-1,t[3][0]=1,t[0][1]=-1,t[1][1]=1;break;case 3:t[1][0]=-1,t[0][0]=1,t[3][1]=-1,t[2][1]=1}}_isFree(t,e,i,n,s){return!(e<1||i<1||e>=n||i>=s)&&t[e][i]}},Rogue:class extends P{constructor(t,e,i){super(t,e),this.map=[],this.rooms=[],this.connectedCells=[],(i=Object.assign({cellWidth:3,cellHeight:3},i)).hasOwnProperty("roomWidth")||(i.roomWidth=this._calculateRoomSize(this._width,i.cellWidth)),i.hasOwnProperty("roomHeight")||(i.roomHeight=this._calculateRoomSize(this._height,i.cellHeight)),this._options=i}create(t){if(this.map=this._fillMap(1),this.rooms=[],this.connectedCells=[],this._initRooms(),this._connectRooms(),this._connectUnconnectedRooms(),this._createRandomRoomConnections(),this._createRooms(),this._createCorridors(),t)for(let e=0;e<this._width;e++)for(let i=0;i<this._height;i++)t(e,i,this.map[e][i]);return this}_calculateRoomSize(t,e){let i=Math.floor(t/e*.8),n=Math.floor(t/e*.25);return n<2&&(n=2),i<2&&(i=2),[n,i]}_initRooms(){for(let t=0;t<this._options.cellWidth;t++){this.rooms.push([]);for(let e=0;e<this._options.cellHeight;e++)this.rooms[t].push({x:0,y:0,width:0,height:0,connections:[],cellx:t,celly:e})}}_connectRooms(){let t,e,i,n,s,r,a=o.a.getUniformInt(0,this._options.cellWidth-1),l=o.a.getUniformInt(0,this._options.cellHeight-1),h=!1;do{r=[0,2,4,6],r=o.a.shuffle(r);do{if(h=!1,t=r.pop(),e=a+M[8][t][0],i=l+M[8][t][1],!(e<0||e>=this._options.cellWidth||i<0||i>=this._options.cellHeight)){if(n=this.rooms[a][l],n.connections.length>0&&n.connections[0][0]==e&&n.connections[0][1]==i)break;s=this.rooms[e][i],0==s.connections.length&&(s.connections.push([a,l]),this.connectedCells.push([e,i]),a=e,l=i,h=!0)}}while(r.length>0&&0==h)}while(r.length>0)}_connectUnconnectedRooms(){let t,e,i,n=this._options.cellWidth,s=this._options.cellHeight;this.connectedCells=o.a.shuffle(this.connectedCells);for(let r=0;r<this._options.cellWidth;r++)for(let a=0;a<this._options.cellHeight;a++)if(t=this.rooms[r][a],0==t.connections.length){let l=[0,2,4,6];l=o.a.shuffle(l),i=!1;do{let t=l.pop(),o=r+M[8][t][0],h=a+M[8][t][1];if(!(o<0||o>=n||h<0||h>=s)){if(e=this.rooms[o][h],i=!0,0==e.connections.length)break;for(let t=0;t<e.connections.length;t++)if(e.connections[t][0]==r&&e.connections[t][1]==a){i=!1;break}if(i)break}}while(l.length);i?t.connections.push([e.cellx,e.celly]):console.log("-- Unable to connect room.")}}_createRandomRoomConnections(){}_createRooms(){let t,e,i,n,s,r=this._width,a=this._height,l=this._options.cellWidth,h=this._options.cellHeight,c=Math.floor(this._width/l),u=Math.floor(this._height/h),d=this._options.roomWidth,p=this._options.roomHeight;for(let _=0;_<l;_++)for(let l=0;l<h;l++){if(i=c*_,n=u*l,0==i&&(i=1),0==n&&(n=1),t=o.a.getUniformInt(d[0],d[1]),e=o.a.getUniformInt(p[0],p[1]),l>0)for(s=this.rooms[_][l-1];n-(s.y+s.height)<3;)n++;if(_>0)for(s=this.rooms[_-1][l];i-(s.x+s.width)<3;)i++;let h=Math.round(o.a.getUniformInt(0,c-t)/2),f=Math.round(o.a.getUniformInt(0,u-e)/2);for(;i+h+t>=r;)h?h--:t--;for(;n+f+e>=a;)f?f--:e--;i+=h,n+=f,this.rooms[_][l].x=i,this.rooms[_][l].y=n,this.rooms[_][l].width=t,this.rooms[_][l].height=e;for(let s=i;s<i+t;s++)for(let t=n;t<n+e;t++)this.map[s][t]=0}}_getWallPosition(t,e){let i,n,s;return 1==e||3==e?(i=o.a.getUniformInt(t.x+1,t.x+t.width-2),1==e?(n=t.y-2,s=n+1):(n=t.y+t.height+1,s=n-1),this.map[i][s]=0):(n=o.a.getUniformInt(t.y+1,t.y+t.height-2),2==e?(i=t.x+t.width+1,s=i-1):(i=t.x-2,s=i+1),this.map[s][n]=0),[i,n]}_drawCorridor(t,e){let i,n,s,r,a=e[0]-t[0],l=e[1]-t[1],h=t[0],c=t[1],u=[],d=Math.abs(a),p=Math.abs(l),_=o.a.getUniform(),f=_,m=1-_;for(n=a>0?2:6,s=l>0?4:0,d<p?(i=Math.ceil(p*f),u.push([s,i]),u.push([n,d]),i=Math.floor(p*m),u.push([s,i])):(i=Math.ceil(d*f),u.push([n,i]),u.push([s,p]),i=Math.floor(d*m),u.push([n,i])),this.map[h][c]=0;u.length>0;)for(r=u.pop();r[1]>0;)h+=M[8][r[0]][0],c+=M[8][r[0]][1],this.map[h][c]=0,r[1]=r[1]-1}_createCorridors(){let t,e,i,n,s,o=this._options.cellWidth,r=this._options.cellHeight;for(let a=0;a<o;a++)for(let o=0;o<r;o++){t=this.rooms[a][o];for(let o=0;o<t.connections.length;o++)e=t.connections[o],i=this.rooms[e[0]][e[1]],i.cellx>t.cellx?(n=2,s=4):i.cellx<t.cellx?(n=4,s=2):i.celly>t.celly?(n=3,s=1):(n=1,s=3),this._drawCorridor(this._getWallPosition(t,n),this._getWallPosition(i,s))}}}};Math.sqrt(3),Math.sqrt(3);class L{constructor(t,e,i,n={}){this._toX=t,this._toY=e,this._passableCallback=i,this._options=Object.assign({topology:8},n),this._dirs=M[this._options.topology],8==this._options.topology&&(this._dirs=[this._dirs[0],this._dirs[2],this._dirs[4],this._dirs[6],this._dirs[1],this._dirs[3],this._dirs[5],this._dirs[7]])}_getNeighbors(t,e){let i=[];for(let n=0;n<this._dirs.length;n++){let s=this._dirs[n],o=t+s[0],r=e+s[1];this._passableCallback(o,r)&&i.push([o,r])}return i}}var X={Dijkstra:class extends L{constructor(t,e,i,n){super(t,e,i,n),this._computed={},this._todo=[],this._add(t,e,null)}compute(t,e,i){let n=t+","+e;if(n in this._computed||this._compute(t,e),!(n in this._computed))return;let s=this._computed[n];for(;s;)i(s.x,s.y),s=s.prev}_compute(t,e){for(;this._todo.length;){let i=this._todo.shift();if(i.x==t&&i.y==e)return;let n=this._getNeighbors(i.x,i.y);for(let t=0;t<n.length;t++){let e=n[t],s=e[0],o=e[1];s+","+o in this._computed||this._add(s,o,i)}}}_add(t,e,i){let n={x:t,y:e,prev:i};this._computed[t+","+e]=n,this._todo.push(n)}},AStar:class extends L{constructor(t,e,i,n={}){super(t,e,i,n),this._todo=[],this._done={}}compute(t,e,i){for(this._todo=[],this._done={},this._fromX=t,this._fromY=e,this._add(this._toX,this._toY,null);this._todo.length;){let i=this._todo.shift(),n=i.x+","+i.y;if(n in this._done)continue;if(this._done[n]=i,i.x==t&&i.y==e)break;let s=this._getNeighbors(i.x,i.y);for(let t=0;t<s.length;t++){let e=s[t],n=e[0],o=e[1];n+","+o in this._done||this._add(n,o,i)}}let n=this._done[t+","+e];if(n)for(;n;)i(n.x,n.y),n=n.prev}_add(t,e,i){let n=this._distance(t,e),s={x:t,y:e,prev:i,g:i?i.g+1:0,h:n},o=s.g+s.h;for(let t=0;t<this._todo.length;t++){let e=this._todo[t],i=e.g+e.h;if(o<i||o==i&&n<e.h)return void this._todo.splice(t,0,s)}this._todo.push(s)}_distance(t,e){switch(this._options.topology){case 4:return Math.abs(t-this._fromX)+Math.abs(e-this._fromY);case 6:let i=Math.abs(t-this._fromX),n=Math.abs(e-this._fromY);return n+Math.max(0,(i-n)/2);case 8:return Math.max(Math.abs(t-this._fromX),Math.abs(e-this._fromY))}}}};const U=function(t,e){return Math.floor(Math.random()*(e-t))+t},Y=function(t){return t[Math.floor(Math.random()*t.length)]},G=document.getElementById("spells"),j=document.getElementById("level"),q=document.getElementById("coins"),N=t=>{let e="";t.forEach((t,i)=>{e+=`<div ${t.used?"class=used":""}>${i+1} - ${t.name}</div>`}),G.innerHTML=e},V=(t,e)=>{j.innerHTML=t,q.innerHTML=e};var $=i(5);i.p,i.p,i.p;const Q=new $.Game({width:600,height:600,parent:"game"});document.addEventListener("DOMContentLoaded",(function(){Q.context.font="30px Goblin"}));const K=Q.width/7,Z=K/32,J=new $.SpriteSheet({path:"img/spritesheet.png",context:Q.context,colSize:32,rowSize:32}),tt=new $.SpriteSheet({path:"img/arrow.png",context:Q.context,colSize:15,rowSize:15}),et=tt.getSprite(0,0),it=tt.getSprite(1,0),nt=tt.getSprite(2,0),st=tt.getSprite(3,0),ot=J.getSprite(0,0),rt=(J.getSprite(1,0),J.getSprite(2,0),J.getSprite(3,0)),at=J.getSprite(4,0),lt=J.getSprite(5,0),ht=J.getSprite(6,0),ct=J.getSprite(7,0),ut=J.getSprite(8,0),dt=J.getSprite(9,0),pt=J.getSprite(10,0),_t=J.getSprite(19,0),ft=J.getSprite(20,0),mt=J.getSprite(21,0),gt=J.getSprite(22,0);var yt={black:"#17111a",darkPurple:"#372538",darkRed:"#7a213a",red:"#e14141",tan:"#ffa070",darkOrange:"#c44d29",gold:"#ffbf36",yellow:"#fff275",brown:"#753939",darkTan:"#cf7957",lightTan:"#ffd1ab",darkGreen:"#39855a",green:"#83e04c",lightGreen:"#dcff70",darkBlue:"#243b61",blue:"#3898ff",lightBlue:"#6eeeff",darkPink:"#682b82",pink:"#bf3fb3",lightPink:"#ff80aa",darkGray:"#3e375c",gray:"#7884ab",lightGray:"#b2bcc2",white:"#ffffff"};const vt=J.getSprite(15,0),wt=J.getSprite(14,0),xt=J.getSprite(17,0),bt=t=>class extends t{constructor(t){super(t),this.spells=[],this.registeredSpells=[{spell:this.jump.bind(this),name:"jump",desc:"transport to a random empty tile"},{spell:this.hurricane.bind(this),name:"hurricane",desc:"shuffle the enemies on the board"},{spell:this.heal.bind(this),name:"heal",desc:"gain one health point"},{spell:this.col.bind(this),name:"column",desc:"damage all enemies in your column"},{spell:this.row.bind(this),name:"row",desc:"damage all enemies in your row"},{spell:this.push.bind(this),name:"push",desc:"push all enemies away from you"},{spell:this.pull.bind(this),name:"pull",desc:"pull all enemies toward you"},{spell:this.stun.bind(this),name:"stun",desc:"stuns all enemies for 1 turn"},{spell:this.beachBall.bind(this),name:"beach ball",desc:"throw beach ball"},{spell:this.dash.bind(this),name:"dash",desc:"dash in some direction, can damage enemies"},{spell:this.damageTrap.bind(this),name:"trap",desc:"set a trap, will harm enemies that step on it"},{spell:this.hitAllTrap.bind(this),name:"super trap",desc:"set a trap, will harm all enemies of the type that steps on it"},{spell:this.waterAttack.bind(this),name:"water attack",desc:"harms all enemies in water"},{spell:this.bugSpray.bind(this),name:"bug spray",desc:"harms all wasps"},{spell:this.wait.bind(this),name:"wait",desc:"wait a turn"}],this.getRandomSpell()}resetSpells(){this.spells.forEach(t=>t.used=!1)}doSpell(t){t.used||(t.used=!0,N(this.spells),t.spell())}getRandomSpell(){const t=Y(this.registeredSpells);if(this.spells.includes(t))return this.getRandomSpell();this.spells.push(t)}jump(){const t=this.map.randomEmptyTile(),e=this.map.getTileFromCanvasCoords(this.x,this.y);this.map.getTile(t.x,t.y).entity=this,e.entity=null,this.x=t.x*this.tileSize,this.y=t.y*this.tileSize}hurricane(){Q.enemies.forEach(t=>{const e=this.map.randomEmptyTile(),i=this.map.getTileFromCanvasCoords(t.x,t.y);this.map.getTile(e.x,e.y).entity=t,i.entity=null,t.x=e.x*t.tileSize,t.y=e.y*t.tileSize})}heal(t){this.hp=Math.min(this.hp+1,this.maxHp),t||(this.map.getTileFromCanvasCoords(this.x,this.y).setEffect(vt),document.dispatchEvent(new CustomEvent("splode",{detail:{x:this.x,y:this.y,noFall:!0,life:.5,colorArray:[yt.green,yt.darkGreen,yt.lightGreen,yt.darkBlue]}})))}col(){const t=this.map.getMapCoordsFromCanvasCoords(this.x,this.y);this.map.map[t.x].forEach(t=>{(!t.entity||t.entity&&!t.entity.isRoosta)&&t.setEffect(wt),t.entity&&!t.entity.isRoosta&&t.entity.takeDamage()})}row(){const t=this.map.getMapCoordsFromCanvasCoords(this.x,this.y);this.map.map.forEach(e=>{const i=e[t.y];(!i.entity||i.entity&&!i.entity.isRoosta)&&i.setEffect(xt),i.entity&&!i.entity.isRoosta&&i.entity.takeDamage()})}push(){const t=this.map.getMapCoordsFromCanvasCoords(this.x,this.y);this.map.map.forEach(e=>e.forEach(e=>{const{entity:i}=e;if(i&&!i.isRoosta&&!i.hasBeenPushed){const e=this.map.getMapCoordsFromCanvasCoords(i.x,i.y),n=e.x-t.x,s=e.y-t.y;if(Math.abs(n)>=Math.abs(s)){const t=n>0?1:-1;i.isBeingMoved=!0,i.hasBeenPushed=!0,i.move(t,0)}else{const t=s>0?1:-1;i.isBeingMoved=!0,i.move(0,t),i.hasBeenPushed=!0}}})),Q.enemies.forEach(t=>t.hasBeenPushed=!1)}pull(){const t=this.map.getMapCoordsFromCanvasCoords(this.x,this.y);this.map.map.forEach(e=>e.forEach(e=>{const{entity:i}=e;if(i&&!i.isRoosta&&!i.hasBeenPushed){const e=this.map.getMapCoordsFromCanvasCoords(i.x,i.y),n=e.x-t.x,s=e.y-t.y;if(Math.abs(n)>=Math.abs(s)){const t=n<0?1:-1;i.isBeingMoved=!0,i.hasBeenPushed=!0,i.move(t,0,!0)}else{const t=s<0?1:-1;i.isBeingMoved=!0,i.move(0,t,!0),i.hasBeenPushed=!0}}})),Q.enemies.forEach(t=>t.hasBeenPushed=!1)}stun(){Q.enemies.forEach(t=>t.stunned=!0)}dispatchDirectionFunction(t){document.dispatchEvent(new CustomEvent("directionFunction",{detail:{callback:t}}))}dispatchBeachBall(t,e,i,n){document.dispatchEvent(new CustomEvent("beachBall",{detail:{x1:t,y1:e,x2:i,y2:n}}))}beachBall(){this.dispatchDirectionFunction(t=>{const e=this.map.getMapCoordsFromCanvasCoords(this.x,this.y),i=this.map.map.length;if(["ArrowRight","ArrowLeft","ArrowUp","ArrowDown"].includes(t)){if("ArrowRight"===t){const t=this.map.getTile(e.x+1,e.y);if(t.entity||!t.isWalkable)return!1;for(let t=e.x+1;t<i;t++){const i=this.map.map[t][e.y];if(i.entity)return this.dispatchBeachBall(this.x,this.y,i.entity.x,i.entity.y),i.entity.takeDamage(),!0}}if("ArrowLeft"===t){const t=this.map.getTile(e.x-1,e.y);if(t.entity||!t.isWalkable)return!1;for(let t=e.x-1;t>=0;t--){const i=this.map.map[t][e.y];if(i.entity)return this.dispatchBeachBall(this.x,this.y,i.entity.x,i.entity.y),i.entity.takeDamage(),!0}}if("ArrowUp"===t){const t=this.map.getTile(e.x,e.y-1);if(t.entity||!t.isWalkable)return!1;for(let t=e.y-1;t>=0;t--){const i=this.map.map[e.x][t];if(i.entity)return this.dispatchBeachBall(this.x,this.y,i.entity.x,i.entity.y),i.entity.takeDamage(),!0}}if("ArrowDown"===t){const t=this.map.getTile(e.x,e.y+1);if(t.entity||!t.isWalkable)return!1;for(let t=e.y+1;t<i;t++){const i=this.map.map[e.x][t];if(i.entity)return this.dispatchBeachBall(this.x,this.y,i.entity.x,i.entity.y),i.entity.takeDamage(),!0}}return!0}return!1})}dash(){this.dispatchDirectionFunction(t=>{const e=this.map.getMapCoordsFromCanvasCoords(this.x,this.y),i=this.map.map.length;if(["ArrowRight","ArrowLeft","ArrowUp","ArrowDown"].includes(t)){if("ArrowRight"===t){const t=this.map.getTile(e.x+1,e.y);if(t.entity||!t.isWalkable)return!1;for(let t=e.x+1;t<i;t++){const i=this.map.map[t][e.y];if(i.entity)return i.entity.takeDamage(),this.speed=30,this.moveTo(t-1,e.y),!0;if(!this.map.isPassable(t,e.y))return this.moveTo(t-1,e.y),this.speed=30,!0}this.speed=30,this.moveTo(i-1,e.y)}if("ArrowLeft"===t){const t=this.map.getTile(e.x-1,e.y);if(t.entity||!t.isWalkable)return!1;for(let t=e.x-1;t>=0;t--){const i=this.map.map[t][e.y];if(i.entity)return i.entity.takeDamage(),this.speed=30,this.moveTo(t+1,e.y),!0;if(!this.map.isPassable(t,e.y))return this.moveTo(t+1,e.y),this.speed=30,!0}this.speed=30,this.moveTo(0,e.y)}if("ArrowUp"===t){const t=this.map.getTile(e.x,e.y-1);if(t.entity||!t.isWalkable)return!1;for(let t=e.y-1;t>=0;t--){const i=this.map.map[e.x][t];if(i.entity)return i.entity.takeDamage(),this.speed=30,this.moveTo(e.x,t+1),!0;if(!this.map.isPassable(e.x,t))return this.speed=30,this.moveTo(e.x,t+1),!0}this.speed=30,this.moveTo(e.x,0)}if("ArrowDown"===t){const t=this.map.getTile(e.x,e.y+1);if(t.entity||!t.isWalkable)return!1;for(let t=e.y+1;t<i;t++){const i=this.map.map[e.x][t];if(i.entity)return i.entity.takeDamage(),this.speed=30,this.moveTo(e.x,t-1),!0;if(!this.map.isPassable(e.x,t))return this.speed=30,this.moveTo(e.x,t-1),!0}this.speed=30,this.moveTo(e.x,i-1)}return!0}return!1})}damageTrap(){this.dispatchDirectionFunction(t=>{const e=function(){this.entity.takeDamage()},{x:i,y:n}=this.map.getMapCoordsFromCanvasCoords(this.x,this.y);if(["ArrowRight","ArrowLeft","ArrowUp","ArrowDown"].includes(t)){if("ArrowRight"===t){const t=this.map.getTile(i+1,n);if(t.entity||!t.isWalkable)return!1;t.trap="damage",t.trapCallback=e}if("ArrowLeft"===t){const t=this.map.getTile(i-1,n);if(t.entity||!t.isWalkable)return!1;t.trap="damage",t.trapCallback=e}if("ArrowUp"===t){const t=this.map.getTile(i,n-1);if(t.entity||!t.isWalkable)return!1;t.trap="damage",t.trapCallback=e}if("ArrowDown"===t){const t=this.map.getTile(i,n+1);if(t.entity||!t.isWalkable)return!1;t.trap="damage",t.trapCallback=e}return!0}return!1})}hitAllTrap(){this.dispatchDirectionFunction(t=>{const e=function(){Q.enemies.filter(t=>t.name===this.entity.name).forEach(t=>t.takeDamage())},{x:i,y:n}=this.map.getMapCoordsFromCanvasCoords(this.x,this.y);if(["ArrowRight","ArrowLeft","ArrowUp","ArrowDown"].includes(t)){if("ArrowRight"===t){const t=this.map.getTile(i+1,n);if(t.entity||!t.isWalkable)return!1;t.trap="hitAll",t.trapCallback=e}if("ArrowLeft"===t){const t=this.map.getTile(i-1,n);if(t.entity||!t.isWalkable)return!1;t.trap="hitAll",t.trapCallback=e}if("ArrowUp"===t){const t=this.map.getTile(i,n-1);if(t.entity||!t.isWalkable)return!1;t.trap="hitAll",t.trapCallback=e}if("ArrowDown"===t){const t=this.map.getTile(i,n+1);if(t.entity||!t.isWalkable)return!1;t.trap="hitAll",t.trapCallback=e}return!0}return!1})}waterAttack(){this.map.map.forEach(t=>{t.forEach(t=>{!t.isWalkable&&t.entity&&t.entity.takeDamage()})})}bugSpray(){Q.enemies.filter(t=>"wasp"===t.name).forEach(t=>t.takeDamage())}wait(){this.doneCallback()}};class Tt{constructor({x:t,y:e,tileSize:i,map:n,doneCallback:s=(()=>{}),noTile:o=!1}){if(this.map=n,this.x=t,this.displayX=t,this.y=e,this.displayY=e,this.tileSize=i,this.moving=!1,this.sprite=dt,this.doneCallback=s,this.hp=1,this.maxHp=1,this.speed=10,!o){this.map.getTileFromCanvasCoords(this.x,this.y).entity=this}}takeDamage(t=1){this.hp-=t,this.hp<1&&(this.getTile().entity=null,this.dead=!0)}getTile(){return this.map.getTileFromCanvasCoords(this.x,this.y)}takeTurn(){this.attackedThisTurn=!1}moveTo(t,e){const i=t*this.tileSize,n=e*this.tileSize,s=this.map.getMapCoordsFromCanvasCoords(i,n);if(!this.map.isInBounds(s.x,s.y))return!1;const o=this.map.getTileFromCanvasCoords(i,n),r=this.map.getTileFromCanvasCoords(this.x,this.y);if(o&&o.isEmpty()&&this.canWalkHere(s.x,s.y))return this.displayX=this.x,this.displayY=this.y,this.x=i,this.y=n,o.entity=this,o.triggerTrap(),r.entity=null,this.moving=!0,!0;if(o&&!o.isEmpty()){const{entity:t}=o;if(t.isRoosta||this.isRoosta)return this.displayX-=(this.displayX-t.x)/3,this.displayY-=(this.displayY-t.y)/3,t.takeDamage(),this.attackedThisTurn=!0,!0}return!1}move(t,e,i=!1){const n=this.x+this.tileSize*t,s=this.y+this.tileSize*e,o=this.map.getMapCoordsFromCanvasCoords(n,s);if(!this.map.isInBounds(o.x,o.y))return!1;const r=this.map.getTileFromCanvasCoords(n,s),a=this.map.getTileFromCanvasCoords(this.x,this.y);if(r&&r.isEmpty()&&this.canWalkHere(o.x,o.y))return this.displayX=this.x,this.displayY=this.y,this.x=n,this.y=s,r.entity=this,r.triggerTrap(),a.entity=null,this.moving=!0,!0;if(r&&!r.isEmpty()&&!i){const{entity:t}=r;if(t.isRoosta||this.isRoosta)return this.displayX-=(this.displayX-t.x)/3,this.displayY-=(this.displayY-t.y)/3,t.takeDamage(),this.attackedThisTurn=!0,!0}return!1}canWalkHere(t,e){return this.isBeingMoved?(this.isBeingMoved=!1,this.map.isInBounds(t,e)):this.map.isPassable(t,e)}draw(){const{displayX:t,displayY:e,tileSize:i}=this;this.sprite.draw(t,e,i,i)}keydown(){}keyup(){}update(t){let e=!0;Math.abs(this.displayX-this.x)>2?this.displayX-=(this.displayX-this.x)*this.speed*t:(this.displayX=this.x,e=!1),Math.abs(this.displayY-this.y)>2?this.displayY-=(this.displayY-this.y)*this.speed*t:(this.displayY=this.y,e||(this.moving=!1,this.speed=10))}}class At extends(bt(Tt)){constructor(t){super(t),this.isRoosta=!0,this.hp=3,this.maxHp=3,this.sprite=ot,this.coins=0}takeDamage(){super.takeDamage(),document.dispatchEvent(new CustomEvent("sound",{detail:{sound:"cluck"}})),document.dispatchEvent(new CustomEvent("screenShake",{})),this.hp<1&&document.dispatchEvent(new CustomEvent("die",{}))}wait(){this.doneCallback()}move(t,e){if(super.move(t,e)){const t=this.map.getTileFromCanvasCoords(this.x,this.y);t.coin&&(t.coin=!1,this.coins++,document.dispatchEvent(new CustomEvent("sound",{detail:{sound:"coin"}})),V(Q.level,this.coins),this.coins%3==0&&(this.getRandomSpell(),N(this.spells))),t.exit?document.dispatchEvent(new CustomEvent("exit")):this.doneCallback()}}keydown(t){"ArrowRight"===t&&this.move(1,0),"ArrowLeft"===t&&this.move(-1,0),"ArrowUp"===t&&this.move(0,-1),"ArrowDown"===t&&this.move(0,1),t>=1&&t<=9&&this.doSpell(this.spells[t-1])}drawAvailableDirections(){const t=K/2,e=this.x+K/2-t/2,i=this.y+K/2-t/2,{x:n,y:s}=this.map.getMapCoordsFromCanvasCoords(this.x,this.y);this.map.getAdjacentEmptyTiles(n,s).forEach(o=>{o.y-s==-1&&et.draw(e,this.y-K/4,t,t),o.y-s==1&&it.draw(e,this.y+K-K/4,t,t),o.x-n==-1&&st.draw(this.x-K/4,i,t,t),o.x-n==1&&nt.draw(this.x+K-K/4,i,t,t)})}draw(){super.draw();const{displayX:t,displayY:e,tileSize:i}=this;for(let n=0;n<this.hp;n++)lt.draw(8+t+24*n,e+64,i,i)}}class kt extends Tt{constructor(t){super(t),this.spawning=!0}takeTurn(t){if(super.takeTurn(),this.spawning)return void(this.spawning=!1);if(this.stunned)return void(this.stunned=!1);if(this.dead)return;const e=this.map.getMapCoordsFromCanvasCoords(t.x,t.y),i=new X.AStar(e.x,e.y,this.aStarCallback.bind(this),{topology:4}),n=this.map.getMapCoordsFromCanvasCoords(this.x,this.y),s=[];if(i.compute(n.x,n.y,(t,e)=>s.push({x:t,y:e})),s[1]){const t=s[1].x-n.x,e=s[1].y-n.y;this.move(t,e)}}aStarCallback(t,e){return this.map.isPassable(t,e)}update(t){super.update(t),this.shakeTimer-=t}draw(){const{displayX:t,displayY:e,tileSize:i}=this;let n=0,s=0;this.shakeTimer>0&&(n=U(-50,50)*this.shakeTimer,s=U(-50,50)*this.shakeTimer),this.spawning?gt.draw(t,e,i,i):this.sprite.draw(t+n,e+s,i,i)}takeDamage(t){super.takeDamage(t),this.stunned=!0,this.spawning=!1,this.shakeTimer=.2,this.hp<1&&(document.dispatchEvent(new CustomEvent("splode",{detail:{x:this.x,y:this.y}})),document.dispatchEvent(new CustomEvent("sound",{detail:{sound:"pop"}})))}}class St extends kt{constructor(t){super(t),this.sprite=at,this.name="crab",this.hp=2}canWalkHere(t,e){return this.map.isInBounds(t,e)}aStarCallback(t,e){return this.map.isInBounds(t,e)}takeTurn(t){this.dead||super.takeTurn(t)}move(t,e){super.move(t,e)}takeDamage(t){super.takeDamage(t),this.hp>0&&document.dispatchEvent(new CustomEvent("sound",{detail:{sound:"snap"}})),1===this.hp&&(this.sprite=_t)}}class Ct extends kt{constructor(t){super(t),this.sprite=Math.random()<.8?rt:dt,this.hp=2,this.duck=!0,this.name="duck"}takeDamage(t){super.takeDamage(t),this.hp>0&&document.dispatchEvent(new CustomEvent("sound",{detail:{sound:"quack"}})),1===this.hp&&(this.sprite=pt)}update(t){super.update(t)}}class Mt extends kt{constructor(t){super(t),this.sprite=ht,this.name="snake",this.hp=2}takeDamage(t){super.takeDamage(t),this.hp>0&&document.dispatchEvent(new CustomEvent("sound",{detail:{sound:"snap"}})),1===this.hp&&(this.sprite=mt)}}class Et extends kt{constructor(t){super(t),this.sprite=ct,this.name="wasp"}takeTurn(t){super.takeTurn(t),this.attackedThisTurn||super.takeTurn(t)}}class It extends kt{constructor(t){super(t),this.sprite=ut,this.stunned=!1,this.name="star",this.hp=2}takeTurn(t){this.stunned?this.stunned=!this.stunned:(super.takeTurn(t),this.stunned=!0)}takeDamage(t){super.takeDamage(t),this.hp>0&&document.dispatchEvent(new CustomEvent("sound",{detail:{sound:"oof"}})),1===this.hp&&(this.sprite=ft)}}const Pt=J.getSprite(12,0),Rt=J.getSprite(13,0),Dt=J.getSprite(18,0),Ft=J.getSprite(16,0);class Bt{constructor({isWalkable:t,sprite:e,x:i,y:n}){this.isWalkable=t,this.x=i,this.y=n,this.sprite=e,this.entity=null,this.trap=null,this.trapCallback=null,this.effectCounter=0,this.exit=!1,this.coin=!1}triggerTrap(){this.trapCallback&&(this.trapCallback(),this.trap=null,this.trapCallback=null)}isEmpty(){return!this.entity}setEffect(t){this.effect=t,this.effectCounter=1}update(t){this.effectCounter&&(this.effectCounter=Math.max(this.effectCounter-t,0))}drawEffect(t,e){this.effectCounter&&(Q.context.globalAlpha=this.effectCounter/1,this.effect.draw(t*K,e*K,K,K),Q.context.globalAlpha=1)}draw(t,e){this.sprite.draw(t*K,e*K,K,K),this.trap&&("damage"===this.trap&&Rt.draw(t*K,e*K,K,K),"hitAll"===this.trap&&Pt.draw(t*K,e*K,K,K)),this.exit&&Dt.draw(t*K,e*K,K,K),this.coin&&Ft.draw(t*K,e*K,K,K)}}class Ot{constructor({gridSize:t,tileSize:e}){this.gridSize=t,this.tileSize=e,this.spriteSheet=J,this.map=[];const i=new W.Cellular(t,t,{born:[4,5],survive:[2,3,4,5],connected:!0});i.randomize(.4),i.create(),i.create(),i.connect(this.createMapCallback.bind(this));const{x:n,y:s}=this.randomEmptyTile();this.getTile(n,s).exit=!0;for(let t=0;t<3;t++){const{x:t,y:e}=this.randomEmptyTile();this.getTile(t,e).coin=!0}}createMapCallback(t,e,i){const n=this.spriteSheet.getSprite(2,0),s=new Bt({isWalkable:!1,sprite:n,x:t,y:e}),o=this.spriteSheet.getSprite(1,0),r=new Bt({isWalkable:!0,sprite:o,x:t,y:e});this.map[t]||(this.map[t]=[]),this.map[t][e]=i?s:r}getTile(t,e){return this.map[t][e]}getTileFromCanvasCoords(t,e){const i=Math.ceil(t/this.tileSize),n=Math.ceil(e/this.tileSize);return this.map[i][n]}getMapCoordsFromCanvasCoords(t,e){return{x:Math.ceil(t/this.tileSize),y:Math.ceil(e/this.tileSize)}}isInBounds(t,e){return t>=0&&t<this.gridSize&&e>=0&&e<this.gridSize}isPassable(t,e){let i=!1;return this.map[t]&&this.map[t][e]&&(i=this.isInBounds(t,e)&&this.map[t][e].isWalkable),i}isEmpty(t,e){return!(!this.map[t]||!this.map[t][e])&&(this.isInBounds(t,e)&&this.map[t][e].isEmpty())}update(t){this.map.forEach((e,i)=>{e.forEach((e,i)=>{e.update(t)})})}draw(){this.map.forEach((t,e)=>{t.forEach((t,i)=>{t.draw(e,i)})})}drawEffects(){this.map.forEach((t,e)=>{t.forEach((t,i)=>{t.drawEffect(e,i)})})}getAdjacentTiles(t,e){const i=[],n=t-1,s=t+1,o=e-1,r=e+1;return this.isInBounds(n,e)&&i.push(this.getTile(n,e)),this.isInBounds(s,e)&&i.push(this.getTile(s,e)),this.isInBounds(t,o)&&i.push(this.getTile(t,o)),this.isInBounds(t,r)&&i.push(this.getTile(t,r)),i}getAdjacentEmptyTiles(t,e){return this.getAdjacentTiles(t,e).filter(t=>t.isEmpty()&&t.isWalkable)}randomEmptyTile(){const t=U(0,this.gridSize),e=U(0,this.gridSize);return this.map[t][e].isEmpty()&&this.map[t][e].isWalkable&&!this.map[t][e].exit?{x:t,y:e}:this.randomEmptyTile()}}class zt{constructor({x:t,y:e,pixelSize:i,noFall:n,colorArray:s,life:o=U(1,2)}){this.x=t,this.y=e,this.pixelSize=i,this.dx=400*(2*Math.random()-1),this.dy=400*(2*Math.random()-1),this.color=Y(s),this.life=o,this.noFall=n}update(t){this.x+=this.dx*t,this.y+=this.dy*t,this.noFall||(this.dy+=30),this.life-=t,(this.x<0||this.x>Q.width||this.y<0||this.y>Q.height||this.life<0)&&(this.dead=!0)}draw(){Q.context.fillStyle=this.color,Q.context.globalAlpha=Math.max(this.life,0),Q.context.fillRect(this.x,this.y,this.pixelSize,this.pixelSize),Q.context.globalAlpha=1}}var Ht=i(1),Wt=(i.p,i.p,i.p,i.p,i.p,i.p,i.p,i.p,i.p,i.p+"79e2532c385f2a8a71afab6edb778f80.wav");i.p;const Lt=new Ht.Howl({src:["../sounds/pop1.mp3"]}),Xt=new Ht.Howl({src:["../sounds/pop2.mp3"]}),Ut=new Ht.Howl({src:["../sounds/pop3.mp3"]}),Yt=new Ht.Howl({src:["../sounds/cluck1.mp3"]}),Gt=new Ht.Howl({src:["../sounds/cluck2.mp3"]}),jt=new Ht.Howl({src:["../sounds/quack.wav"]}),qt=new Ht.Howl({src:["../sounds/oof.wav"]}),Nt=new Ht.Howl({src:["../sounds/snap.wav"]}),Vt=new Ht.Howl({src:["../sounds/coin.wav"]}),$t=new Ht.Howl({src:[Wt]}),Qt=new Ht.Howl({src:["../sounds/steel2.wav"]}),Kt=new Ht.Howl({src:["../sounds/waves.mp3"],loop:!0,volume:.1}),Zt=new Ht.Howl({src:["../sounds/gulls.mp3"],loop:!0,volume:.05});document.addEventListener("sound",({detail:t})=>{"pop"===t.sound&&Y([Lt,Xt,Ut]).play(),"cluck"===t.sound&&Y([Yt,Gt]).play(),"quack"===t.sound&&jt.play(),"oof"===t.sound&&qt.play(),"snap"===t.sound&&Nt.play(),"coin"===t.sound&&Vt.play(),"steel"===t.sound&&Y([$t,Qt]).play(),"background"===t.sound&&(Kt.play(),Zt.play())});let Jt="menu",te={};const ee=function(t,e,i,n=function(){},s=function(){}){let o=e,r=Object.assign({},i);const a={state:o,context:r};return function(e,i){if(s(`sent '${e}'`),!e)return s("no event. returning currentState"),a;const l=t.find(t=>t.name===o);if(l){const a=Object.keys(l.transitions||{}).find(t=>t===e),h=l.transitions[a],c=h?h(i,r):{state:o,context:r};if(h){const i=t.find(t=>t.name===c.state);if(!i)throw`the transition '${e}' of current state '${o}', returned a non-existant desired state '${c.state}'.`;l.exit&&l.exit(),o=c.state,c.context=r=c.context?c.context:r,s(`state changed to '${c.state}'`),n(c);const a=i.enter&&i.enter(c.context||r);!a||a instanceof Promise||(r=c.context=a,n(c))}else s(`state '${o}' does not handle event '${e}'.`);return c}return s("could not find active state"),a}}([s("menu",{start:(t,e)=>(Q.level=1,oe(),document.dispatchEvent(new CustomEvent("sound",{detail:{sound:"background"}})),{state:"fadeIn",context:{...e,faderOpacity:1}})}),s("fadeIn",{transitionEnd:()=>({state:"play"})}),s("play",{die:()=>({state:"dying"}),win:()=>({state:"winScreen"}),receiveDirectionFunction:()=>{var t;return t="select a direction, <br>ESC to cancel",G.innerHTML=t,{state:"waitingForInput"}}}),s("waitingForInput",{resumePlaying:()=>(N(se.spells),{state:"play"})}),s("dying",{transitionEnd:(t,e)=>({state:"fadeToBlack",context:{...e,faderOpacity:0}})}),s("fadeToBlack",{transitionEnd:()=>({state:"gameOver"})}),s("winScreen",{restart:()=>({state:"menu"})}),s("gameOver",{restart:()=>({state:"menu"})})],"menu",{faderOpacity:0},(function(t){Jt=t.state,te=t.context})),ie=new class{constructor(t){this.pixelSize=t,this.particles=[]}splode(t,e,i=!1,n=Object.values(yt),s){for(let o=0;o<60;o++)this.particles.push(new zt({x:t,y:e,pixelSize:this.pixelSize,noFall:i,colorArray:n,life:s}))}update(t){this.particles=this.particles.filter(t=>!t.dead),this.particles.forEach(e=>{e.update(t)})}draw(t){this.particles.forEach(e=>{e.draw(t)})}}(2*Z);let ne,se;Q.level=1;const oe=function({existingRoosta:t}={}){document.dispatchEvent(new CustomEvent("sound",{detail:{sound:"steel"}})),ne=new Ot({gridSize:7,tileSize:K});const e=ne.randomEmptyTile();t?(se.map=ne,se.heal(!0),se.resetSpells(),se.moveTo(e.x,e.y)):se=new At({x:e.x*K,y:e.y*K,tileSize:K,map:ne,doneCallback:ae}),Q.enemies=[];const i=[It,Ct,St,Mt,Et];function n(){const t=Y(i),e=ne.randomEmptyTile();Q.enemies.push(new t({x:e.x*K,y:e.y*K,tileSize:K,map:ne}))}for(let t=0;t<Q.level+2;t++)n();re=0,N(se.spells),V(Q.level,se.coins)};let re=0;const ae=function(){const t=[It,Ct,St,Mt,Et];re++,he=!0;const e=[];Q.enemies.forEach((t,i)=>{e.push(new Promise(e=>{setTimeout(()=>{t.takeTurn(se),e()},50+50*i)}))}),Promise.all(e).then(()=>he=!1),re%Math.max(10-Q.level,3)==0&&function(){const e=Y(t),i=ne.randomEmptyTile();Q.enemies.push(new e({x:i.x*K,y:i.y*K,tileSize:K,map:ne}))}()};let le,he=!1;document.addEventListener("splode",({detail:t})=>{ie.splode(t.x+K/2,t.y+K/2,t.noFall,t.colorArray,t.life)}),document.addEventListener("die",({detail:t})=>{he=!0,ee("die")}),document.addEventListener("screenShake",({detail:t})=>{le=10});let ce=null;document.addEventListener("beachBall",({detail:{x1:t,y1:e,x2:i,y2:n}})=>{ce=new Tt({x:i,y:n,tileSize:K,map:ne,noTile:!0}),ce.sprite=J.getSprite(11,0),ce.displayX=t,ce.displayY=e});let ue=null;document.addEventListener("directionFunction",({detail:t})=>{ee("receiveDirectionFunction"),ue=t.callback}),document.addEventListener("exit",()=>{Q.level+=1,Q.level>6?ee("win"):oe({existingRoosta:se})}),document.addEventListener("keydown",({key:t})=>{if("menu"===Jt&&ee("start"),"gameOver"!==Jt&&"winScreen"!==Jt||ee("restart"),"waitingForInput"===Jt)return"Escape"===t?void ee("resumePlaying"):void(ue(t)&&ee("resumePlaying"));he||se.keydown(t)}),document.addEventListener("keyup",({key:t})=>{he||se.keyup(t)}),Q.update=function(t){"menu"!==Jt&&(se.update(t),this.enemies=this.enemies.filter(t=>!t.dead),this.enemies.forEach(e=>e.update(t)),ie.update(t),ne.update(t),ce&&(ce.update(t),ce.speed+=8,ce.displayX===ce.x&&ce.displayY===ce.y&&(document.dispatchEvent(new CustomEvent("splode",{detail:{x:ce.x,y:ce.y}})),ce=null)),"fadeToBlack"===Jt&&(he=!0,te.faderOpacity+=.04,te.faderOpacity>=1.7&&(ee("transitionEnd"),le=0)),"fadeIn"===Jt&&(he=!0,te.faderOpacity-=.08,te.faderOpacity<=0&&(ee("transitionEnd"),he=!1)),"dying"===Jt?(he=!0,le+=.2,le>20&&ee("transitionEnd")):le&&"play"===Jt&&(le=Math.max(le-80*t,0)))},Q.draw=function(){if(Q.context.fillStyle=yt.black,Q.context.fillRect(-100,-100,2e3,2e3),"menu"===Jt)return Q.context.font="25px Goblin",Q.context.fillStyle=yt.gray,void Q.context.fillText("press a key to start",40,100);if("gameOver"===Jt)return Q.context.font="25px Goblin",Q.context.fillStyle=yt.gray,Q.context.fillText("dead",60,100),void Q.context.fillText("press a key to retry",20,300);if("winScreen"===Jt)return Q.context.font="25px Goblin",Q.context.fillStyle=yt.gray,Q.context.fillText("YOU WIN",60,100),void Q.context.fillText("press a key to retry",20,300);if(["waitingForInput","play","fadeToBlack","fadeIn","dying"].includes(Jt)){const t=Math.random()*Math.PI*2,e=Math.round(Math.cos(t)*le),i=Math.round(Math.sin(t)*le);Q.context.setTransform(1,0,0,1,e,i),ne.draw(),this.enemies.forEach(t=>{t.dead||t.draw()}),ce&&ce.draw(),se.draw(),"waitingForInput"==Jt&&se.drawAvailableDirections(),ie.draw(Q.context)}"fadeToBlack"!==Jt&&"fadeIn"!==Jt||(Q.context.fillStyle=`rgba(23, 17, 26, ${te.faderOpacity})`,Q.context.fillRect(-Q.width,-Q.height,3*Q.width,3*Q.height)),ne.drawEffects()},Q.start()}]);