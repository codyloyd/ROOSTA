!function(t){var e={};function i(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(n,o,function(e){return t[e]}.bind(null,o));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=11)}([function(t,e,i){"use strict";const n=2.3283064365386963e-10;class o{constructor(){this._seed=0,this._s0=0,this._s1=0,this._s2=0,this._c=0}getSeed(){return this._seed}setSeed(t){return t=t<1?1/t:t,this._seed=t,this._s0=(t>>>0)*n,t=69069*t+1>>>0,this._s1=t*n,t=69069*t+1>>>0,this._s2=t*n,this._c=1,this}getUniform(){let t=2091639*this._s0+this._c*n;return this._s0=this._s1,this._s1=this._s2,this._c=0|t,this._s2=t-this._c,this._s2}getUniformInt(t,e){let i=Math.max(t,e),n=Math.min(t,e);return Math.floor(this.getUniform()*(i-n+1))+n}getNormal(t=0,e=1){let i,n,o;do{i=2*this.getUniform()-1,n=2*this.getUniform()-1,o=i*i+n*n}while(o>1||0==o);return t+i*Math.sqrt(-2*Math.log(o)/o)*e}getPercentage(){return 1+Math.floor(100*this.getUniform())}getItem(t){return t.length?t[Math.floor(this.getUniform()*t.length)]:null}shuffle(t){let e=[],i=t.slice();for(;i.length;){let t=i.indexOf(this.getItem(i));e.push(i.splice(t,1)[0])}return e}getWeightedValue(t){let e=0;for(let i in t)e+=t[i];let i,n=this.getUniform()*e,o=0;for(i in t)if(o+=t[i],n<o)return i;return i}getState(){return[this._s0,this._s1,this._s2,this._c]}setState(t){return this._s0=t[0],this._s1=t[1],this._s2=t[2],this._c=t[3],this}clone(){return(new o).setState(this.getState())}}e.a=(new o).setSeed(Date.now())},function(t,e,i){(function(i){var n;
/*!
 *  howler.js v2.2.0
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */!function(){"use strict";var o=function(){this.init()};o.prototype={init:function(){var t=this||s;return t._counter=1e3,t._html5AudioPool=[],t.html5PoolSize=10,t._codecs={},t._howls=[],t._muted=!1,t._volume=1,t._canPlayEvent="canplaythrough",t._navigator="undefined"!=typeof window&&window.navigator?window.navigator:null,t.masterGain=null,t.noAudio=!1,t.usingWebAudio=!0,t.autoSuspend=!0,t.ctx=null,t.autoUnlock=!0,t._setup(),t},volume:function(t){var e=this||s;if(t=parseFloat(t),e.ctx||p(),void 0!==t&&t>=0&&t<=1){if(e._volume=t,e._muted)return e;e.usingWebAudio&&e.masterGain.gain.setValueAtTime(t,s.ctx.currentTime);for(var i=0;i<e._howls.length;i++)if(!e._howls[i]._webAudio)for(var n=e._howls[i]._getSoundIds(),o=0;o<n.length;o++){var r=e._howls[i]._soundById(n[o]);r&&r._node&&(r._node.volume=r._volume*t)}return e}return e._volume},mute:function(t){var e=this||s;e.ctx||p(),e._muted=t,e.usingWebAudio&&e.masterGain.gain.setValueAtTime(t?0:e._volume,s.ctx.currentTime);for(var i=0;i<e._howls.length;i++)if(!e._howls[i]._webAudio)for(var n=e._howls[i]._getSoundIds(),o=0;o<n.length;o++){var r=e._howls[i]._soundById(n[o]);r&&r._node&&(r._node.muted=!!t||r._muted)}return e},stop:function(){for(var t=this||s,e=0;e<t._howls.length;e++)t._howls[e].stop();return t},unload:function(){for(var t=this||s,e=t._howls.length-1;e>=0;e--)t._howls[e].unload();return t.usingWebAudio&&t.ctx&&void 0!==t.ctx.close&&(t.ctx.close(),t.ctx=null,p()),t},codecs:function(t){return(this||s)._codecs[t.replace(/^x-/,"")]},_setup:function(){var t=this||s;if(t.state=t.ctx&&t.ctx.state||"suspended",t._autoSuspend(),!t.usingWebAudio)if("undefined"!=typeof Audio)try{void 0===(new Audio).oncanplaythrough&&(t._canPlayEvent="canplay")}catch(e){t.noAudio=!0}else t.noAudio=!0;try{(new Audio).muted&&(t.noAudio=!0)}catch(t){}return t.noAudio||t._setupCodecs(),t},_setupCodecs:function(){var t=this||s,e=null;try{e="undefined"!=typeof Audio?new Audio:null}catch(e){return t}if(!e||"function"!=typeof e.canPlayType)return t;var i=e.canPlayType("audio/mpeg;").replace(/^no$/,""),n=t._navigator&&t._navigator.userAgent.match(/OPR\/([0-6].)/g),o=n&&parseInt(n[0].split("/")[1],10)<33;return t._codecs={mp3:!(o||!i&&!e.canPlayType("audio/mp3;").replace(/^no$/,"")),mpeg:!!i,opus:!!e.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!e.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!e.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!e.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),aac:!!e.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!e.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(e.canPlayType("audio/x-m4a;")||e.canPlayType("audio/m4a;")||e.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(e.canPlayType("audio/x-m4b;")||e.canPlayType("audio/m4b;")||e.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(e.canPlayType("audio/x-mp4;")||e.canPlayType("audio/mp4;")||e.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!e.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,""),webm:!!e.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,""),dolby:!!e.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(e.canPlayType("audio/x-flac;")||e.canPlayType("audio/flac;")).replace(/^no$/,"")},t},_unlockAudio:function(){var t=this||s;if(!t._audioUnlocked&&t.ctx){t._audioUnlocked=!1,t.autoUnlock=!1,t._mobileUnloaded||44100===t.ctx.sampleRate||(t._mobileUnloaded=!0,t.unload()),t._scratchBuffer=t.ctx.createBuffer(1,1,22050);var e=function(i){for(;t._html5AudioPool.length<t.html5PoolSize;)try{var n=new Audio;n._unlocked=!0,t._releaseHtml5Audio(n)}catch(i){t.noAudio=!0;break}for(var o=0;o<t._howls.length;o++)if(!t._howls[o]._webAudio)for(var s=t._howls[o]._getSoundIds(),r=0;r<s.length;r++){var a=t._howls[o]._soundById(s[r]);a&&a._node&&!a._node._unlocked&&(a._node._unlocked=!0,a._node.load())}t._autoResume();var l=t.ctx.createBufferSource();l.buffer=t._scratchBuffer,l.connect(t.ctx.destination),void 0===l.start?l.noteOn(0):l.start(0),"function"==typeof t.ctx.resume&&t.ctx.resume(),l.onended=function(){l.disconnect(0),t._audioUnlocked=!0,document.removeEventListener("touchstart",e,!0),document.removeEventListener("touchend",e,!0),document.removeEventListener("click",e,!0);for(var i=0;i<t._howls.length;i++)t._howls[i]._emit("unlock")}};return document.addEventListener("touchstart",e,!0),document.addEventListener("touchend",e,!0),document.addEventListener("click",e,!0),t}},_obtainHtml5Audio:function(){var t=this||s;if(t._html5AudioPool.length)return t._html5AudioPool.pop();var e=(new Audio).play();return e&&"undefined"!=typeof Promise&&(e instanceof Promise||"function"==typeof e.then)&&e.catch((function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")})),new Audio},_releaseHtml5Audio:function(t){var e=this||s;return t._unlocked&&e._html5AudioPool.push(t),e},_autoSuspend:function(){var t=this;if(t.autoSuspend&&t.ctx&&void 0!==t.ctx.suspend&&s.usingWebAudio){for(var e=0;e<t._howls.length;e++)if(t._howls[e]._webAudio)for(var i=0;i<t._howls[e]._sounds.length;i++)if(!t._howls[e]._sounds[i]._paused)return t;return t._suspendTimer&&clearTimeout(t._suspendTimer),t._suspendTimer=setTimeout((function(){if(t.autoSuspend){t._suspendTimer=null,t.state="suspending";var e=function(){t.state="suspended",t._resumeAfterSuspend&&(delete t._resumeAfterSuspend,t._autoResume())};t.ctx.suspend().then(e,e)}}),3e4),t}},_autoResume:function(){var t=this;if(t.ctx&&void 0!==t.ctx.resume&&s.usingWebAudio)return"running"===t.state&&"interrupted"!==t.ctx.state&&t._suspendTimer?(clearTimeout(t._suspendTimer),t._suspendTimer=null):"suspended"===t.state||"running"===t.state&&"interrupted"===t.ctx.state?(t.ctx.resume().then((function(){t.state="running";for(var e=0;e<t._howls.length;e++)t._howls[e]._emit("resume")})),t._suspendTimer&&(clearTimeout(t._suspendTimer),t._suspendTimer=null)):"suspending"===t.state&&(t._resumeAfterSuspend=!0),t}};var s=new o,r=function(t){t.src&&0!==t.src.length?this.init(t):console.error("An array of source files must be passed with any new Howl.")};r.prototype={init:function(t){var e=this;return s.ctx||p(),e._autoplay=t.autoplay||!1,e._format="string"!=typeof t.format?t.format:[t.format],e._html5=t.html5||!1,e._muted=t.mute||!1,e._loop=t.loop||!1,e._pool=t.pool||5,e._preload="boolean"!=typeof t.preload&&"metadata"!==t.preload||t.preload,e._rate=t.rate||1,e._sprite=t.sprite||{},e._src="string"!=typeof t.src?t.src:[t.src],e._volume=void 0!==t.volume?t.volume:1,e._xhr={method:t.xhr&&t.xhr.method?t.xhr.method:"GET",headers:t.xhr&&t.xhr.headers?t.xhr.headers:null,withCredentials:!(!t.xhr||!t.xhr.withCredentials)&&t.xhr.withCredentials},e._duration=0,e._state="unloaded",e._sounds=[],e._endTimers={},e._queue=[],e._playLock=!1,e._onend=t.onend?[{fn:t.onend}]:[],e._onfade=t.onfade?[{fn:t.onfade}]:[],e._onload=t.onload?[{fn:t.onload}]:[],e._onloaderror=t.onloaderror?[{fn:t.onloaderror}]:[],e._onplayerror=t.onplayerror?[{fn:t.onplayerror}]:[],e._onpause=t.onpause?[{fn:t.onpause}]:[],e._onplay=t.onplay?[{fn:t.onplay}]:[],e._onstop=t.onstop?[{fn:t.onstop}]:[],e._onmute=t.onmute?[{fn:t.onmute}]:[],e._onvolume=t.onvolume?[{fn:t.onvolume}]:[],e._onrate=t.onrate?[{fn:t.onrate}]:[],e._onseek=t.onseek?[{fn:t.onseek}]:[],e._onunlock=t.onunlock?[{fn:t.onunlock}]:[],e._onresume=[],e._webAudio=s.usingWebAudio&&!e._html5,void 0!==s.ctx&&s.ctx&&s.autoUnlock&&s._unlockAudio(),s._howls.push(e),e._autoplay&&e._queue.push({event:"play",action:function(){e.play()}}),e._preload&&"none"!==e._preload&&e.load(),e},load:function(){var t=null;if(s.noAudio)this._emit("loaderror",null,"No audio support.");else{"string"==typeof this._src&&(this._src=[this._src]);for(var e=0;e<this._src.length;e++){var i,n;if(this._format&&this._format[e])i=this._format[e];else{if("string"!=typeof(n=this._src[e])){this._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}(i=/^data:audio\/([^;,]+);/i.exec(n))||(i=/\.([^.]+)$/.exec(n.split("?",1)[0])),i&&(i=i[1].toLowerCase())}if(i||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),i&&s.codecs(i)){t=this._src[e];break}}if(t)return this._src=t,this._state="loading","https:"===window.location.protocol&&"http:"===t.slice(0,5)&&(this._html5=!0,this._webAudio=!1),new a(this),this._webAudio&&h(this),this;this._emit("loaderror",null,"No codec support for selected audio sources.")}},play:function(t,e){var i=this,n=null;if("number"==typeof t)n=t,t=null;else{if("string"==typeof t&&"loaded"===i._state&&!i._sprite[t])return null;if(void 0===t&&(t="__default",!i._playLock)){for(var o=0,r=0;r<i._sounds.length;r++)i._sounds[r]._paused&&!i._sounds[r]._ended&&(o++,n=i._sounds[r]._id);1===o?t=null:n=null}}var a=n?i._soundById(n):i._inactiveSound();if(!a)return null;if(n&&!t&&(t=a._sprite||"__default"),"loaded"!==i._state){a._sprite=t,a._ended=!1;var l=a._id;return i._queue.push({event:"play",action:function(){i.play(l)}}),l}if(n&&!a._paused)return e||i._loadQueue("play"),a._id;i._webAudio&&s._autoResume();var h=Math.max(0,a._seek>0?a._seek:i._sprite[t][0]/1e3),u=Math.max(0,(i._sprite[t][0]+i._sprite[t][1])/1e3-h),d=1e3*u/Math.abs(a._rate),c=i._sprite[t][0]/1e3,p=(i._sprite[t][0]+i._sprite[t][1])/1e3;a._sprite=t,a._ended=!1;var _=function(){a._paused=!1,a._seek=h,a._start=c,a._stop=p,a._loop=!(!a._loop&&!i._sprite[t][2])};if(!(h>=p)){var f=a._node;if(i._webAudio){var m=function(){i._playLock=!1,_(),i._refreshBuffer(a);var t=a._muted||i._muted?0:a._volume;f.gain.setValueAtTime(t,s.ctx.currentTime),a._playStart=s.ctx.currentTime,void 0===f.bufferSource.start?a._loop?f.bufferSource.noteGrainOn(0,h,86400):f.bufferSource.noteGrainOn(0,h,u):a._loop?f.bufferSource.start(0,h,86400):f.bufferSource.start(0,h,u),d!==1/0&&(i._endTimers[a._id]=setTimeout(i._ended.bind(i,a),d)),e||setTimeout((function(){i._emit("play",a._id),i._loadQueue()}),0)};"running"===s.state&&"interrupted"!==s.ctx.state?m():(i._playLock=!0,i.once("resume",m),i._clearTimer(a._id))}else{var g=function(){f.currentTime=h,f.muted=a._muted||i._muted||s._muted||f.muted,f.volume=a._volume*s.volume(),f.playbackRate=a._rate;try{var n=f.play();if(n&&"undefined"!=typeof Promise&&(n instanceof Promise||"function"==typeof n.then)?(i._playLock=!0,_(),n.then((function(){i._playLock=!1,f._unlocked=!0,e||(i._emit("play",a._id),i._loadQueue())})).catch((function(){i._playLock=!1,i._emit("playerror",a._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),a._ended=!0,a._paused=!0}))):e||(i._playLock=!1,_(),i._emit("play",a._id),i._loadQueue()),f.playbackRate=a._rate,f.paused)return void i._emit("playerror",a._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");"__default"!==t||a._loop?i._endTimers[a._id]=setTimeout(i._ended.bind(i,a),d):(i._endTimers[a._id]=function(){i._ended(a),f.removeEventListener("ended",i._endTimers[a._id],!1)},f.addEventListener("ended",i._endTimers[a._id],!1))}catch(t){i._emit("playerror",a._id,t)}};"data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"===f.src&&(f.src=i._src,f.load());var y=window&&window.ejecta||!f.readyState&&s._navigator.isCocoonJS;if(f.readyState>=3||y)g();else{i._playLock=!0;var v=function(){g(),f.removeEventListener(s._canPlayEvent,v,!1)};f.addEventListener(s._canPlayEvent,v,!1),i._clearTimer(a._id)}}return a._id}i._ended(a)},pause:function(t){var e=this;if("loaded"!==e._state||e._playLock)return e._queue.push({event:"pause",action:function(){e.pause(t)}}),e;for(var i=e._getSoundIds(t),n=0;n<i.length;n++){e._clearTimer(i[n]);var o=e._soundById(i[n]);if(o&&!o._paused&&(o._seek=e.seek(i[n]),o._rateSeek=0,o._paused=!0,e._stopFade(i[n]),o._node))if(e._webAudio){if(!o._node.bufferSource)continue;void 0===o._node.bufferSource.stop?o._node.bufferSource.noteOff(0):o._node.bufferSource.stop(0),e._cleanBuffer(o._node)}else isNaN(o._node.duration)&&o._node.duration!==1/0||o._node.pause();arguments[1]||e._emit("pause",o?o._id:null)}return e},stop:function(t,e){var i=this;if("loaded"!==i._state||i._playLock)return i._queue.push({event:"stop",action:function(){i.stop(t)}}),i;for(var n=i._getSoundIds(t),o=0;o<n.length;o++){i._clearTimer(n[o]);var s=i._soundById(n[o]);s&&(s._seek=s._start||0,s._rateSeek=0,s._paused=!0,s._ended=!0,i._stopFade(n[o]),s._node&&(i._webAudio?s._node.bufferSource&&(void 0===s._node.bufferSource.stop?s._node.bufferSource.noteOff(0):s._node.bufferSource.stop(0),i._cleanBuffer(s._node)):isNaN(s._node.duration)&&s._node.duration!==1/0||(s._node.currentTime=s._start||0,s._node.pause(),s._node.duration===1/0&&i._clearSound(s._node))),e||i._emit("stop",s._id))}return i},mute:function(t,e){var i=this;if("loaded"!==i._state||i._playLock)return i._queue.push({event:"mute",action:function(){i.mute(t,e)}}),i;if(void 0===e){if("boolean"!=typeof t)return i._muted;i._muted=t}for(var n=i._getSoundIds(e),o=0;o<n.length;o++){var r=i._soundById(n[o]);r&&(r._muted=t,r._interval&&i._stopFade(r._id),i._webAudio&&r._node?r._node.gain.setValueAtTime(t?0:r._volume,s.ctx.currentTime):r._node&&(r._node.muted=!!s._muted||t),i._emit("mute",r._id))}return i},volume:function(){var t,e,i,n=this,o=arguments;if(0===o.length)return n._volume;if(1===o.length||2===o.length&&void 0===o[1]){var r=n._getSoundIds(),a=r.indexOf(o[0]);a>=0?e=parseInt(o[0],10):t=parseFloat(o[0])}else o.length>=2&&(t=parseFloat(o[0]),e=parseInt(o[1],10));if(!(void 0!==t&&t>=0&&t<=1))return(i=e?n._soundById(e):n._sounds[0])?i._volume:0;if("loaded"!==n._state||n._playLock)return n._queue.push({event:"volume",action:function(){n.volume.apply(n,o)}}),n;void 0===e&&(n._volume=t),e=n._getSoundIds(e);for(var l=0;l<e.length;l++)(i=n._soundById(e[l]))&&(i._volume=t,o[2]||n._stopFade(e[l]),n._webAudio&&i._node&&!i._muted?i._node.gain.setValueAtTime(t,s.ctx.currentTime):i._node&&!i._muted&&(i._node.volume=t*s.volume()),n._emit("volume",i._id));return n},fade:function(t,e,i,n){var o=this;if("loaded"!==o._state||o._playLock)return o._queue.push({event:"fade",action:function(){o.fade(t,e,i,n)}}),o;t=Math.min(Math.max(0,parseFloat(t)),1),e=Math.min(Math.max(0,parseFloat(e)),1),i=parseFloat(i),o.volume(t,n);for(var r=o._getSoundIds(n),a=0;a<r.length;a++){var l=o._soundById(r[a]);if(l){if(n||o._stopFade(r[a]),o._webAudio&&!l._muted){var h=s.ctx.currentTime,u=h+i/1e3;l._volume=t,l._node.gain.setValueAtTime(t,h),l._node.gain.linearRampToValueAtTime(e,u)}o._startFadeInterval(l,t,e,i,r[a],void 0===n)}}return o},_startFadeInterval:function(t,e,i,n,o,s){var r=this,a=e,l=i-e,h=Math.abs(l/.01),u=Math.max(4,h>0?n/h:n),d=Date.now();t._fadeTo=i,t._interval=setInterval((function(){var o=(Date.now()-d)/n;d=Date.now(),a+=l*o,a=l<0?Math.max(i,a):Math.min(i,a),a=Math.round(100*a)/100,r._webAudio?t._volume=a:r.volume(a,t._id,!0),s&&(r._volume=a),(i<e&&a<=i||i>e&&a>=i)&&(clearInterval(t._interval),t._interval=null,t._fadeTo=null,r.volume(i,t._id),r._emit("fade",t._id))}),u)},_stopFade:function(t){var e=this._soundById(t);return e&&e._interval&&(this._webAudio&&e._node.gain.cancelScheduledValues(s.ctx.currentTime),clearInterval(e._interval),e._interval=null,this.volume(e._fadeTo,t),e._fadeTo=null,this._emit("fade",t)),this},loop:function(){var t,e,i,n=this,o=arguments;if(0===o.length)return n._loop;if(1===o.length){if("boolean"!=typeof o[0])return!!(i=n._soundById(parseInt(o[0],10)))&&i._loop;t=o[0],n._loop=t}else 2===o.length&&(t=o[0],e=parseInt(o[1],10));for(var s=n._getSoundIds(e),r=0;r<s.length;r++)(i=n._soundById(s[r]))&&(i._loop=t,n._webAudio&&i._node&&i._node.bufferSource&&(i._node.bufferSource.loop=t,t&&(i._node.bufferSource.loopStart=i._start||0,i._node.bufferSource.loopEnd=i._stop)));return n},rate:function(){var t,e,i,n=this,o=arguments;if(0===o.length)e=n._sounds[0]._id;else if(1===o.length){var r=n._getSoundIds(),a=r.indexOf(o[0]);a>=0?e=parseInt(o[0],10):t=parseFloat(o[0])}else 2===o.length&&(t=parseFloat(o[0]),e=parseInt(o[1],10));if("number"!=typeof t)return(i=n._soundById(e))?i._rate:n._rate;if("loaded"!==n._state||n._playLock)return n._queue.push({event:"rate",action:function(){n.rate.apply(n,o)}}),n;void 0===e&&(n._rate=t),e=n._getSoundIds(e);for(var l=0;l<e.length;l++)if(i=n._soundById(e[l])){n.playing(e[l])&&(i._rateSeek=n.seek(e[l]),i._playStart=n._webAudio?s.ctx.currentTime:i._playStart),i._rate=t,n._webAudio&&i._node&&i._node.bufferSource?i._node.bufferSource.playbackRate.setValueAtTime(t,s.ctx.currentTime):i._node&&(i._node.playbackRate=t);var h=n.seek(e[l]),u=(n._sprite[i._sprite][0]+n._sprite[i._sprite][1])/1e3-h,d=1e3*u/Math.abs(i._rate);!n._endTimers[e[l]]&&i._paused||(n._clearTimer(e[l]),n._endTimers[e[l]]=setTimeout(n._ended.bind(n,i),d)),n._emit("rate",i._id)}return n},seek:function(){var t,e,i=this,n=arguments;if(0===n.length)e=i._sounds[0]._id;else if(1===n.length){var o=i._getSoundIds(),r=o.indexOf(n[0]);r>=0?e=parseInt(n[0],10):i._sounds.length&&(e=i._sounds[0]._id,t=parseFloat(n[0]))}else 2===n.length&&(t=parseFloat(n[0]),e=parseInt(n[1],10));if(void 0===e)return i;if("loaded"!==i._state||i._playLock)return i._queue.push({event:"seek",action:function(){i.seek.apply(i,n)}}),i;var a=i._soundById(e);if(a){if(!("number"==typeof t&&t>=0)){if(i._webAudio){var l=i.playing(e)?s.ctx.currentTime-a._playStart:0,h=a._rateSeek?a._rateSeek-a._seek:0;return a._seek+(h+l*Math.abs(a._rate))}return a._node.currentTime}var u=i.playing(e);u&&i.pause(e,!0),a._seek=t,a._ended=!1,i._clearTimer(e),i._webAudio||!a._node||isNaN(a._node.duration)||(a._node.currentTime=t);var d=function(){i._emit("seek",e),u&&i.play(e,!0)};if(u&&!i._webAudio){var c=function(){i._playLock?setTimeout(c,0):d()};setTimeout(c,0)}else d()}return i},playing:function(t){if("number"==typeof t){var e=this._soundById(t);return!!e&&!e._paused}for(var i=0;i<this._sounds.length;i++)if(!this._sounds[i]._paused)return!0;return!1},duration:function(t){var e=this._duration,i=this._soundById(t);return i&&(e=this._sprite[i._sprite][1]/1e3),e},state:function(){return this._state},unload:function(){for(var t=this,e=t._sounds,i=0;i<e.length;i++)e[i]._paused||t.stop(e[i]._id),t._webAudio||(t._clearSound(e[i]._node),e[i]._node.removeEventListener("error",e[i]._errorFn,!1),e[i]._node.removeEventListener(s._canPlayEvent,e[i]._loadFn,!1),s._releaseHtml5Audio(e[i]._node)),delete e[i]._node,t._clearTimer(e[i]._id);var n=s._howls.indexOf(t);n>=0&&s._howls.splice(n,1);var o=!0;for(i=0;i<s._howls.length;i++)if(s._howls[i]._src===t._src||t._src.indexOf(s._howls[i]._src)>=0){o=!1;break}return l&&o&&delete l[t._src],s.noAudio=!1,t._state="unloaded",t._sounds=[],t=null,null},on:function(t,e,i,n){var o=this["_on"+t];return"function"==typeof e&&o.push(n?{id:i,fn:e,once:n}:{id:i,fn:e}),this},off:function(t,e,i){var n=this["_on"+t],o=0;if("number"==typeof e&&(i=e,e=null),e||i)for(o=0;o<n.length;o++){var s=i===n[o].id;if(e===n[o].fn&&s||!e&&s){n.splice(o,1);break}}else if(t)this["_on"+t]=[];else{var r=Object.keys(this);for(o=0;o<r.length;o++)0===r[o].indexOf("_on")&&Array.isArray(this[r[o]])&&(this[r[o]]=[])}return this},once:function(t,e,i){return this.on(t,e,i,1),this},_emit:function(t,e,i){for(var n=this["_on"+t],o=n.length-1;o>=0;o--)n[o].id&&n[o].id!==e&&"load"!==t||(setTimeout(function(t){t.call(this,e,i)}.bind(this,n[o].fn),0),n[o].once&&this.off(t,n[o].fn,n[o].id));return this._loadQueue(t),this},_loadQueue:function(t){if(this._queue.length>0){var e=this._queue[0];e.event===t&&(this._queue.shift(),this._loadQueue()),t||e.action()}return this},_ended:function(t){var e=t._sprite;if(!this._webAudio&&t._node&&!t._node.paused&&!t._node.ended&&t._node.currentTime<t._stop)return setTimeout(this._ended.bind(this,t),100),this;var i=!(!t._loop&&!this._sprite[e][2]);if(this._emit("end",t._id),!this._webAudio&&i&&this.stop(t._id,!0).play(t._id),this._webAudio&&i){this._emit("play",t._id),t._seek=t._start||0,t._rateSeek=0,t._playStart=s.ctx.currentTime;var n=1e3*(t._stop-t._start)/Math.abs(t._rate);this._endTimers[t._id]=setTimeout(this._ended.bind(this,t),n)}return this._webAudio&&!i&&(t._paused=!0,t._ended=!0,t._seek=t._start||0,t._rateSeek=0,this._clearTimer(t._id),this._cleanBuffer(t._node),s._autoSuspend()),this._webAudio||i||this.stop(t._id,!0),this},_clearTimer:function(t){if(this._endTimers[t]){if("function"!=typeof this._endTimers[t])clearTimeout(this._endTimers[t]);else{var e=this._soundById(t);e&&e._node&&e._node.removeEventListener("ended",this._endTimers[t],!1)}delete this._endTimers[t]}return this},_soundById:function(t){for(var e=0;e<this._sounds.length;e++)if(t===this._sounds[e]._id)return this._sounds[e];return null},_inactiveSound:function(){this._drain();for(var t=0;t<this._sounds.length;t++)if(this._sounds[t]._ended)return this._sounds[t].reset();return new a(this)},_drain:function(){var t=this._pool,e=0,i=0;if(!(this._sounds.length<t)){for(i=0;i<this._sounds.length;i++)this._sounds[i]._ended&&e++;for(i=this._sounds.length-1;i>=0;i--){if(e<=t)return;this._sounds[i]._ended&&(this._webAudio&&this._sounds[i]._node&&this._sounds[i]._node.disconnect(0),this._sounds.splice(i,1),e--)}}},_getSoundIds:function(t){if(void 0===t){for(var e=[],i=0;i<this._sounds.length;i++)e.push(this._sounds[i]._id);return e}return[t]},_refreshBuffer:function(t){return t._node.bufferSource=s.ctx.createBufferSource(),t._node.bufferSource.buffer=l[this._src],t._panner?t._node.bufferSource.connect(t._panner):t._node.bufferSource.connect(t._node),t._node.bufferSource.loop=t._loop,t._loop&&(t._node.bufferSource.loopStart=t._start||0,t._node.bufferSource.loopEnd=t._stop||0),t._node.bufferSource.playbackRate.setValueAtTime(t._rate,s.ctx.currentTime),this},_cleanBuffer:function(t){var e=s._navigator&&s._navigator.vendor.indexOf("Apple")>=0;if(s._scratchBuffer&&t.bufferSource&&(t.bufferSource.onended=null,t.bufferSource.disconnect(0),e))try{t.bufferSource.buffer=s._scratchBuffer}catch(t){}return t.bufferSource=null,this},_clearSound:function(t){/MSIE |Trident\//.test(s._navigator&&s._navigator.userAgent)||(t.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var a=function(t){this._parent=t,this.init()};a.prototype={init:function(){var t=this._parent;return this._muted=t._muted,this._loop=t._loop,this._volume=t._volume,this._rate=t._rate,this._seek=0,this._paused=!0,this._ended=!0,this._sprite="__default",this._id=++s._counter,t._sounds.push(this),this.create(),this},create:function(){var t=this._parent,e=s._muted||this._muted||this._parent._muted?0:this._volume;return t._webAudio?(this._node=void 0===s.ctx.createGain?s.ctx.createGainNode():s.ctx.createGain(),this._node.gain.setValueAtTime(e,s.ctx.currentTime),this._node.paused=!0,this._node.connect(s.masterGain)):s.noAudio||(this._node=s._obtainHtml5Audio(),this._errorFn=this._errorListener.bind(this),this._node.addEventListener("error",this._errorFn,!1),this._loadFn=this._loadListener.bind(this),this._node.addEventListener(s._canPlayEvent,this._loadFn,!1),this._node.src=t._src,this._node.preload=!0===t._preload?"auto":t._preload,this._node.volume=e*s.volume(),this._node.load()),this},reset:function(){var t=this._parent;return this._muted=t._muted,this._loop=t._loop,this._volume=t._volume,this._rate=t._rate,this._seek=0,this._rateSeek=0,this._paused=!0,this._ended=!0,this._sprite="__default",this._id=++s._counter,this},_errorListener:function(){this._parent._emit("loaderror",this._id,this._node.error?this._node.error.code:0),this._node.removeEventListener("error",this._errorFn,!1)},_loadListener:function(){var t=this._parent;t._duration=Math.ceil(10*this._node.duration)/10,0===Object.keys(t._sprite).length&&(t._sprite={__default:[0,1e3*t._duration]}),"loaded"!==t._state&&(t._state="loaded",t._emit("load"),t._loadQueue()),this._node.removeEventListener(s._canPlayEvent,this._loadFn,!1)}};var l={},h=function(t){var e=t._src;if(l[e])return t._duration=l[e].duration,void c(t);if(/^data:[^;]+;base64,/.test(e)){for(var i=atob(e.split(",")[1]),n=new Uint8Array(i.length),o=0;o<i.length;++o)n[o]=i.charCodeAt(o);d(n.buffer,t)}else{var s=new XMLHttpRequest;s.open(t._xhr.method,e,!0),s.withCredentials=t._xhr.withCredentials,s.responseType="arraybuffer",t._xhr.headers&&Object.keys(t._xhr.headers).forEach((function(e){s.setRequestHeader(e,t._xhr.headers[e])})),s.onload=function(){var e=(s.status+"")[0];"0"===e||"2"===e||"3"===e?d(s.response,t):t._emit("loaderror",null,"Failed loading audio file with status: "+s.status+".")},s.onerror=function(){t._webAudio&&(t._html5=!0,t._webAudio=!1,t._sounds=[],delete l[e],t.load())},u(s)}},u=function(t){try{t.send()}catch(e){t.onerror()}},d=function(t,e){var i=function(){e._emit("loaderror",null,"Decoding audio data failed.")},n=function(t){t&&e._sounds.length>0?(l[e._src]=t,c(e,t)):i()};"undefined"!=typeof Promise&&1===s.ctx.decodeAudioData.length?s.ctx.decodeAudioData(t).then(n).catch(i):s.ctx.decodeAudioData(t,n,i)},c=function(t,e){e&&!t._duration&&(t._duration=e.duration),0===Object.keys(t._sprite).length&&(t._sprite={__default:[0,1e3*t._duration]}),"loaded"!==t._state&&(t._state="loaded",t._emit("load"),t._loadQueue())},p=function(){if(s.usingWebAudio){try{"undefined"!=typeof AudioContext?s.ctx=new AudioContext:"undefined"!=typeof webkitAudioContext?s.ctx=new webkitAudioContext:s.usingWebAudio=!1}catch(t){s.usingWebAudio=!1}s.ctx||(s.usingWebAudio=!1);var t=/iP(hone|od|ad)/.test(s._navigator&&s._navigator.platform),e=s._navigator&&s._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),i=e?parseInt(e[1],10):null;if(t&&i&&i<9){var n=/safari/.test(s._navigator&&s._navigator.userAgent.toLowerCase());s._navigator&&!n&&(s.usingWebAudio=!1)}s.usingWebAudio&&(s.masterGain=void 0===s.ctx.createGain?s.ctx.createGainNode():s.ctx.createGain(),s.masterGain.gain.setValueAtTime(s._muted?0:s._volume,s.ctx.currentTime),s.masterGain.connect(s.ctx.destination)),s._setup()}};void 0===(n=function(){return{Howler:s,Howl:r}}.apply(e,[]))||(t.exports=n),e.Howler=s,e.Howl=r,void 0!==i?(i.HowlerGlobal=o,i.Howler=s,i.Howl=r,i.Sound=a):"undefined"!=typeof window&&(window.HowlerGlobal=o,window.Howler=s,window.Howl=r,window.Sound=a)}(),
/*!
 *  Spatial Plugin - Adds support for stereo and 3D audio where Web Audio is supported.
 *  
 *  howler.js v2.2.0
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */
function(){"use strict";var t;HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(t){if(!this.ctx||!this.ctx.listener)return this;for(var e=this._howls.length-1;e>=0;e--)this._howls[e].stereo(t);return this},HowlerGlobal.prototype.pos=function(t,e,i){return this.ctx&&this.ctx.listener?(e="number"!=typeof e?this._pos[1]:e,i="number"!=typeof i?this._pos[2]:i,"number"!=typeof t?this._pos:(this._pos=[t,e,i],void 0!==this.ctx.listener.positionX?(this.ctx.listener.positionX.setTargetAtTime(this._pos[0],Howler.ctx.currentTime,.1),this.ctx.listener.positionY.setTargetAtTime(this._pos[1],Howler.ctx.currentTime,.1),this.ctx.listener.positionZ.setTargetAtTime(this._pos[2],Howler.ctx.currentTime,.1)):this.ctx.listener.setPosition(this._pos[0],this._pos[1],this._pos[2]),this)):this},HowlerGlobal.prototype.orientation=function(t,e,i,n,o,s){if(!this.ctx||!this.ctx.listener)return this;var r=this._orientation;return e="number"!=typeof e?r[1]:e,i="number"!=typeof i?r[2]:i,n="number"!=typeof n?r[3]:n,o="number"!=typeof o?r[4]:o,s="number"!=typeof s?r[5]:s,"number"!=typeof t?r:(this._orientation=[t,e,i,n,o,s],void 0!==this.ctx.listener.forwardX?(this.ctx.listener.forwardX.setTargetAtTime(t,Howler.ctx.currentTime,.1),this.ctx.listener.forwardY.setTargetAtTime(e,Howler.ctx.currentTime,.1),this.ctx.listener.forwardZ.setTargetAtTime(i,Howler.ctx.currentTime,.1),this.ctx.listener.upX.setTargetAtTime(n,Howler.ctx.currentTime,.1),this.ctx.listener.upY.setTargetAtTime(o,Howler.ctx.currentTime,.1),this.ctx.listener.upZ.setTargetAtTime(s,Howler.ctx.currentTime,.1)):this.ctx.listener.setOrientation(t,e,i,n,o,s),this)},Howl.prototype.init=(t=Howl.prototype.init,function(e){return this._orientation=e.orientation||[1,0,0],this._stereo=e.stereo||null,this._pos=e.pos||null,this._pannerAttr={coneInnerAngle:void 0!==e.coneInnerAngle?e.coneInnerAngle:360,coneOuterAngle:void 0!==e.coneOuterAngle?e.coneOuterAngle:360,coneOuterGain:void 0!==e.coneOuterGain?e.coneOuterGain:0,distanceModel:void 0!==e.distanceModel?e.distanceModel:"inverse",maxDistance:void 0!==e.maxDistance?e.maxDistance:1e4,panningModel:void 0!==e.panningModel?e.panningModel:"HRTF",refDistance:void 0!==e.refDistance?e.refDistance:1,rolloffFactor:void 0!==e.rolloffFactor?e.rolloffFactor:1},this._onstereo=e.onstereo?[{fn:e.onstereo}]:[],this._onpos=e.onpos?[{fn:e.onpos}]:[],this._onorientation=e.onorientation?[{fn:e.onorientation}]:[],t.call(this,e)}),Howl.prototype.stereo=function(t,i){var n=this;if(!n._webAudio)return n;if("loaded"!==n._state)return n._queue.push({event:"stereo",action:function(){n.stereo(t,i)}}),n;var o=void 0===Howler.ctx.createStereoPanner?"spatial":"stereo";if(void 0===i){if("number"!=typeof t)return n._stereo;n._stereo=t,n._pos=[t,0,0]}for(var s=n._getSoundIds(i),r=0;r<s.length;r++){var a=n._soundById(s[r]);if(a){if("number"!=typeof t)return a._stereo;a._stereo=t,a._pos=[t,0,0],a._node&&(a._pannerAttr.panningModel="equalpower",a._panner&&a._panner.pan||e(a,o),"spatial"===o?void 0!==a._panner.positionX?(a._panner.positionX.setValueAtTime(t,Howler.ctx.currentTime),a._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),a._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):a._panner.setPosition(t,0,0):a._panner.pan.setValueAtTime(t,Howler.ctx.currentTime)),n._emit("stereo",a._id)}}return n},Howl.prototype.pos=function(t,i,n,o){var s=this;if(!s._webAudio)return s;if("loaded"!==s._state)return s._queue.push({event:"pos",action:function(){s.pos(t,i,n,o)}}),s;if(i="number"!=typeof i?0:i,n="number"!=typeof n?-.5:n,void 0===o){if("number"!=typeof t)return s._pos;s._pos=[t,i,n]}for(var r=s._getSoundIds(o),a=0;a<r.length;a++){var l=s._soundById(r[a]);if(l){if("number"!=typeof t)return l._pos;l._pos=[t,i,n],l._node&&(l._panner&&!l._panner.pan||e(l,"spatial"),void 0!==l._panner.positionX?(l._panner.positionX.setValueAtTime(t,Howler.ctx.currentTime),l._panner.positionY.setValueAtTime(i,Howler.ctx.currentTime),l._panner.positionZ.setValueAtTime(n,Howler.ctx.currentTime)):l._panner.setPosition(t,i,n)),s._emit("pos",l._id)}}return s},Howl.prototype.orientation=function(t,i,n,o){var s=this;if(!s._webAudio)return s;if("loaded"!==s._state)return s._queue.push({event:"orientation",action:function(){s.orientation(t,i,n,o)}}),s;if(i="number"!=typeof i?s._orientation[1]:i,n="number"!=typeof n?s._orientation[2]:n,void 0===o){if("number"!=typeof t)return s._orientation;s._orientation=[t,i,n]}for(var r=s._getSoundIds(o),a=0;a<r.length;a++){var l=s._soundById(r[a]);if(l){if("number"!=typeof t)return l._orientation;l._orientation=[t,i,n],l._node&&(l._panner||(l._pos||(l._pos=s._pos||[0,0,-.5]),e(l,"spatial")),void 0!==l._panner.orientationX?(l._panner.orientationX.setValueAtTime(t,Howler.ctx.currentTime),l._panner.orientationY.setValueAtTime(i,Howler.ctx.currentTime),l._panner.orientationZ.setValueAtTime(n,Howler.ctx.currentTime)):l._panner.setOrientation(t,i,n)),s._emit("orientation",l._id)}}return s},Howl.prototype.pannerAttr=function(){var t,i,n,o=this,s=arguments;if(!o._webAudio)return o;if(0===s.length)return o._pannerAttr;if(1===s.length){if("object"!=typeof s[0])return(n=o._soundById(parseInt(s[0],10)))?n._pannerAttr:o._pannerAttr;t=s[0],void 0===i&&(t.pannerAttr||(t.pannerAttr={coneInnerAngle:t.coneInnerAngle,coneOuterAngle:t.coneOuterAngle,coneOuterGain:t.coneOuterGain,distanceModel:t.distanceModel,maxDistance:t.maxDistance,refDistance:t.refDistance,rolloffFactor:t.rolloffFactor,panningModel:t.panningModel}),o._pannerAttr={coneInnerAngle:void 0!==t.pannerAttr.coneInnerAngle?t.pannerAttr.coneInnerAngle:o._coneInnerAngle,coneOuterAngle:void 0!==t.pannerAttr.coneOuterAngle?t.pannerAttr.coneOuterAngle:o._coneOuterAngle,coneOuterGain:void 0!==t.pannerAttr.coneOuterGain?t.pannerAttr.coneOuterGain:o._coneOuterGain,distanceModel:void 0!==t.pannerAttr.distanceModel?t.pannerAttr.distanceModel:o._distanceModel,maxDistance:void 0!==t.pannerAttr.maxDistance?t.pannerAttr.maxDistance:o._maxDistance,refDistance:void 0!==t.pannerAttr.refDistance?t.pannerAttr.refDistance:o._refDistance,rolloffFactor:void 0!==t.pannerAttr.rolloffFactor?t.pannerAttr.rolloffFactor:o._rolloffFactor,panningModel:void 0!==t.pannerAttr.panningModel?t.pannerAttr.panningModel:o._panningModel})}else 2===s.length&&(t=s[0],i=parseInt(s[1],10));for(var r=o._getSoundIds(i),a=0;a<r.length;a++)if(n=o._soundById(r[a])){var l=n._pannerAttr;l={coneInnerAngle:void 0!==t.coneInnerAngle?t.coneInnerAngle:l.coneInnerAngle,coneOuterAngle:void 0!==t.coneOuterAngle?t.coneOuterAngle:l.coneOuterAngle,coneOuterGain:void 0!==t.coneOuterGain?t.coneOuterGain:l.coneOuterGain,distanceModel:void 0!==t.distanceModel?t.distanceModel:l.distanceModel,maxDistance:void 0!==t.maxDistance?t.maxDistance:l.maxDistance,refDistance:void 0!==t.refDistance?t.refDistance:l.refDistance,rolloffFactor:void 0!==t.rolloffFactor?t.rolloffFactor:l.rolloffFactor,panningModel:void 0!==t.panningModel?t.panningModel:l.panningModel};var h=n._panner;h?(h.coneInnerAngle=l.coneInnerAngle,h.coneOuterAngle=l.coneOuterAngle,h.coneOuterGain=l.coneOuterGain,h.distanceModel=l.distanceModel,h.maxDistance=l.maxDistance,h.refDistance=l.refDistance,h.rolloffFactor=l.rolloffFactor,h.panningModel=l.panningModel):(n._pos||(n._pos=o._pos||[0,0,-.5]),e(n,"spatial"))}return o},Sound.prototype.init=function(t){return function(){var e=this._parent;this._orientation=e._orientation,this._stereo=e._stereo,this._pos=e._pos,this._pannerAttr=e._pannerAttr,t.call(this),this._stereo?e.stereo(this._stereo):this._pos&&e.pos(this._pos[0],this._pos[1],this._pos[2],this._id)}}(Sound.prototype.init),Sound.prototype.reset=function(t){return function(){var e=this._parent;return this._orientation=e._orientation,this._stereo=e._stereo,this._pos=e._pos,this._pannerAttr=e._pannerAttr,this._stereo?e.stereo(this._stereo):this._pos?e.pos(this._pos[0],this._pos[1],this._pos[2],this._id):this._panner&&(this._panner.disconnect(0),this._panner=void 0,e._refreshBuffer(this)),t.call(this)}}(Sound.prototype.reset);var e=function(t,e){"spatial"===(e=e||"spatial")?(t._panner=Howler.ctx.createPanner(),t._panner.coneInnerAngle=t._pannerAttr.coneInnerAngle,t._panner.coneOuterAngle=t._pannerAttr.coneOuterAngle,t._panner.coneOuterGain=t._pannerAttr.coneOuterGain,t._panner.distanceModel=t._pannerAttr.distanceModel,t._panner.maxDistance=t._pannerAttr.maxDistance,t._panner.refDistance=t._pannerAttr.refDistance,t._panner.rolloffFactor=t._pannerAttr.rolloffFactor,t._panner.panningModel=t._pannerAttr.panningModel,void 0!==t._panner.positionX?(t._panner.positionX.setValueAtTime(t._pos[0],Howler.ctx.currentTime),t._panner.positionY.setValueAtTime(t._pos[1],Howler.ctx.currentTime),t._panner.positionZ.setValueAtTime(t._pos[2],Howler.ctx.currentTime)):t._panner.setPosition(t._pos[0],t._pos[1],t._pos[2]),void 0!==t._panner.orientationX?(t._panner.orientationX.setValueAtTime(t._orientation[0],Howler.ctx.currentTime),t._panner.orientationY.setValueAtTime(t._orientation[1],Howler.ctx.currentTime),t._panner.orientationZ.setValueAtTime(t._orientation[2],Howler.ctx.currentTime)):t._panner.setOrientation(t._orientation[0],t._orientation[1],t._orientation[2])):(t._panner=Howler.ctx.createStereoPanner(),t._panner.pan.setValueAtTime(t._stereo,Howler.ctx.currentTime)),t._panner.connect(t._node),t._paused||t._parent.pause(t._id,!0).play(t._id,!0)}}()}).call(this,i(10))},function(t,e,i){"use strict";function n(t,e){return(t%e+e)%e}function o(t,e=0,i=1){return t<e?e:t>i?i:t}function s(t){return t.charAt(0).toUpperCase()+t.substring(1)}function r(t,...e){let i=r.map;return t.replace(/%(?:([a-z]+)|(?:{([^}]+)}))/gi,(function(n,o,r,a){if("%"==t.charAt(a-1))return n.substring(1);if(!e.length)return n;let l=e[0],h=(o||r).split(","),u=h.shift()||"",d=i[u.toLowerCase()];if(!d)return n;l=e.shift();let c=l[d].apply(l,h),p=u.charAt(0);return p!=p.toLowerCase()&&(c=s(c)),c}))}i.r(e),i.d(e,"mod",(function(){return n})),i.d(e,"clamp",(function(){return o})),i.d(e,"capitalize",(function(){return s})),i.d(e,"format",(function(){return r})),r.map={s:"toString"}},function(t,e,i){"use strict";i.r(e),i.d(e,"fromString",(function(){return s})),i.d(e,"add",(function(){return r})),i.d(e,"add_",(function(){return a})),i.d(e,"multiply",(function(){return l})),i.d(e,"multiply_",(function(){return h})),i.d(e,"interpolate",(function(){return u})),i.d(e,"lerp",(function(){return d})),i.d(e,"interpolateHSL",(function(){return c})),i.d(e,"lerpHSL",(function(){return p})),i.d(e,"randomize",(function(){return _})),i.d(e,"rgb2hsl",(function(){return f})),i.d(e,"hsl2rgb",(function(){return g})),i.d(e,"toRGB",(function(){return y})),i.d(e,"toHex",(function(){return v}));var n=i(2),o=i(0);function s(t){let e,i;if(t in w)e=w[t];else{if("#"==t.charAt(0)){let i=(t.match(/[0-9a-f]/gi)||[]).map(t=>parseInt(t,16));if(3==i.length)e=i.map(t=>17*t);else{for(let t=0;t<3;t++)i[t+1]+=16*i[t],i.splice(t,1);e=i}}else e=(i=t.match(/rgb\(([0-9, ]+)\)/i))?i[1].split(/\s*,\s*/).map(t=>parseInt(t)):[0,0,0];w[t]=e}return e.slice()}function r(t,...e){let i=t.slice();for(let t=0;t<3;t++)for(let n=0;n<e.length;n++)i[t]+=e[n][t];return i}function a(t,...e){for(let i=0;i<3;i++)for(let n=0;n<e.length;n++)t[i]+=e[n][i];return t}function l(t,...e){let i=t.slice();for(let t=0;t<3;t++){for(let n=0;n<e.length;n++)i[t]*=e[n][t]/255;i[t]=Math.round(i[t])}return i}function h(t,...e){for(let i=0;i<3;i++){for(let n=0;n<e.length;n++)t[i]*=e[n][i]/255;t[i]=Math.round(t[i])}return t}function u(t,e,i=.5){let n=t.slice();for(let o=0;o<3;o++)n[o]=Math.round(n[o]+i*(e[o]-t[o]));return n}const d=u;function c(t,e,i=.5){let n=f(t),o=f(e);for(let t=0;t<3;t++)n[t]+=i*(o[t]-n[t]);return g(n)}const p=c;function _(t,e){e instanceof Array||(e=Math.round(o.a.getNormal(0,e)));let i=t.slice();for(let t=0;t<3;t++)i[t]+=e instanceof Array?Math.round(o.a.getNormal(0,e[t])):e;return i}function f(t){let e,i=t[0]/255,n=t[1]/255,o=t[2]/255,s=Math.max(i,n,o),r=Math.min(i,n,o),a=0,l=(s+r)/2;if(s==r)e=0;else{let t=s-r;switch(e=l>.5?t/(2-s-r):t/(s+r),s){case i:a=(n-o)/t+(n<o?6:0);break;case n:a=(o-i)/t+2;break;case o:a=(i-n)/t+4}a/=6}return[a,e,l]}function m(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t}function g(t){let e=t[2];if(0==t[1])return e=Math.round(255*e),[e,e,e];{let i=t[1],n=e<.5?e*(1+i):e+i-e*i,o=2*e-n,s=m(o,n,t[0]+1/3),r=m(o,n,t[0]),a=m(o,n,t[0]-1/3);return[Math.round(255*s),Math.round(255*r),Math.round(255*a)]}}function y(t){return`rgb(${t.map(t=>Object(n.clamp)(t,0,255)).join(",")})`}function v(t){return"#"+t.map(t=>Object(n.clamp)(t,0,255).toString(16).padStart(2,"0")).join("")}const w={black:[0,0,0],navy:[0,0,128],darkblue:[0,0,139],mediumblue:[0,0,205],blue:[0,0,255],darkgreen:[0,100,0],green:[0,128,0],teal:[0,128,128],darkcyan:[0,139,139],deepskyblue:[0,191,255],darkturquoise:[0,206,209],mediumspringgreen:[0,250,154],lime:[0,255,0],springgreen:[0,255,127],aqua:[0,255,255],cyan:[0,255,255],midnightblue:[25,25,112],dodgerblue:[30,144,255],forestgreen:[34,139,34],seagreen:[46,139,87],darkslategray:[47,79,79],darkslategrey:[47,79,79],limegreen:[50,205,50],mediumseagreen:[60,179,113],turquoise:[64,224,208],royalblue:[65,105,225],steelblue:[70,130,180],darkslateblue:[72,61,139],mediumturquoise:[72,209,204],indigo:[75,0,130],darkolivegreen:[85,107,47],cadetblue:[95,158,160],cornflowerblue:[100,149,237],mediumaquamarine:[102,205,170],dimgray:[105,105,105],dimgrey:[105,105,105],slateblue:[106,90,205],olivedrab:[107,142,35],slategray:[112,128,144],slategrey:[112,128,144],lightslategray:[119,136,153],lightslategrey:[119,136,153],mediumslateblue:[123,104,238],lawngreen:[124,252,0],chartreuse:[127,255,0],aquamarine:[127,255,212],maroon:[128,0,0],purple:[128,0,128],olive:[128,128,0],gray:[128,128,128],grey:[128,128,128],skyblue:[135,206,235],lightskyblue:[135,206,250],blueviolet:[138,43,226],darkred:[139,0,0],darkmagenta:[139,0,139],saddlebrown:[139,69,19],darkseagreen:[143,188,143],lightgreen:[144,238,144],mediumpurple:[147,112,216],darkviolet:[148,0,211],palegreen:[152,251,152],darkorchid:[153,50,204],yellowgreen:[154,205,50],sienna:[160,82,45],brown:[165,42,42],darkgray:[169,169,169],darkgrey:[169,169,169],lightblue:[173,216,230],greenyellow:[173,255,47],paleturquoise:[175,238,238],lightsteelblue:[176,196,222],powderblue:[176,224,230],firebrick:[178,34,34],darkgoldenrod:[184,134,11],mediumorchid:[186,85,211],rosybrown:[188,143,143],darkkhaki:[189,183,107],silver:[192,192,192],mediumvioletred:[199,21,133],indianred:[205,92,92],peru:[205,133,63],chocolate:[210,105,30],tan:[210,180,140],lightgray:[211,211,211],lightgrey:[211,211,211],palevioletred:[216,112,147],thistle:[216,191,216],orchid:[218,112,214],goldenrod:[218,165,32],crimson:[220,20,60],gainsboro:[220,220,220],plum:[221,160,221],burlywood:[222,184,135],lightcyan:[224,255,255],lavender:[230,230,250],darksalmon:[233,150,122],violet:[238,130,238],palegoldenrod:[238,232,170],lightcoral:[240,128,128],khaki:[240,230,140],aliceblue:[240,248,255],honeydew:[240,255,240],azure:[240,255,255],sandybrown:[244,164,96],wheat:[245,222,179],beige:[245,245,220],whitesmoke:[245,245,245],mintcream:[245,255,250],ghostwhite:[248,248,255],salmon:[250,128,114],antiquewhite:[250,235,215],linen:[250,240,230],lightgoldenrodyellow:[250,250,210],oldlace:[253,245,230],red:[255,0,0],fuchsia:[255,0,255],magenta:[255,0,255],deeppink:[255,20,147],orangered:[255,69,0],tomato:[255,99,71],hotpink:[255,105,180],coral:[255,127,80],darkorange:[255,140,0],lightsalmon:[255,160,122],orange:[255,165,0],lightpink:[255,182,193],pink:[255,192,203],gold:[255,215,0],peachpuff:[255,218,185],navajowhite:[255,222,173],moccasin:[255,228,181],bisque:[255,228,196],mistyrose:[255,228,225],blanchedalmond:[255,235,205],papayawhip:[255,239,213],lavenderblush:[255,240,245],seashell:[255,245,238],cornsilk:[255,248,220],lemonchiffon:[255,250,205],floralwhite:[255,250,240],snow:[255,250,250],yellow:[255,255,0],lightyellow:[255,255,224],ivory:[255,255,240],white:[255,255,255]}},function(t,e,i){"use strict";i.d(e,"a",(function(){return n}));class n{getContainer(){return null}setOptions(t){this._options=t}}},function(t,e,i){const{Game:n}=i(8),{SpriteSheet:o}=i(9);t.exports={Game:n,SpriteSheet:o}},function(t,e,i){"use strict";(function(t){i.d(e,"a",(function(){return r}));var n=i(4),o=i(3);function s(t){let e=o.fromString(t);return 36*Math.floor(e[0]*(6/256))+6*Math.floor(e[1]*(6/256))+1*Math.floor(e[2]*(6/256))+16}class r extends n.a{constructor(){super(),this._offset=[0,0],this._cursor=[-1,-1],this._lastColor=""}schedule(t){setTimeout(t,1e3/60)}setOptions(t){super.setOptions(t);let e=[t.width,t.height],i=this.computeSize();this._offset=i.map((t,i)=>Math.floor((t-e[i])/2))}clear(){t.stdout.write(`[0;48;5;${s(this._options.bg)}m[2J`)}draw(e,i){let[n,o,r,a,l]=e,h=this._offset[0]+n,u=this._offset[1]+o,d=this.computeSize();if(h<0||h>=d[0])return;if(u<0||u>=d[1])return;if(h===this._cursor[0]&&u===this._cursor[1]||(t.stdout.write(function(t,e){return`[${e+1};${t+1}H`}(h,u)),this._cursor[0]=h,this._cursor[1]=u),i&&(r||(r=" ")),!r)return;let c=function(t,e){return`[0;38;5;${s(t)};48;5;${s(e)}m`}(a,l);if(c!==this._lastColor&&(t.stdout.write(c),this._lastColor=c),"\t"!=r){let e=[].concat(r);t.stdout.write(e[0])}this._cursor[0]++,this._cursor[0]>=d[0]&&(this._cursor[0]=0,this._cursor[1]++)}computeFontSize(){throw new Error("Terminal backend has no notion of font size")}eventToPosition(t,e){return[t,e]}computeSize(){return[t.stdout.columns,t.stdout.rows]}}}).call(this,i(7))},function(t,e){var i,n,o=t.exports={};function s(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function a(t){if(i===setTimeout)return setTimeout(t,0);if((i===s||!i)&&setTimeout)return i=setTimeout,setTimeout(t,0);try{return i(t,0)}catch(e){try{return i.call(null,t,0)}catch(e){return i.call(this,t,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:s}catch(t){i=s}try{n="function"==typeof clearTimeout?clearTimeout:r}catch(t){n=r}}();var l,h=[],u=!1,d=-1;function c(){u&&l&&(u=!1,l.length?h=l.concat(h):d=-1,h.length&&p())}function p(){if(!u){var t=a(c);u=!0;for(var e=h.length;e;){for(l=h,h=[];++d<e;)l&&l[d].run();d=-1,e=h.length}l=null,u=!1,function(t){if(n===clearTimeout)return clearTimeout(t);if((n===r||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(t);try{n(t)}catch(e){try{return n.call(null,t)}catch(e){return n.call(this,t)}}}(t)}}function _(t,e){this.fun=t,this.array=e}function f(){}o.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];h.push(new _(t,e)),1!==h.length||u||a(p)},_.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=f,o.addListener=f,o.once=f,o.off=f,o.removeListener=f,o.removeAllListeners=f,o.emit=f,o.prependListener=f,o.prependOnceListener=f,o.listeners=function(t){return[]},o.binding=function(t){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(t){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},function(t,e){t.exports={Game:class{constructor({width:t,height:e,scale:i=1,parent:n="game",imageSmoothing:o=!1}){this.width=t,this.height=e,this.parent=document.getElementById(n),this.canvas=document.createElement("canvas"),this.canvas.width=this.width*i,this.canvas.height=this.height*i,this.context=this.canvas.getContext("2d"),this.context.scale(i,i),this.context.imageSmoothingEnabled=o,this.parent.appendChild(this.canvas),this.oldTimeStamp=0,this.running=!1}update(){throw new Error("must implement `update` function")}draw(){throw new Error("must implement `draw` function")}start(){window.requestAnimationFrame(this.gameLoop.bind(this)),this.running=!0}stop(){this.running=!1}gameLoop(t){const e=t-this.oldTimeStamp;this.oldTimeStamp=t,this.update(e/1e3),this.draw(),this.running&&window.requestAnimationFrame(this.gameLoop.bind(this))}}}},function(t,e){class i{constructor(t,e,i,n,o,s){this.context=t,this.img=e,this.x=i,this.y=n,this.w=o,this.h=s}draw(t,e,i,n){this.context.drawImage(this.img,this.x,this.y,this.w,this.h,t,e,i,n)}}class n{constructor({frames:t,duration:e,loop:i=!0,onComplete:n=(()=>{})}){this.frames=t,this.currentFrame=0,this.time=0,this.duration=e,this.loop=i,this.onComplete=n,this.running=!0}advanceFrame(){this.currentFrame++,this.loop?this.currentFrame=this.currentFrame%this.frames.length:this.currentFrame==this.frames.length-1&&(this.running=!1,this.onComplete())}update(t){this.time+=t,this.time>this.duration&&this.running&&(this.time=0,this.advanceFrame())}draw(t,e,i,n){this.frames[this.currentFrame].draw(t,e,i,n)}}t.exports={SpriteSheet:class{constructor({path:t,context:e,colSize:i,rowSize:n,margin:o=0}){this.context=e,this.colSize=i,this.rowSize=n,this.margin=o,this.image=new Image,this.image.src=t,this.image.onload=()=>{}}createSprite(t,e,n,o){return new i(this.context,this.image,t,e,n,o)}getSprite(t,e){return new i(this.context,this.image,this.colSize*t+this.margin*t,this.rowSize*e+this.margin*e,this.colSize,this.rowSize)}getAnimatedSprite({frames:t,duration:e,loop:i,onComplete:o}){const s=t.map(([t,e])=>this.getSprite(t,e));return new n({onComplete:o,loop:i,context:this.context,image:this.image,frames:s,duration:e})}}}},function(t,e){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(t){"object"==typeof window&&(i=window)}t.exports=i},function(t,e,i){"use strict";i.r(e);var n={};function o(t,e,i=(()=>{}),n=(()=>{})){return{name:t,transitions:e,enter:i,exit:n}}i.r(n),i.d(n,"TYPE_TEXT",(function(){return w})),i.d(n,"TYPE_NEWLINE",(function(){return x})),i.d(n,"TYPE_FG",(function(){return b})),i.d(n,"TYPE_BG",(function(){return T})),i.d(n,"measure",(function(){return A})),i.d(n,"tokenize",(function(){return S}));i(0);var s=i(4);class r extends s.a{constructor(){super(),this._ctx=document.createElement("canvas").getContext("2d")}schedule(t){requestAnimationFrame(t)}getContainer(){return this._ctx.canvas}setOptions(t){super.setOptions(t);const e=`${t.fontStyle?t.fontStyle+" ":""} ${t.fontSize}px ${t.fontFamily}`;this._ctx.font=e,this._updateSize(),this._ctx.font=e,this._ctx.textAlign="center",this._ctx.textBaseline="middle"}clear(){this._ctx.fillStyle=this._options.bg,this._ctx.fillRect(0,0,this._ctx.canvas.width,this._ctx.canvas.height)}eventToPosition(t,e){let i=this._ctx.canvas,n=i.getBoundingClientRect();return t-=n.left,e-=n.top,t*=i.width/n.width,e*=i.height/n.height,t<0||e<0||t>=i.width||e>=i.height?[-1,-1]:this._normalizedEventToPosition(t,e)}}var a=i(2);class l extends r{constructor(){super(),this._spacingX=0,this._spacingY=0,this._hexSize=0}draw(t,e){let[i,n,o,s,r]=t,a=[(i+1)*this._spacingX,n*this._spacingY+this._hexSize];if(this._options.transpose&&a.reverse(),e&&(this._ctx.fillStyle=r,this._fill(a[0],a[1])),!o)return;this._ctx.fillStyle=s;let l=[].concat(o);for(let t=0;t<l.length;t++)this._ctx.fillText(l[t],a[0],Math.ceil(a[1]))}computeSize(t,e){return this._options.transpose&&(t+=e,t-=e=t-e),[Math.floor(t/this._spacingX)-1,Math.floor((e-2*this._hexSize)/this._spacingY+1)]}computeFontSize(t,e){this._options.transpose&&(t+=e,t-=e=t-e);let i=2*t/((this._options.width+1)*Math.sqrt(3))-1,n=e/(2+1.5*(this._options.height-1)),o=Math.min(i,n),s=this._ctx.font;this._ctx.font="100px "+this._options.fontFamily;let r=Math.ceil(this._ctx.measureText("W").width);this._ctx.font=s;let a=r/100;o=Math.floor(o)+1;let l=2*o/(this._options.spacing*(1+a/Math.sqrt(3)));return Math.ceil(l)-1}_normalizedEventToPosition(t,e){let i;this._options.transpose?(t+=e,t-=e=t-e,i=this._ctx.canvas.width):i=this._ctx.canvas.height;let n=i/this._options.height;return e=Math.floor(e/n),Object(a.mod)(e,2)?(t-=this._spacingX,t=1+2*Math.floor(t/(2*this._spacingX))):t=2*Math.floor(t/(2*this._spacingX)),[t,e]}_fill(t,e){let i=this._hexSize,n=this._options.border;const o=this._ctx;o.beginPath(),this._options.transpose?(o.moveTo(t-i+n,e),o.lineTo(t-i/2+n,e+this._spacingX-n),o.lineTo(t+i/2-n,e+this._spacingX-n),o.lineTo(t+i-n,e),o.lineTo(t+i/2-n,e-this._spacingX+n),o.lineTo(t-i/2+n,e-this._spacingX+n),o.lineTo(t-i+n,e)):(o.moveTo(t,e-i+n),o.lineTo(t+this._spacingX-n,e-i/2+n),o.lineTo(t+this._spacingX-n,e+i/2-n),o.lineTo(t,e+i-n),o.lineTo(t-this._spacingX+n,e+i/2-n),o.lineTo(t-this._spacingX+n,e-i/2+n),o.lineTo(t,e-i+n)),o.fill()}_updateSize(){const t=this._options,e=Math.ceil(this._ctx.measureText("W").width);let i,n;this._hexSize=Math.floor(t.spacing*(t.fontSize+e/Math.sqrt(3))/2),this._spacingX=this._hexSize*Math.sqrt(3)/2,this._spacingY=1.5*this._hexSize,t.transpose?(i="height",n="width"):(i="width",n="height"),this._ctx.canvas[i]=Math.ceil((t.width+1)*this._spacingX),this._ctx.canvas[n]=Math.ceil((t.height-1)*this._spacingY+2*this._hexSize)}}var h=(()=>{class t extends r{constructor(){super(),this._spacingX=0,this._spacingY=0,this._canvasCache={}}setOptions(t){super.setOptions(t),this._canvasCache={}}draw(e,i){t.cache?this._drawWithCache(e):this._drawNoCache(e,i)}_drawWithCache(t){let e,[i,n,o,s,r]=t,a=""+o+s+r;if(a in this._canvasCache)e=this._canvasCache[a];else{let t=this._options.border;e=document.createElement("canvas");let i=e.getContext("2d");if(e.width=this._spacingX,e.height=this._spacingY,i.fillStyle=r,i.fillRect(t,t,e.width-t,e.height-t),o){i.fillStyle=s,i.font=this._ctx.font,i.textAlign="center",i.textBaseline="middle";let t=[].concat(o);for(let e=0;e<t.length;e++)i.fillText(t[e],this._spacingX/2,Math.ceil(this._spacingY/2))}this._canvasCache[a]=e}this._ctx.drawImage(e,i*this._spacingX,n*this._spacingY)}_drawNoCache(t,e){let[i,n,o,s,r]=t;if(e){let t=this._options.border;this._ctx.fillStyle=r,this._ctx.fillRect(i*this._spacingX+t,n*this._spacingY+t,this._spacingX-t,this._spacingY-t)}if(!o)return;this._ctx.fillStyle=s;let a=[].concat(o);for(let t=0;t<a.length;t++)this._ctx.fillText(a[t],(i+.5)*this._spacingX,Math.ceil((n+.5)*this._spacingY))}computeSize(t,e){return[Math.floor(t/this._spacingX),Math.floor(e/this._spacingY)]}computeFontSize(t,e){let i=Math.floor(t/this._options.width),n=Math.floor(e/this._options.height),o=this._ctx.font;this._ctx.font="100px "+this._options.fontFamily;let s=Math.ceil(this._ctx.measureText("W").width);this._ctx.font=o;let r=s/100*n/i;return r>1&&(n=Math.floor(n/r)),Math.floor(n/this._options.spacing)}_normalizedEventToPosition(t,e){return[Math.floor(t/this._spacingX),Math.floor(e/this._spacingY)]}_updateSize(){const t=this._options,e=Math.ceil(this._ctx.measureText("W").width);this._spacingX=Math.ceil(t.spacing*e),this._spacingY=Math.ceil(t.spacing*t.fontSize),t.forceSquareRatio&&(this._spacingX=this._spacingY=Math.max(this._spacingX,this._spacingY)),this._ctx.canvas.width=t.width*this._spacingX,this._ctx.canvas.height=t.height*this._spacingY}}return t.cache=!1,t})();class u extends r{constructor(){super(),this._colorCanvas=document.createElement("canvas")}draw(t,e){let[i,n,o,s,r]=t,a=this._options.tileWidth,l=this._options.tileHeight;if(e&&(this._options.tileColorize?this._ctx.clearRect(i*a,n*l,a,l):(this._ctx.fillStyle=r,this._ctx.fillRect(i*a,n*l,a,l))),!o)return;let h=[].concat(o),u=[].concat(s),d=[].concat(r);for(let t=0;t<h.length;t++){let e=this._options.tileMap[h[t]];if(!e)throw new Error(`Char "${h[t]}" not found in tileMap`);if(this._options.tileColorize){let o=this._colorCanvas,s=o.getContext("2d");s.globalCompositeOperation="source-over",s.clearRect(0,0,a,l);let r=u[t],h=d[t];s.drawImage(this._options.tileSet,e[0],e[1],a,l,0,0,a,l),"transparent"!=r&&(s.fillStyle=r,s.globalCompositeOperation="source-atop",s.fillRect(0,0,a,l)),"transparent"!=h&&(s.fillStyle=h,s.globalCompositeOperation="destination-over",s.fillRect(0,0,a,l)),this._ctx.drawImage(o,i*a,n*l,a,l)}else this._ctx.drawImage(this._options.tileSet,e[0],e[1],a,l,i*a,n*l,a,l)}}computeSize(t,e){return[Math.floor(t/this._options.tileWidth),Math.floor(e/this._options.tileHeight)]}computeFontSize(){throw new Error("Tile backend does not understand font size")}_normalizedEventToPosition(t,e){return[Math.floor(t/this._options.tileWidth),Math.floor(e/this._options.tileHeight)]}_updateSize(){const t=this._options;this._ctx.canvas.width=t.width*t.tileWidth,this._ctx.canvas.height=t.height*t.tileHeight,this._colorCanvas.width=t.tileWidth,this._colorCanvas.height=t.tileHeight}}var d=i(3);class c extends s.a{constructor(){super(),this._uniforms={};try{this._gl=this._initWebGL()}catch(t){alert(t.message)}}static isSupported(){return!!document.createElement("canvas").getContext("webgl2",{preserveDrawingBuffer:!0})}schedule(t){requestAnimationFrame(t)}getContainer(){return this._gl.canvas}setOptions(t){super.setOptions(t),this._updateSize();let e=this._options.tileSet;e&&"complete"in e&&!e.complete?e.addEventListener("load",()=>this._updateTexture(e)):this._updateTexture(e)}draw(t,e){const i=this._gl,n=this._options;let[o,s,r,a,l]=t,h=i.canvas.height-(s+1)*n.tileHeight;if(i.scissor(o*n.tileWidth,h,n.tileWidth,n.tileHeight),e&&(n.tileColorize?i.clearColor(0,0,0,0):i.clearColor(...g(l)),i.clear(i.COLOR_BUFFER_BIT)),!r)return;let u=[].concat(r),d=[].concat(l),c=[].concat(a);i.uniform2fv(this._uniforms.targetPosRel,[o,s]);for(let t=0;t<u.length;t++){let e=this._options.tileMap[u[t]];if(!e)throw new Error(`Char "${u[t]}" not found in tileMap`);i.uniform1f(this._uniforms.colorize,n.tileColorize?1:0),i.uniform2fv(this._uniforms.tilesetPosAbs,e),n.tileColorize&&(i.uniform4fv(this._uniforms.tint,g(c[t])),i.uniform4fv(this._uniforms.bg,g(d[t]))),i.drawArrays(i.TRIANGLE_STRIP,0,4)}}clear(){const t=this._gl;t.clearColor(...g(this._options.bg)),t.scissor(0,0,t.canvas.width,t.canvas.height),t.clear(t.COLOR_BUFFER_BIT)}computeSize(t,e){return[Math.floor(t/this._options.tileWidth),Math.floor(e/this._options.tileHeight)]}computeFontSize(){throw new Error("Tile backend does not understand font size")}eventToPosition(t,e){let i=this._gl.canvas,n=i.getBoundingClientRect();return t-=n.left,e-=n.top,t*=i.width/n.width,e*=i.height/n.height,t<0||e<0||t>=i.width||e>=i.height?[-1,-1]:this._normalizedEventToPosition(t,e)}_initWebGL(){let t=document.createElement("canvas").getContext("webgl2",{preserveDrawingBuffer:!0});window.gl=t;let e=function(t,e,i){const n=t.createShader(t.VERTEX_SHADER);if(t.shaderSource(n,e),t.compileShader(n),!t.getShaderParameter(n,t.COMPILE_STATUS))throw new Error(t.getShaderInfoLog(n)||"");const o=t.createShader(t.FRAGMENT_SHADER);if(t.shaderSource(o,i),t.compileShader(o),!t.getShaderParameter(o,t.COMPILE_STATUS))throw new Error(t.getShaderInfoLog(o)||"");const s=t.createProgram();if(t.attachShader(s,n),t.attachShader(s,o),t.linkProgram(s),!t.getProgramParameter(s,t.LINK_STATUS))throw new Error(t.getProgramInfoLog(s)||"");return s}(t,_,f);return t.useProgram(e),function(t){const e=new Float32Array([0,0,1,0,0,1,1,1]),i=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,i),t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW),t.enableVertexAttribArray(0),t.vertexAttribPointer(0,2,t.FLOAT,!1,0,0)}(t),p.forEach(i=>this._uniforms[i]=t.getUniformLocation(e,i)),this._program=e,t.enable(t.BLEND),t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA),t.enable(t.SCISSOR_TEST),t}_normalizedEventToPosition(t,e){return[Math.floor(t/this._options.tileWidth),Math.floor(e/this._options.tileHeight)]}_updateSize(){const t=this._gl,e=this._options,i=[e.width*e.tileWidth,e.height*e.tileHeight];t.canvas.width=i[0],t.canvas.height=i[1],t.viewport(0,0,i[0],i[1]),t.uniform2fv(this._uniforms.tileSize,[e.tileWidth,e.tileHeight]),t.uniform2fv(this._uniforms.targetSize,i)}_updateTexture(t){!function(t,e){let i=t.createTexture();t.bindTexture(t.TEXTURE_2D,i),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,0),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e)}(this._gl,t)}}const p=["targetPosRel","tilesetPosAbs","tileSize","targetSize","colorize","bg","tint"],_="\n#version 300 es\n\nin vec2 tilePosRel;\nout vec2 tilesetPosPx;\n\nuniform vec2 tilesetPosAbs;\nuniform vec2 tileSize;\nuniform vec2 targetSize;\nuniform vec2 targetPosRel;\n\nvoid main() {\n\tvec2 targetPosPx = (targetPosRel + tilePosRel) * tileSize;\n\tvec2 targetPosNdc = ((targetPosPx / targetSize)-0.5)*2.0;\n\ttargetPosNdc.y *= -1.0;\n\n\tgl_Position = vec4(targetPosNdc, 0.0, 1.0);\n\ttilesetPosPx = tilesetPosAbs + tilePosRel * tileSize;\n}".trim(),f="\n#version 300 es\nprecision highp float;\n\nin vec2 tilesetPosPx;\nout vec4 fragColor;\nuniform sampler2D image;\nuniform bool colorize;\nuniform vec4 bg;\nuniform vec4 tint;\n\nvoid main() {\n\tfragColor = vec4(0, 0, 0, 1);\n\n\tvec4 texel = texelFetch(image, ivec2(tilesetPosPx), 0);\n\n\tif (colorize) {\n\t\ttexel.rgb = tint.a * tint.rgb + (1.0-tint.a) * texel.rgb;\n\t\tfragColor.rgb = texel.a*texel.rgb + (1.0-texel.a)*bg.rgb;\n\t\tfragColor.a = texel.a + (1.0-texel.a)*bg.a;\n\t} else {\n\t\tfragColor = texel;\n\t}\n}".trim();let m={};function g(t){if(!(t in m)){let e;if("transparent"==t)e=[0,0,0,0];else if(t.indexOf("rgba")>-1){e=(t.match(/[\d.]+/g)||[]).map(Number);for(let t=0;t<3;t++)e[t]=e[t]/255}else e=d.fromString(t).map(t=>t/255),e.push(1);m[t]=e}return m[t]}var y=i(6);const v=/%([bc]){([^}]*)}/g,w=0,x=1,b=2,T=3;function A(t,e){let i={width:0,height:1},n=S(t,e),o=0;for(let t=0;t<n.length;t++){let e=n[t];switch(e.type){case w:o+=e.value.length;break;case x:i.height++,i.width=Math.max(i.width,o),o=0}}return i.width=Math.max(i.width,o),i}function S(t,e){let i=[],n=0;t.replace(v,(function(e,o,s,r){let a=t.substring(n,r);return a.length&&i.push({type:w,value:a}),i.push({type:"c"==o?b:T,value:s.trim()}),n=r+e.length,""}));let o=t.substring(n);return o.length&&i.push({type:w,value:o}),function(t,e){e||(e=1/0);let i=0,n=0,o=-1;for(;i<t.length;){let s=t[i];if(s.type==x&&(n=0,o=-1),s.type!=w){i++;continue}for(;0==n&&" "==s.value.charAt(0);)s.value=s.value.substring(1);let r=s.value.indexOf("\n");if(-1!=r){s.value=k(t,i,r,!0);let e=s.value.split("");for(;e.length&&" "==e[e.length-1];)e.pop();s.value=e.join("")}if(s.value.length){if(n+s.value.length>e){let r=-1;for(;;){let t=s.value.indexOf(" ",r+1);if(-1==t)break;if(n+t>e)break;r=t}if(-1!=r)s.value=k(t,i,r,!0);else if(-1!=o){let e=t[o],n=e.value.lastIndexOf(" ");e.value=k(t,o,n,!0),i=o}else s.value=k(t,i,e-n,!1)}else n+=s.value.length,-1!=s.value.indexOf(" ")&&(o=i);i++}else t.splice(i,1)}t.push({type:x});let s=null;for(let e=0;e<t.length;e++){let i=t[e];switch(i.type){case w:s=i;break;case x:if(s){let t=s.value.split("");for(;t.length&&" "==t[t.length-1];)t.pop();s.value=t.join("")}s=null}}return t.pop(),t}(i,e)}function k(t,e,i,n){let o={type:x},s={type:w,value:t[e].value.substring(i+(n?1:0))};return t.splice(e+1,0,o,s),t[e].value.substring(0,i)}const E={4:[[0,-1],[1,0],[0,1],[-1,0]],8:[[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1]],6:[[-1,-1],[1,-1],[2,0],[1,1],[-1,1],[-2,0]]},C={hex:l,rect:h,tile:u,"tile-gl":c,term:y.a},M={width:80,height:25,transpose:!1,layout:"rect",fontSize:15,spacing:1,border:0,forceSquareRatio:!1,fontFamily:"monospace",fontStyle:"",fg:"#ccc",bg:"#000",tileWidth:32,tileHeight:32,tileMap:{},tileSet:null,tileColorize:!1};(()=>{class t{constructor(t={}){this._data={},this._dirty=!1,this._options={},t=Object.assign({},M,t),this.setOptions(t),this.DEBUG=this.DEBUG.bind(this),this._tick=this._tick.bind(this),this._backend.schedule(this._tick)}DEBUG(t,e,i){let n=[this._options.bg,this._options.fg];this.draw(t,e,null,null,n[i%n.length])}clear(){this._data={},this._dirty=!0}setOptions(t){if(Object.assign(this._options,t),t.width||t.height||t.fontSize||t.fontFamily||t.spacing||t.layout){if(t.layout){let e=C[t.layout];this._backend=new e}this._backend.setOptions(this._options),this._dirty=!0}return this}getOptions(){return this._options}getContainer(){return this._backend.getContainer()}computeSize(t,e){return this._backend.computeSize(t,e)}computeFontSize(t,e){return this._backend.computeFontSize(t,e)}computeTileSize(t,e){return[Math.floor(t/this._options.width),Math.floor(e/this._options.height)]}eventToPosition(t){let e,i;return"touches"in t?(e=t.touches[0].clientX,i=t.touches[0].clientY):(e=t.clientX,i=t.clientY),this._backend.eventToPosition(e,i)}draw(t,e,i,n,o){n||(n=this._options.fg),o||(o=this._options.bg);let s=`${t},${e}`;this._data[s]=[t,e,i,n,o],!0!==this._dirty&&(this._dirty||(this._dirty={}),this._dirty[s]=!0)}drawText(t,e,i,n){let o=null,s=null,r=t,a=e,l=1;n||(n=this._options.width-t);let h=S(i,n);for(;h.length;){let e=h.shift();switch(e.type){case w:let i=!1,n=!1,h=!1,u=!1;for(let t=0;t<e.value.length;t++){let l=e.value.charCodeAt(t),d=e.value.charAt(t);if("term"===this._options.layout){let t=l>>8;if(17===t||t>=46&&t<=159||t>=172&&t<=215||l>=43360&&l<=43391){this.draw(r+0,a,d,o,s),this.draw(r+1,a,"\t",o,s),r+=2;continue}}h=l>65280&&l<65377||l>65500&&l<65512||l>65518,i=32==d.charCodeAt(0)||12288==d.charCodeAt(0),!u||h||i||r++,h&&!n&&r++,this.draw(r++,a,d,o,s),n=i,u=h}break;case b:o=e.value||null;break;case T:s=e.value||null;break;case x:r=t,a++,l++}}return l}_tick(){if(this._backend.schedule(this._tick),this._dirty){if(!0===this._dirty){this._backend.clear();for(let t in this._data)this._draw(t,!1)}else for(let t in this._dirty)this._draw(t,!0);this._dirty=!1}}_draw(t,e){let i=this._data[t];i[4]!=this._options.bg&&(e=!0),this._backend.draw(i,e)}}t.Rect=h,t.Hex=l,t.Tile=u,t.TileGL=c,t.Term=y.a})();Math.sqrt(3),Math.sqrt(3);class I{constructor(t,e,i,n={}){this._toX=t,this._toY=e,this._passableCallback=i,this._options=Object.assign({topology:8},n),this._dirs=E[this._options.topology],8==this._options.topology&&(this._dirs=[this._dirs[0],this._dirs[2],this._dirs[4],this._dirs[6],this._dirs[1],this._dirs[3],this._dirs[5],this._dirs[7]])}_getNeighbors(t,e){let i=[];for(let n=0;n<this._dirs.length;n++){let o=this._dirs[n],s=t+o[0],r=e+o[1];this._passableCallback(s,r)&&i.push([s,r])}return i}}var P={Dijkstra:class extends I{constructor(t,e,i,n){super(t,e,i,n),this._computed={},this._todo=[],this._add(t,e,null)}compute(t,e,i){let n=t+","+e;if(n in this._computed||this._compute(t,e),!(n in this._computed))return;let o=this._computed[n];for(;o;)i(o.x,o.y),o=o.prev}_compute(t,e){for(;this._todo.length;){let i=this._todo.shift();if(i.x==t&&i.y==e)return;let n=this._getNeighbors(i.x,i.y);for(let t=0;t<n.length;t++){let e=n[t],o=e[0],s=e[1];o+","+s in this._computed||this._add(o,s,i)}}}_add(t,e,i){let n={x:t,y:e,prev:i};this._computed[t+","+e]=n,this._todo.push(n)}},AStar:class extends I{constructor(t,e,i,n={}){super(t,e,i,n),this._todo=[],this._done={}}compute(t,e,i){for(this._todo=[],this._done={},this._fromX=t,this._fromY=e,this._add(this._toX,this._toY,null);this._todo.length;){let i=this._todo.shift(),n=i.x+","+i.y;if(n in this._done)continue;if(this._done[n]=i,i.x==t&&i.y==e)break;let o=this._getNeighbors(i.x,i.y);for(let t=0;t<o.length;t++){let e=o[t],n=e[0],s=e[1];n+","+s in this._done||this._add(n,s,i)}}let n=this._done[t+","+e];if(n)for(;n;)i(n.x,n.y),n=n.prev}_add(t,e,i){let n=this._distance(t,e),o={x:t,y:e,prev:i,g:i?i.g+1:0,h:n},s=o.g+o.h;for(let t=0;t<this._todo.length;t++){let e=this._todo[t],i=e.g+e.h;if(s<i||s==i&&n<e.h)return void this._todo.splice(t,0,o)}this._todo.push(o)}_distance(t,e){switch(this._options.topology){case 4:return Math.abs(t-this._fromX)+Math.abs(e-this._fromY);case 6:let i=Math.abs(t-this._fromX),n=Math.abs(e-this._fromY);return n+Math.max(0,(i-n)/2);case 8:return Math.max(Math.abs(t-this._fromX),Math.abs(e-this._fromY))}}}};const F=function(t,e){return Math.floor(Math.random()*(e-t))+t},B=function(t){return t[Math.floor(Math.random()*t.length)]};const z=document.getElementById("spells"),O=document.getElementById("level"),R=document.getElementById("coins"),D=t=>{let e="";t.forEach((t,i)=>{e+=`<div ${t.used?"class=used":""}>${i+1} - ${t.name}\n    </div>`}),z.innerHTML=e},H=(t,e)=>{O.innerHTML=t,R.innerHTML=e};var L=i(5),X=i.p+"166635d20d1b572367147958c4878681.png",W=i.p+"484403c37a1ef2fb4057bbf3eaa9844d.png";i.p,i.p,i.p,i.p,i.p;const G=new L.Game({width:600,height:600,parent:"game"});document.addEventListener("DOMContentLoaded",(function(){G.context.font="30px Goblin"}));const Y=G.width/7,U=Y/32,N=new L.SpriteSheet({path:""+X,context:G.context,colSize:32,rowSize:32}),q=new L.SpriteSheet({path:""+W,context:G.context,colSize:15,rowSize:15}),j=q.getSprite(0,0),$=q.getSprite(1,0),V=q.getSprite(2,0),Q=q.getSprite(3,0),Z=N.getSprite(0,0),K=(N.getSprite(1,0),N.getSprite(2,0),N.getSprite(3,0)),J=N.getSprite(4,0),tt=N.getSprite(5,0),et=N.getSprite(6,0),it=N.getSprite(7,0),nt=N.getSprite(8,0),ot=N.getSprite(9,0),st=N.getSprite(10,0),rt=N.getSprite(19,0),at=N.getSprite(20,0),lt=N.getSprite(21,0),ht=N.getSprite(22,0);var ut={black:"#17111a",darkPurple:"#372538",darkRed:"#7a213a",red:"#e14141",tan:"#ffa070",darkOrange:"#c44d29",gold:"#ffbf36",yellow:"#fff275",brown:"#753939",darkTan:"#cf7957",lightTan:"#ffd1ab",darkGreen:"#39855a",green:"#83e04c",lightGreen:"#dcff70",darkBlue:"#243b61",blue:"#3898ff",lightBlue:"#6eeeff",darkPink:"#682b82",pink:"#bf3fb3",lightPink:"#ff80aa",darkGray:"#3e375c",gray:"#7884ab",lightGray:"#b2bcc2",white:"#ffffff"};const dt=N.getSprite(15,0),ct=N.getSprite(14,0),pt=N.getSprite(17,0),_t=t=>class extends t{constructor(t){super(t),this.spells=[],this.registeredSpells=[{spell:this.jump.bind(this),name:"jump",desc:"transport to a random empty tile"},{spell:this.hurricane.bind(this),name:"hurricane",desc:"shuffle the enemies on the board"},{spell:this.heal.bind(this),name:"heal",desc:"gain one health point"},{spell:this.col.bind(this),name:"column",desc:"damage all enemies in your column"},{spell:this.row.bind(this),name:"row",desc:"damage all enemies in your row"},{spell:this.push.bind(this),name:"push",desc:"push all enemies away from you"},{spell:this.pull.bind(this),name:"pull",desc:"pull all enemies toward you"},{spell:this.stun.bind(this),name:"stun",desc:"stuns all enemies for 1 turn"},{spell:this.beachBall.bind(this),name:"beach ball",desc:"throw beach ball"},{spell:this.dash.bind(this),name:"dash",desc:"dash in some direction, can damage enemies"},{spell:this.damageTrap.bind(this),name:"trap",desc:"set a trap, will harm enemies that step on it"},{spell:this.hitAllTrap.bind(this),name:"super trap",desc:"set a trap, will harm all enemies of the type that steps on it"},{spell:this.waterAttack.bind(this),name:"water attack",desc:"harms all enemies in water"},{spell:this.bugSpray.bind(this),name:"bug spray",desc:"harms all wasps"},{spell:this.wait.bind(this),name:"wait",desc:"wait a turn"}],this.getRandomSpell()}resetSpells(){this.spells.forEach(t=>t.used=!1)}doSpell(t){t.used||(t.used=!0,D(this.spells),t.spell())}getRandomSpell(){const t=B(this.registeredSpells);if(this.spells.includes(t))return this.getRandomSpell();this.spells.length<9&&this.spells.push(t)}jump(){const t=this.map.randomEmptyTile(),e=this.map.getTileFromCanvasCoords(this.x,this.y);this.map.getTile(t.x,t.y).entity=this,e.entity=null,this.x=t.x*this.tileSize,this.y=t.y*this.tileSize}hurricane(){G.enemies.forEach(t=>{const e=this.map.randomEmptyTile(),i=this.map.getTileFromCanvasCoords(t.x,t.y);this.map.getTile(e.x,e.y).entity=t,i.entity=null,t.x=e.x*t.tileSize,t.y=e.y*t.tileSize})}heal(t){this.hp=Math.min(this.hp+1,this.maxHp),t||(this.map.getTileFromCanvasCoords(this.x,this.y).setEffect(dt),document.dispatchEvent(new CustomEvent("splode",{detail:{x:this.x,y:this.y,noFall:!0,life:.5,colorArray:[ut.green,ut.darkGreen,ut.lightGreen,ut.darkBlue]}})))}col(){const t=this.map.getMapCoordsFromCanvasCoords(this.x,this.y);this.map.map[t.x].forEach(t=>{(!t.entity||t.entity&&!t.entity.isRoosta)&&t.setEffect(ct),t.entity&&!t.entity.isRoosta&&t.entity.takeDamage()})}row(){const t=this.map.getMapCoordsFromCanvasCoords(this.x,this.y);this.map.map.forEach(e=>{const i=e[t.y];(!i.entity||i.entity&&!i.entity.isRoosta)&&i.setEffect(pt),i.entity&&!i.entity.isRoosta&&i.entity.takeDamage()})}push(){const t=this.map.getMapCoordsFromCanvasCoords(this.x,this.y);this.map.map.forEach(e=>e.forEach(e=>{const{entity:i}=e;if(i&&!i.isRoosta&&!i.hasBeenPushed){const e=this.map.getMapCoordsFromCanvasCoords(i.x,i.y),n=e.x-t.x,o=e.y-t.y;if(Math.abs(n)>=Math.abs(o)){const t=n>0?1:-1;i.isBeingMoved=!0,i.hasBeenPushed=!0,i.move(t,0)}else{const t=o>0?1:-1;i.isBeingMoved=!0,i.move(0,t),i.hasBeenPushed=!0}}})),G.enemies.forEach(t=>t.hasBeenPushed=!1)}pull(){const t=this.map.getMapCoordsFromCanvasCoords(this.x,this.y);this.map.map.forEach(e=>e.forEach(e=>{const{entity:i}=e;if(i&&!i.isRoosta&&!i.hasBeenPushed){const e=this.map.getMapCoordsFromCanvasCoords(i.x,i.y),n=e.x-t.x,o=e.y-t.y;if(Math.abs(n)>=Math.abs(o)){const t=n<0?1:-1;i.isBeingMoved=!0,i.hasBeenPushed=!0,i.move(t,0,!0)}else{const t=o<0?1:-1;i.isBeingMoved=!0,i.move(0,t,!0),i.hasBeenPushed=!0}}})),G.enemies.forEach(t=>t.hasBeenPushed=!1)}stun(){G.enemies.forEach(t=>t.stunned=!0)}dispatchDirectionFunction(t){document.dispatchEvent(new CustomEvent("directionFunction",{detail:{callback:t}}))}dispatchBeachBall(t,e,i,n){document.dispatchEvent(new CustomEvent("beachBall",{detail:{x1:t,y1:e,x2:i,y2:n}}))}beachBall(){this.dispatchDirectionFunction(t=>{const e=this.map.getMapCoordsFromCanvasCoords(this.x,this.y),i=this.map.map.length;if(["ArrowRight","ArrowLeft","ArrowUp","ArrowDown"].includes(t)){if("ArrowRight"===t){const t=this.map.getTile(e.x+1,e.y);if(t.entity||!t.isWalkable)return!1;for(let t=e.x+1;t<i;t++){const i=this.map.map[t][e.y];if(i.entity)return this.dispatchBeachBall(this.x,this.y,i.entity.x,i.entity.y),i.entity.takeDamage(),!0}}if("ArrowLeft"===t){const t=this.map.getTile(e.x-1,e.y);if(t.entity||!t.isWalkable)return!1;for(let t=e.x-1;t>=0;t--){const i=this.map.map[t][e.y];if(i.entity)return this.dispatchBeachBall(this.x,this.y,i.entity.x,i.entity.y),i.entity.takeDamage(),!0}}if("ArrowUp"===t){const t=this.map.getTile(e.x,e.y-1);if(t.entity||!t.isWalkable)return!1;for(let t=e.y-1;t>=0;t--){const i=this.map.map[e.x][t];if(i.entity)return this.dispatchBeachBall(this.x,this.y,i.entity.x,i.entity.y),i.entity.takeDamage(),!0}}if("ArrowDown"===t){const t=this.map.getTile(e.x,e.y+1);if(t.entity||!t.isWalkable)return!1;for(let t=e.y+1;t<i;t++){const i=this.map.map[e.x][t];if(i.entity)return this.dispatchBeachBall(this.x,this.y,i.entity.x,i.entity.y),i.entity.takeDamage(),!0}}return!0}return!1})}dash(){this.dispatchDirectionFunction(t=>{const e=this.map.getMapCoordsFromCanvasCoords(this.x,this.y),i=this.map.map.length;if(["ArrowRight","ArrowLeft","ArrowUp","ArrowDown"].includes(t)){if("ArrowRight"===t){const t=this.map.getTile(e.x+1,e.y);if(t.entity||!t.isWalkable)return!1;for(let t=e.x+1;t<i;t++){const i=this.map.map[t][e.y];if(i.entity)return i.entity.takeDamage(),this.speed=30,this.moveTo(t-1,e.y),!0;if(!this.map.isPassable(t,e.y))return this.moveTo(t-1,e.y),this.speed=30,!0}this.speed=30,this.moveTo(i-1,e.y)}if("ArrowLeft"===t){const t=this.map.getTile(e.x-1,e.y);if(t.entity||!t.isWalkable)return!1;for(let t=e.x-1;t>=0;t--){const i=this.map.map[t][e.y];if(i.entity)return i.entity.takeDamage(),this.speed=30,this.moveTo(t+1,e.y),!0;if(!this.map.isPassable(t,e.y))return this.moveTo(t+1,e.y),this.speed=30,!0}this.speed=30,this.moveTo(0,e.y)}if("ArrowUp"===t){const t=this.map.getTile(e.x,e.y-1);if(t.entity||!t.isWalkable)return!1;for(let t=e.y-1;t>=0;t--){const i=this.map.map[e.x][t];if(i.entity)return i.entity.takeDamage(),this.speed=30,this.moveTo(e.x,t+1),!0;if(!this.map.isPassable(e.x,t))return this.speed=30,this.moveTo(e.x,t+1),!0}this.speed=30,this.moveTo(e.x,0)}if("ArrowDown"===t){const t=this.map.getTile(e.x,e.y+1);if(t.entity||!t.isWalkable)return!1;for(let t=e.y+1;t<i;t++){const i=this.map.map[e.x][t];if(i.entity)return i.entity.takeDamage(),this.speed=30,this.moveTo(e.x,t-1),!0;if(!this.map.isPassable(e.x,t))return this.speed=30,this.moveTo(e.x,t-1),!0}this.speed=30,this.moveTo(e.x,i-1)}return!0}return!1})}damageTrap(){this.dispatchDirectionFunction(t=>{const e=function(){this.entity.takeDamage(2)},{x:i,y:n}=this.map.getMapCoordsFromCanvasCoords(this.x,this.y);if(["ArrowRight","ArrowLeft","ArrowUp","ArrowDown"].includes(t)){if("ArrowRight"===t){const t=this.map.getTile(i+1,n);if(t.entity||!t.isWalkable)return!1;t.trap="damage",t.trapCallback=e}if("ArrowLeft"===t){const t=this.map.getTile(i-1,n);if(t.entity||!t.isWalkable)return!1;t.trap="damage",t.trapCallback=e}if("ArrowUp"===t){const t=this.map.getTile(i,n-1);if(t.entity||!t.isWalkable)return!1;t.trap="damage",t.trapCallback=e}if("ArrowDown"===t){const t=this.map.getTile(i,n+1);if(t.entity||!t.isWalkable)return!1;t.trap="damage",t.trapCallback=e}return!0}return!1})}hitAllTrap(){this.dispatchDirectionFunction(t=>{const e=function(){G.enemies.filter(t=>t.name===this.entity.name).forEach(t=>t.takeDamage()),this.entity&&this.entity.takeDamage(2)},{x:i,y:n}=this.map.getMapCoordsFromCanvasCoords(this.x,this.y);if(["ArrowRight","ArrowLeft","ArrowUp","ArrowDown"].includes(t)){if("ArrowRight"===t){const t=this.map.getTile(i+1,n);if(t.entity||!t.isWalkable)return!1;t.trap="hitAll",t.trapCallback=e}if("ArrowLeft"===t){const t=this.map.getTile(i-1,n);if(t.entity||!t.isWalkable)return!1;t.trap="hitAll",t.trapCallback=e}if("ArrowUp"===t){const t=this.map.getTile(i,n-1);if(t.entity||!t.isWalkable)return!1;t.trap="hitAll",t.trapCallback=e}if("ArrowDown"===t){const t=this.map.getTile(i,n+1);if(t.entity||!t.isWalkable)return!1;t.trap="hitAll",t.trapCallback=e}return!0}return!1})}waterAttack(){this.map.map.forEach(t=>{t.forEach(t=>{!t.isWalkable&&t.entity&&t.entity.takeDamage(2)})})}bugSpray(){G.enemies.filter(t=>"wasp"===t.name).forEach(t=>t.takeDamage())}wait(){this.doneCallback()}};class ft{constructor({x:t,y:e,tileSize:i,map:n,doneCallback:o=(()=>{}),noTile:s=!1}){if(this.map=n,this.x=t,this.displayX=t,this.y=e,this.displayY=e,this.tileSize=i,this.moving=!1,this.sprite=ot,this.doneCallback=o,this.hp=1,this.maxHp=1,this.speed=10,!s){this.map.getTileFromCanvasCoords(this.x,this.y).entity=this}}takeDamage(t=1){this.hp-=t,this.hp<1&&(this.getTile().entity=null,this.dead=!0)}getTile(){return this.map.getTileFromCanvasCoords(this.x,this.y)}takeTurn(){this.attackedThisTurn=!1}moveTo(t,e){const i=t*this.tileSize,n=e*this.tileSize,o=this.map.getMapCoordsFromCanvasCoords(i,n);if(!this.map.isInBounds(o.x,o.y))return!1;const s=this.map.getTileFromCanvasCoords(i,n),r=this.map.getTileFromCanvasCoords(this.x,this.y);if(s&&s.isEmpty()&&this.canWalkHere(o.x,o.y))return this.displayX=this.x,this.displayY=this.y,this.x=i,this.y=n,s.entity=this,s.triggerTrap(),r.entity=null,this.moving=!0,!0;if(s&&!s.isEmpty()){const{entity:t}=s;if(t.isRoosta||this.isRoosta)return this.displayX-=(this.displayX-t.x)/3,this.displayY-=(this.displayY-t.y)/3,t.takeDamage(),this.attackedThisTurn=!0,!0}return!1}move(t,e,i=!1){const n=this.x+this.tileSize*t,o=this.y+this.tileSize*e,s=this.map.getMapCoordsFromCanvasCoords(n,o);if(!this.map.isInBounds(s.x,s.y))return!1;const r=this.map.getTileFromCanvasCoords(n,o),a=this.map.getTileFromCanvasCoords(this.x,this.y);if(r&&r.isEmpty()&&this.canWalkHere(s.x,s.y))return this.displayX=this.x,this.displayY=this.y,this.x=n,this.y=o,r.entity=this,r.triggerTrap(),a.entity=null,this.moving=!0,!0;if(r&&!r.isEmpty()&&!i){const{entity:t}=r;if(t.isRoosta||this.isRoosta)return this.displayX-=(this.displayX-t.x)/3,this.displayY-=(this.displayY-t.y)/3,t.takeDamage(),this.attackedThisTurn=!0,!0}return!1}canWalkHere(t,e){const i=this.map.getTileFromCanvasCoords(this.x,this.y);return this.isBeingMoved||!i.isWalkable?(this.isBeingMoved=!1,this.map.isInBounds(t,e)):this.map.isPassable(t,e)}draw(){const{displayX:t,displayY:e,tileSize:i}=this;this.sprite.draw(t,e,i,i)}keydown(){}keyup(){}update(t){let e=!0;Math.abs(this.displayX-this.x)>2?this.displayX-=(this.displayX-this.x)*this.speed*t:(this.displayX=this.x,e=!1),Math.abs(this.displayY-this.y)>2?this.displayY-=(this.displayY-this.y)*this.speed*t:(this.displayY=this.y,e||(this.moving=!1,this.speed=10))}}class mt extends(_t(ft)){constructor(t){super(t),this.isRoosta=!0,this.hp=3,this.maxHp=3,this.sprite=Z,this.coins=0}takeDamage(){super.takeDamage(),document.dispatchEvent(new CustomEvent("sound",{detail:{sound:"cluck"}})),document.dispatchEvent(new CustomEvent("screenShake",{})),this.hp<1&&document.dispatchEvent(new CustomEvent("die",{}))}wait(){this.doneCallback()}move(t,e){if(super.move(t,e)){const t=this.map.getTileFromCanvasCoords(this.x,this.y);t.coin&&(t.coin=!1,this.coins++,document.dispatchEvent(new CustomEvent("sound",{detail:{sound:"coin"}})),H(G.level,this.coins),this.coins%3==0&&(this.getRandomSpell(),D(this.spells))),t.exit?document.dispatchEvent(new CustomEvent("exit")):this.doneCallback()}}moveTo(t,e){if(super.moveTo(t,e)){const t=this.map.getTileFromCanvasCoords(this.x,this.y);t.coin&&(t.coin=!1,this.coins++,document.dispatchEvent(new CustomEvent("sound",{detail:{sound:"coin"}})),H(G.level,this.coins),this.coins%3==0&&(this.getRandomSpell(),D(this.spells))),t.exit?document.dispatchEvent(new CustomEvent("exit")):this.doneCallback()}}keydown(t){"ArrowRight"===t&&this.move(1,0),"ArrowLeft"===t&&this.move(-1,0),"ArrowUp"===t&&this.move(0,-1),"ArrowDown"===t&&this.move(0,1),t>=1&&t<=9&&this.doSpell(this.spells[t-1])}drawAvailableDirections(){const t=Y/2,e=this.x+Y/2-t/2,i=this.y+Y/2-t/2,{x:n,y:o}=this.map.getMapCoordsFromCanvasCoords(this.x,this.y);this.map.getAdjacentEmptyTiles(n,o).forEach(s=>{s.y-o==-1&&j.draw(e,this.y-Y/4,t,t),s.y-o==1&&$.draw(e,this.y+Y-Y/4,t,t),s.x-n==-1&&Q.draw(this.x-Y/4,i,t,t),s.x-n==1&&V.draw(this.x+Y-Y/4,i,t,t)})}draw(){super.draw();const{displayX:t,displayY:e,tileSize:i}=this;for(let n=0;n<this.hp;n++)tt.draw(8+t+24*n,e+64,i,i)}}class gt extends ft{constructor(t){super(t),this.spawning=!0}takeTurn(t){if(super.takeTurn(),this.spawning)return void(this.spawning=!1);if(this.stunned)return void(this.stunned=!1);if(this.dead)return;const e=this.map.getMapCoordsFromCanvasCoords(t.x,t.y),i=new P.AStar(e.x,e.y,this.aStarCallback.bind(this),{topology:4}),n=this.map.getMapCoordsFromCanvasCoords(this.x,this.y),o=[];if(i.compute(n.x,n.y,(t,e)=>o.push({x:t,y:e})),o[1]){const t=o[1].x-n.x,e=o[1].y-n.y;this.move(t,e)}}aStarCallback(t,e){const i=this.map.getTileFromCanvasCoords(this.x,this.y);return this.isBeingMoved||!i.isWalkable?(this.isBeingMoved=!1,this.map.isInBounds(t,e)):this.map.isPassable(t,e)}update(t){super.update(t),this.shakeTimer-=t}draw(){const{displayX:t,displayY:e,tileSize:i}=this;let n=0,o=0;this.shakeTimer>0&&(n=F(-50,50)*this.shakeTimer,o=F(-50,50)*this.shakeTimer),this.spawning?ht.draw(t,e,i,i):this.sprite.draw(t+n,e+o,i,i)}takeDamage(t){if(super.takeDamage(t),this.stunned=!0,this.spawning=!1,this.shakeTimer=.2,this.hp<1){const t=this.map.getTileFromCanvasCoords(this.x,this.y);Math.random()<.15&&(t.coin=!0),document.dispatchEvent(new CustomEvent("splode",{detail:{x:this.x,y:this.y}})),document.dispatchEvent(new CustomEvent("sound",{detail:{sound:"pop"}}))}}}class yt extends gt{constructor(t){super(t),this.sprite=J,this.name="crab",this.hp=2}canWalkHere(t,e){return this.map.isInBounds(t,e)}aStarCallback(t,e){return this.map.isInBounds(t,e)}takeTurn(t){this.dead||super.takeTurn(t)}move(t,e){super.move(t,e)}takeDamage(t){super.takeDamage(t),this.hp>0&&document.dispatchEvent(new CustomEvent("sound",{detail:{sound:"snap"}})),1===this.hp&&(this.sprite=rt)}}class vt extends gt{constructor(t){super(t),this.sprite=Math.random()<.8?K:ot,this.hp=2,this.duck=!0,this.name="duck"}takeDamage(t){super.takeDamage(t),this.hp>0&&document.dispatchEvent(new CustomEvent("sound",{detail:{sound:"quack"}})),1===this.hp&&(this.sprite=st)}update(t){super.update(t)}}class wt extends gt{constructor(t){super(t),this.sprite=et,this.name="snake",this.hp=2}takeDamage(t){super.takeDamage(t),this.hp>0&&document.dispatchEvent(new CustomEvent("sound",{detail:{sound:"snap"}})),1===this.hp&&(this.sprite=lt)}}class xt extends gt{constructor(t){super(t),this.sprite=it,this.name="wasp"}takeTurn(t){super.takeTurn(t),this.attackedThisTurn||super.takeTurn(t)}}class bt extends gt{constructor(t){super(t),this.sprite=nt,this.stunned=!1,this.name="star",this.hp=2}takeTurn(t){this.stunned?this.stunned=!this.stunned:(super.takeTurn(t),this.stunned=!0)}takeDamage(t){super.takeDamage(t),this.hp>0&&document.dispatchEvent(new CustomEvent("sound",{detail:{sound:"oof"}})),1===this.hp&&(this.sprite=at)}}const Tt=N.getSprite(12,0),At=N.getSprite(13,0),St=N.getSprite(18,0),kt=N.getSprite(16,0);class Et{constructor({isWalkable:t,sprite:e,x:i,y:n,map:o}){this.isWalkable=t,this.x=i,this.y=n,this.sprite=e,this.entity=null,this.trap=null,this.trapCallback=null,this.effectCounter=0,this.exit=!1,this.coin=!1,this.map=o}triggerTrap(){this.trapCallback&&(this.trapCallback(),this.trap=null,this.trapCallback=null)}isEmpty(){return!this.entity}setEffect(t){this.effect=t,this.effectCounter=1}getNeighbor(t,e){return this.map.getTile(this.x+t,this.y+e)}getAdjacentNeighbors(){return function(t){let e,i;for(let n=1;n<t.length;n++)i=F(0,n),e=t[n],t[n]=t[i],t[i]=e;return t}([this.getNeighbor(0,-1),this.getNeighbor(0,1),this.getNeighbor(-1,0),this.getNeighbor(1,0)])}getAdjacentPassableNeighbors(){return this.getAdjacentNeighbors().filter(t=>t.isWalkable)}getConnectedTiles(){let t=[this],e=[this];for(;e.length;){const i=e.pop().getAdjacentPassableNeighbors().filter(e=>!t.includes(e));t=t.concat(i),e=e.concat(i)}return t}update(t){this.effectCounter&&(this.effectCounter=Math.max(this.effectCounter-t,0))}drawEffect(t,e){this.effectCounter&&(G.context.globalAlpha=this.effectCounter/1,this.effect.draw(t*Y,e*Y,Y,Y),G.context.globalAlpha=1)}draw(t,e){this.sprite.draw(t*Y,e*Y,Y,Y),this.trap&&("damage"===this.trap&&At.draw(t*Y,e*Y,Y,Y),"hitAll"===this.trap&&Tt.draw(t*Y,e*Y,Y,Y)),this.exit&&St.draw(t*Y,e*Y,Y,Y),this.coin&&kt.draw(t*Y,e*Y,Y,Y)}}class Ct{constructor({gridSize:t,tileSize:e}){this.gridSize=t,this.tileSize=e,this.spriteSheet=N,this.map=[],this.generateMap(t),function(t,e){for(let t=1e3;t>0;t--)if(e())return;throw"Timeout while trying to "+t}("generate map",()=>{const e=this.generateMap(t),{x:i,y:n}=this.randomEmptyTile();return this.getTile(i,n).getConnectedTiles().length===e});const{x:i,y:n}=this.randomEmptyTile();this.getTile(i,n).exit=!0;for(let t=0;t<3;t++){const{x:t,y:e}=this.randomEmptyTile();this.getTile(t,e).coin=!0}}generateMap(t){let e=0;const i=this.spriteSheet.getSprite(2,0),n=this.spriteSheet.getSprite(1,0);for(let o=0;o<t;o++){this.map[o]=[];for(let s=0;s<t;s++)Math.random()<.3?this.map[o][s]=new Et({isWalkable:!1,sprite:i,x:o,y:s,map:this}):(e++,this.map[o][s]=new Et({isWalkable:!0,sprite:n,x:o,y:s,map:this}))}return e}getTile(t,e){return this.isInBounds(t,e)?this.map[t][e]:new Et({isWalkable:!1})}getTileFromCanvasCoords(t,e){const i=Math.ceil(t/this.tileSize),n=Math.ceil(e/this.tileSize);return this.map[i][n]}getMapCoordsFromCanvasCoords(t,e){return{x:Math.ceil(t/this.tileSize),y:Math.ceil(e/this.tileSize)}}isInBounds(t,e){return t>=0&&t<this.gridSize&&e>=0&&e<this.gridSize}isPassable(t,e){let i=!1;return this.map[t]&&this.map[t][e]&&(i=this.isInBounds(t,e)&&this.map[t][e].isWalkable),i}isEmpty(t,e){return!(!this.map[t]||!this.map[t][e])&&(this.isInBounds(t,e)&&this.map[t][e].isEmpty())}update(t){this.map.forEach((e,i)=>{e.forEach((e,i)=>{e.update(t)})})}draw(){this.map.forEach((t,e)=>{t.forEach((t,i)=>{t.draw(e,i)})})}drawEffects(){this.map.forEach((t,e)=>{t.forEach((t,i)=>{t.drawEffect(e,i)})})}getAdjacentTiles(t,e){const i=[],n=t-1,o=t+1,s=e-1,r=e+1;return this.isInBounds(n,e)&&i.push(this.getTile(n,e)),this.isInBounds(o,e)&&i.push(this.getTile(o,e)),this.isInBounds(t,s)&&i.push(this.getTile(t,s)),this.isInBounds(t,r)&&i.push(this.getTile(t,r)),i}getAdjacentEmptyTiles(t,e){return this.getAdjacentTiles(t,e).filter(t=>t.isEmpty()&&t.isWalkable)}randomEmptyTile(){const t=F(0,this.gridSize),e=F(0,this.gridSize);return this.map[t][e].isEmpty()&&this.map[t][e].isWalkable&&!this.map[t][e].exit&&!this.map[t][e].coin?{x:t,y:e}:this.randomEmptyTile()}}class Mt{constructor({x:t,y:e,pixelSize:i,noFall:n,colorArray:o,life:s=F(1,2)}){this.x=t,this.y=e,this.pixelSize=i,this.dx=400*(2*Math.random()-1),this.dy=400*(2*Math.random()-1),this.color=B(o),this.life=s,this.noFall=n}update(t){this.x+=this.dx*t,this.y+=this.dy*t,this.noFall||(this.dy+=30),this.life-=t,(this.x<0||this.x>G.width||this.y<0||this.y>G.height||this.life<0)&&(this.dead=!0)}draw(){G.context.fillStyle=this.color,G.context.globalAlpha=Math.max(this.life,0),G.context.fillRect(this.x,this.y,this.pixelSize,this.pixelSize),G.context.globalAlpha=1}}var It=i(1),Pt=i.p+"962312116795abe69384a5ab3cc379dc.mp3",Ft=i.p+"7919370edb2f56534140e711e428f632.mp3",Bt=i.p+"523904481881beebe8bc44b5a6a529cc.mp3",zt=i.p+"c5efdf3eb223e65baca427e36cb064a6.mp3",Ot=i.p+"d285cc6032401c90c4c047a1ff4e7d22.mp3",Rt=i.p+"b1167ac65160d24b6d1ec328ab5d627b.wav",Dt=i.p+"e7c93e828fa83e6a059a028b76664994.wav",Ht=i.p+"7421a8f14b59a0c74664367969fea093.wav",Lt=i.p+"05482570c4509dd1e54ed27fe407ec60.wav",Xt=i.p+"79e2532c385f2a8a71afab6edb778f80.wav",Wt=i.p+"4b0d9048e63ee20b71ae8887f0821162.wav",Gt=i.p+"868ff80b568c881bdedcf2f9493a1a93.mp3",Yt=i.p+"0b3b89f829a5f4e1ffc0adfaef72ff75.mp3",Ut=i.p+"fa745c83e4fba88057762ea0739fd4b8.mp3";const Nt=new It.Howl({src:[""+Pt]}),qt=new It.Howl({src:[""+Ft]}),jt=new It.Howl({src:[""+Bt]}),$t=new It.Howl({src:[""+zt]}),Vt=new It.Howl({src:[""+Ot]}),Qt=new It.Howl({src:[""+Rt]}),Zt=new It.Howl({src:[""+Dt]}),Kt=new It.Howl({src:[""+Ht]}),Jt=new It.Howl({src:[""+Lt]}),te=new It.Howl({src:[""+Xt]}),ee=new It.Howl({src:[""+Wt]}),ie=new It.Howl({src:[Ut],loop:!0,volume:.6,autoplay:!0}),ne=new It.Howl({src:[""+Gt],loop:!0,volume:.3}),oe=new It.Howl({src:[""+Yt],loop:!0,volume:.2});document.addEventListener("sound",({detail:t})=>{"pop"===t.sound&&B([Nt,qt,jt]).play(),"cluck"===t.sound&&B([$t,Vt]).play(),"quack"===t.sound&&Qt.play(),"oof"===t.sound&&Zt.play(),"snap"===t.sound&&Kt.play(),"coin"===t.sound&&Jt.play(),"steel"===t.sound&&B([te,ee]).play(),"background"===t.sound&&(ne.volume(.3),ne.play(),oe.volume(.2),oe.play()),"backgroundStop"===t.sound&&(ne.fade(.3,0,500),ne.once("fade",()=>{ne.stop()}),oe.fade(.2,0,500),oe.once("fade",()=>{oe.stop()})),"theme"===t.sound&&(ie.volume(.6),ie.play()),"themeStop"===t.sound&&(ie.fade(.6,0,6500),ie.once("fade",()=>{ie.stop()}))});let se="menu",re={};const ae=function(t,e,i,n=function(){},o=function(){}){let s=e,r=Object.assign({},i);const a={state:s,context:r};return function(e,i){if(o(`sent '${e}'`),!e)return o("no event. returning currentState"),a;const l=t.find(t=>t.name===s);if(l){const a=Object.keys(l.transitions||{}).find(t=>t===e),h=l.transitions[a],u=h?h(i,r):{state:s,context:r};if(h){const i=t.find(t=>t.name===u.state);if(!i)throw`the transition '${e}' of current state '${s}', returned a non-existant desired state '${u.state}'.`;l.exit&&l.exit(),s=u.state,u.context=r=u.context?u.context:r,o(`state changed to '${u.state}'`),n(u);const a=i.enter&&i.enter(u.context||r);!a||a instanceof Promise||(r=u.context=a,n(u))}else o(`state '${s}' does not handle event '${e}'.`);return u}return o("could not find active state"),a}}([o("menu",{help:(t,e)=>(document.getElementById("help").style.transform="translateY(0)",{state:"help",context:{...e,previousState:t.currentState}}),start:(t,e)=>(G.level=1,de(),document.getElementById("splash").style.transform="translateY(-100%)",document.dispatchEvent(new CustomEvent("sound",{detail:{sound:"background"}})),document.dispatchEvent(new CustomEvent("sound",{detail:{sound:"themeStop"}})),{state:"fadeIn",context:{...e,faderOpacity:1}})}),o("help",{restart:(t,e)=>(document.getElementById("help").style.transform="translateY(-200%)",{state:e.previousState,context:{...e,previousState:"help"}})}),o("fadeIn",{transitionEnd:()=>({state:"play"})}),o("play",{help:(t,e)=>(document.getElementById("help").style.transform="translateY(0)",{state:"help",context:{...e,previousState:t.currentState}}),die:()=>(document.dispatchEvent(new CustomEvent("sound",{detail:{sound:"theme"}})),{state:"dying"}),win:()=>(document.getElementById("win").style.opacity="1",document.dispatchEvent(new CustomEvent("sound",{detail:{sound:"theme"}})),{state:"winScreen"}),receiveDirectionFunction:()=>{var t;return t="select a direction, <br>ESC to cancel",z.innerHTML=t,{state:"waitingForInput"}}}),o("waitingForInput",{resumePlaying:()=>(D(ue.spells),{state:"play"})}),o("dying",{transitionEnd:(t,e)=>({state:"fadeToBlack",context:{...e,faderOpacity:0}})}),o("fadeToBlack",{transitionEnd:()=>(document.getElementById("gameover").style.opacity="1",{state:"gameOver"})}),o("winScreen",{restart:()=>(document.getElementById("splash").style.transform="translateY(0%)",document.getElementById("win").style.opacity="0",document.dispatchEvent(new CustomEvent("sound",{detail:{sound:"backgroundStop"}})),{state:"menu"})}),o("gameOver",{restart:()=>(document.getElementById("splash").style.transform="translateY(0%)",document.getElementById("gameover").style.opacity="0",document.dispatchEvent(new CustomEvent("sound",{detail:{sound:"backgroundStop"}})),{state:"menu"})})],"menu",{faderOpacity:0,previousState:null},(function(t){se=t.state,re=t.context})),le=new class{constructor(t){this.pixelSize=t,this.particles=[]}splode(t,e,i=!1,n=Object.values(ut),o){for(let s=0;s<60;s++)this.particles.push(new Mt({x:t,y:e,pixelSize:this.pixelSize,noFall:i,colorArray:n,life:o}))}update(t){this.particles=this.particles.filter(t=>!t.dead),this.particles.forEach(e=>{e.update(t)})}draw(t){this.particles.forEach(e=>{e.draw(t)})}}(2*U);let he,ue;G.level=1;const de=function({existingRoosta:t}={}){document.dispatchEvent(new CustomEvent("sound",{detail:{sound:"steel"}})),he=new Ct({gridSize:7,tileSize:Y});const e=he.randomEmptyTile();t?(ue.map=he,ue.heal(!0),ue.resetSpells(),ue.moveTo(e.x,e.y)):ue=new mt({x:e.x*Y,y:e.y*Y,tileSize:Y,map:he,doneCallback:pe}),G.enemies=[];const i=[bt,vt,yt,wt,xt];function n(){const t=B(i),e=he.randomEmptyTile();G.enemies.push(new t({x:e.x*Y,y:e.y*Y,tileSize:Y,map:he}))}for(let t=0;t<G.level+2;t++)n();ce=0,D(ue.spells),H(G.level,ue.coins)};let ce=0;const pe=function(){const t=[bt,vt,yt,wt,xt];ce++,fe=!0;const e=[];G.enemies.forEach((t,i)=>{e.push(new Promise(e=>{setTimeout(()=>{t.takeTurn(ue),e()},50+50*i)}))}),Promise.all(e).then(()=>fe=!1),(ce<60&&ce%Math.max(10-G.level,3)==0||ce>60&&Math.random()<.9)&&G.enemies.length<12&&function(){const e=B(t),i=he.randomEmptyTile();G.enemies.push(new e({x:i.x*Y,y:i.y*Y,tileSize:Y,map:he}))}()};let _e,fe=!1;document.addEventListener("splode",({detail:t})=>{le.splode(t.x+Y/2,t.y+Y/2,t.noFall,t.colorArray,t.life)}),document.addEventListener("die",({detail:t})=>{fe=!0,ae("die")}),document.addEventListener("screenShake",({detail:t})=>{_e=10});let me=null;document.addEventListener("beachBall",({detail:{x1:t,y1:e,x2:i,y2:n}})=>{me=new ft({x:i,y:n,tileSize:Y,map:he,noTile:!0}),me.sprite=N.getSprite(11,0),me.displayX=t,me.displayY=e});let ge=null;document.addEventListener("directionFunction",({detail:t})=>{ae("receiveDirectionFunction"),ge=t.callback}),document.addEventListener("exit",()=>{G.level+=1,G.level>8?ae("win"):de({existingRoosta:ue})}),document.addEventListener("keydown",t=>{const{key:e}=t;if("menu"===se&&"Enter"===e&&ae("start"),"help"!==se&&"gameOver"!==se&&"winScreen"!==se){if(["ArrowRight","ArrowLeft","ArrowUp","ArrowDown"," "].includes(e)&&t.preventDefault(),"waitingForInput"===se)return"Escape"===e?void ae("resumePlaying"):void(ge(e)&&ae("resumePlaying"));"?"===e&&ae("help",{currentState:se}),fe||ue.keydown(e)}else ae("restart")}),document.addEventListener("keyup",({key:t})=>{fe||ue.keyup(t)}),G.update=function(t){"menu"!==se&&"help"!==se&&(ue.update(t),this.enemies=this.enemies.filter(t=>!t.dead),this.enemies.forEach(e=>e.update(t)),le.update(t),he.update(t),me&&(me.update(t),me.speed+=8,me.displayX===me.x&&me.displayY===me.y&&(document.dispatchEvent(new CustomEvent("splode",{detail:{x:me.x,y:me.y}})),me=null)),"fadeToBlack"===se&&(fe=!0,re.faderOpacity+=.04,re.faderOpacity>=1.7&&(ae("transitionEnd"),_e=0)),"fadeIn"===se&&(fe=!0,re.faderOpacity-=.08,re.faderOpacity<=0&&(ae("transitionEnd"),fe=!1)),"dying"===se?(fe=!0,_e+=.2,_e>20&&ae("transitionEnd")):_e&&"play"===se&&(_e=Math.max(_e-80*t,0)))},G.draw=function(){if(G.context.fillStyle=ut.black,G.context.fillRect(-100,-100,2e3,2e3),"menu"!==se&&"menu"!==re.previousState&&"gameOver"!==se&&"winScreen"!==se){if(["help","waitingForInput","play","fadeToBlack","fadeIn","dying"].includes(se)){const t=Math.random()*Math.PI*2,e=Math.round(Math.cos(t)*_e),i=Math.round(Math.sin(t)*_e);G.context.setTransform(1,0,0,1,e,i),he.draw(),this.enemies.forEach(t=>{t.dead||t.draw()}),me&&me.draw(),ue.draw(),"waitingForInput"==se&&ue.drawAvailableDirections(),le.draw(G.context)}"fadeToBlack"!==se&&"fadeIn"!==se||(G.context.fillStyle=`rgba(23, 17, 26, ${re.faderOpacity})`,G.context.fillRect(-G.width,-G.height,3*G.width,3*G.height)),he.drawEffects()}},G.start()}]);